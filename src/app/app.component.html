<nz-layout class="app-layout">
    <nz-sider class="menu-sidebar" nzWidth="300px" [(nzCollapsed)]="isCollapsed" [nzCollapsedWidth]="0"
        [nzTrigger]="null" nzTheme="light">
        <div class="sidebar-logo d-flex justify-content-center align-items-center" nzTheme="light">
            <a class="text-center p-3">
                <img src="assets/images/logo-RTC-2023-1200-banchuan.png" alt="logo" class="img-logo " />
                <!-- <img [src]="isCollapsed ? 'assets/images/icon-logo-RTC-2023.png' : 'assets/images/logo-RTC-2023-1200-banchuan.png'"
                    alt="" class="p-1"> -->
                <!-- <h1>RTC</h1> -->
            </a>
        </div>

        <ul nz-menu nzMode="inline">
            <li nz-menu-item nzMatchRouter class="m-0 fw-bold">
                <img src="assets/icon/home.svg" class="menu-icon m-1" width="24px" />
                <a routerLink="/home">Trang chủ</a>
            </li>
            @for (m of menuComps; track m.key) {

            <ng-template #nzTitle style="padding: 0 16px;">
                <img [src]="m.icon" class="menu-icon m-1" *ngIf="(m.icon || '') != ''" width="24px" />
                <nz-icon nzType="caret-down" nzTheme="outline" *ngIf="(m.icon || '') == ''" />
                <p class="m-0 fw-bold">{{ m.title }}</p>
            </ng-template>
            <li nz-submenu [nzTitle]="nzTitle" *ngIf="isGroup(m) && m.isPermission && m.isOpen"
                [nzOpen]="menuCompKey === m.key">
                <ul>
                    @for (c1 of m.children; track c1.key) {
                    <li nz-menu-item *ngIf="isLeaf(c1) && c1.isPermission && c1.isOpen"
                        (click)="newTabComp(c1.comp,c1.title,(c1.router??''),c1.data)">
                        <img [src]="c1.icon" class="menu-icon m-1" *ngIf="(c1.icon || '') != ''" width="24px" />
                        <nz-icon nzType="caret-right" nzTheme="outline" *ngIf="(c1.icon || '') == ''" />
                        {{c1.title}}

                        <a [routerLink]="c1.router" [queryParams]="c1.data" style="margin-left: auto;">
                            <nz-icon nzType="export" nzTheme="outline" />
                        </a>
                    </li>

                    <ng-template #nzTitle1 style="padding: 0 16px;">
                        <img [src]="c1.icon" class="menu-icon m-1" *ngIf="(c1.icon || '') != ''" width="24px" />
                        <nz-icon nzType="caret-down" nzTheme="outline" *ngIf="(c1.icon || '') == ''" />
                        <p class="m-0" style="white-space: pre-line;">{{ c1.title }}</p>
                    </ng-template>
                    <li nz-submenu [nzTitle]="nzTitle1" *ngIf="isGroup(c1) && c1.isPermission && c1.isOpen"
                        [nzOpen]="menuCompKey === c1.key">
                        <ul>
                            @for (c2 of c1.children; track c2.key) {
                            <li nz-menu-item *ngIf="isLeaf(c2) && c2.isPermission && c2.isOpen"
                                (click)="newTabComp(c2.comp, c2.title,(c2.router??''),c2.data)"
                                style="font-size: 11px !important;">
                                <img [src]="c2.icon" class="menu-icon m-1" *ngIf="(c2.icon || '') != ''" width="24px" />
                                <nz-icon nzType="caret-right" nzTheme="outline" *ngIf="(c2.icon || '') == ''" />
                                {{c2.title}}
                                <a [routerLink]="c2.router" [queryParams]="c2.data" style="margin-left: auto;">
                                    <nz-icon nzType="export" nzTheme="outline" />
                                </a>
                            </li>


                            <ng-template #nzTitle2 style="padding: 0 16px;">
                                <img [src]="c2.icon" class="menu-icon m-1" *ngIf="(c2.icon || '') != ''" width="24px" />
                                <nz-icon nzType="caret-down" nzTheme="outline" *ngIf="(c2.icon || '') == ''" />
                                <p class="m-0" style="white-space: pre-line !important;font-size: 11px !important;">{{
                                    c2.title }} </p>
                            </ng-template>
                            <li nz-submenu [nzTitle]="nzTitle2" *ngIf="isGroup(c2) && c2.isPermission && c2.isOpen"
                                [nzOpen]="menuKey === c2.key || rootMenuKey === c2.key">
                                <ul>
                                    @for (c3 of c2.children; track c3.key) {
                                    <li nz-menu-item *ngIf="isLeaf(c3) && c3.isPermission && c3.isOpen"
                                        (click)="newTabComp(c3.comp, c3.title,(c3.router??''),c3.data)"
                                        style="font-size: 10px !important;">
                                        <img [src]="c3.icon" class="menu-icon m-1" *ngIf="(c3.icon || '') != ''"
                                            width="24px" />
                                        <nz-icon nzType="caret-right" nzTheme="outline" *ngIf="(c3.icon || '') == ''" />
                                        {{c3.title}}
                                        <a [routerLink]="c3.router" [queryParams]="c3.data" style="margin-left: auto;">
                                            <nz-icon nzType="export" nzTheme="outline" />
                                        </a>
                                    </li>
                                    }

                                </ul>
                            </li>
                            }

                        </ul>
                    </li>
                    }
                </ul>
            </li>
            }
        </ul>
        <div class="sidebar-footer">
            Version: {{ userAppVersion }}
            <div *ngIf="hasNewVersion" (click)="showUpdateModal()" class="cursor-pointer blink-text"
                style="color: #ff4d4f; font-weight: bold; margin-top: 5px; font-size: 12px;">
                <i nz-icon nzType="info-circle" nzTheme="outline"></i> Có bản cập nhật mới!
            </div>
        </div>
    </nz-sider>
    <nz-layout>
        <nz-header>
            <div class="app-header">

                <span class="header-trigger pe-0" (click)="isCollapsed = !isCollapsed">
                    <nz-icon class="trigger text-light" [nzType]="isCollapsed ? 'menu-unfold' : 'menu-fold'" />
                </span>
                <button nz-button nz-dropdown [nzDropdownMenu]="appmenu" nzPlacement="bottomRight" nzType="text"
                    class=" text-light" nzTrigger="click">
                    <img src="assets/icon/app_store.svg" width="24">
                </button>
                <div style="width: 100%; max-width: 100%; overflow: auto" class="app-header-tabs">

                    <nz-tabset nzType="editable-card" nzHideAdd [(nzSelectedIndex)]="selectedCompIndex"
                        (nzClose)="closeTabComp($event)">
                        <nz-tab *ngFor="let tab of dynamicTabComps" [nzTitle]="titleTemplate" [nzClosable]="true"
                            class="text-uppercase">

                            <ng-template #titleTemplate>
                                <a [routerLink]="tab.key" [queryParams]="tab.data"
                                    style="margin-left: auto; color:#fff">
                                    {{ tab.title }}
                                </a>

                            </ng-template>
                        </nz-tab>
                    </nz-tabset>
                </div>
                <div class="header-trigger">


                    <nz-dropdown-menu #appmenu="nzDropdownMenu">
                        <div class="app-launcher">

                            <div class="app-launcher-inner">
                                @for (m of menuComps; track m.key) {
                                <a (click)="toggleMenuComp(m.key)" [class.active]="isMenuCompOpen(m.key)"
                                    *ngIf="m.isPermission">
                                    <img [src]="m.icon?.replace('24','64')" />
                                    <span class="mt-1">{{m.title}}</span>
                                </a>
                                }
                            </div>
                        </div>
                    </nz-dropdown-menu>

                    <app-app-notifycation-dropdown [items]="notifItems" (itemClick)="onPick($event)">
                        <button nz-button nzType="text" class="text-light fs-7" trigger>
                            <nz-badge [nzOverflowCount]="9" [nzCount]="notifItems.length" class="fs-7">
                                <img src="assets/icon/notification_home.svg" width="16" class="bell-icon">
                            </nz-badge>
                        </button>
                    </app-app-notifycation-dropdown>
                    <app-app-user-dropdown>
                        <button nz-button nzType="text" trigger>
                            <img src="assets/icon/user.svg" width="16">
                        </button>
                    </app-app-user-dropdown>
                </div>
            </div>
        </nz-header>
        <nz-content class="">

            <!-- <nz-tabset [(nzSelectedIndex)]="selectedIndex" class="hidden-tab-header">
                <nz-tab *ngFor="let tab of dynamicTabs; let i = index">
                    <ng-template nz-tab>
                        <router-outlet [name]="tab.outlet"></router-outlet>
                    </ng-template>
                </nz-tab>
            </nz-tabset> -->


            <div class="content-host" *ngIf="hasDynamicTabComp">
                <ng-container *ngFor="let tab of dynamicTabComps; let i = index">
                    <div [hidden]="selectedCompIndex !== i" class="tab-pane">
                        <ng-container *ngComponentOutlet="tab.comp; injector: tab.injector">
                        </ng-container>
                    </div>
                </ng-container>
            </div>
            <router-outlet *ngIf="!hasDynamicTabComp"></router-outlet>
        </nz-content>
        <!-- <nz-footer class="p-2 text-uppercase"> &copy; 2025, made by rtc technology việt nam</nz-footer> -->
    </nz-layout>
</nz-layout>