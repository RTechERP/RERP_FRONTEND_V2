<nz-modal [(nzVisible)]="isVisible" nzTitle="Nhập câu hỏi từ Excel" (nzOnCancel)="handleCancel()"
    [nzFooter]="modalFooter" nzWidth="900px">
    <ng-container *nzModalContent>
        <div class="import-container">
            <div class="action-bar d-flex align-items-center mb-3">
                <nz-upload [nzFileList]="fileList" [nzBeforeUpload]="beforeUpload" [nzLimit]="1" class="me-2">
                    <button nz-button><i nz-icon nzType="upload"></i>Chọn file Excel</button>
                </nz-upload>
                <button nz-button nzType="link" (click)="downloadTemplate()" class="me-auto">
                    <i nz-icon nzType="download"></i> Tải file mẫu
                </button>

                <div class="sheet-selector d-flex align-items-center" *ngIf="sheets.length > 0">
                    <span class="me-2 text-nowrap">Chọn Sheet:</span>
                    <nz-select [(ngModel)]="selectedSheet" (ngModelChange)="onSheetChange($event)"
                        style="width: 200px;">
                        <nz-option *ngFor="let s of sheets" [nzValue]="s" [nzLabel]="s"></nz-option>
                    </nz-select>
                </div>
            </div>

            <div class="progress-container mb-3" *ngIf="isProcessing">
                <div class="status-msg mb-1 text-primary fw-bold">{{ statusMessage }}</div>
                <nz-progress [nzPercent]="progress" nzStatus="active"></nz-progress>
            </div>

            <div class="preview-table">
                <h6>Xem trước dữ liệu ({{ previewData.length }} dòng)</h6>
                <div #PreviewTable class="table-container"></div>
            </div>
        </div>
    </ng-container>

    <ng-template #modalFooter>
        <button nz-button nzType="default" (click)="handleCancel()" [disabled]="isProcessing">Hủy</button>
        <button nz-button nzType="primary" (click)="handleImport()" [nzLoading]="isProcessing"
            [disabled]="previewData.length === 0">
            <i nz-icon nzType="import"></i> Bắt đầu nhập
        </button>
    </ng-template>
</nz-modal>