<ng-container class="w-100">
  <nz-splitter>
     <nz-splitter-panel nzDefaultSize="100%">
        <div class="card h-100 border-0 rounded-0">
            <div class="card-header bg-white p-1">
                 <div class="d-flex gap-1">
                    <button class="fs-12 btn" nz-button nzType="default" nzSize="small" (click)="openModalForNewProduct()">
                       <nz-icon nzType="plus"/> Thêm
                   </button>
                   <button class="fs-12 btn" nz-button nzType="default" nzSize="small" (click)="edit()">
                       <nz-icon nzType="edit" nzTheme="fill"  />Sửa
                   </button>
                   <button class="fs-12 btn" nz-button nzType="default" nzSize="small"  (click)="delete()">
                       <nz-icon nzType="delete" nzTheme="fill"  />Xóa
                   </button>
                   <button class="fs-12 btn" nz-button nzType="default" nzSize="small" (click)="openModalDVT()">
                       <nz-icon nzType="appstore" nzTheme="outline" />Đơn vị tính
                   </button>
                   <button class="fs-12 btn" nz-button nzType="default" nzSize="small" (click)="OpenModalExcel()">
                       <nz-icon nzType="file-excel" nzTheme="outline" />Nhập excel
                   </button>
                   <button class="fs-12 btn" nz-button nzType="default" nzSize="small" (click)="exportToExcel()">
                       <nz-icon nzType="file-excel" nzTheme="outline" />Xuất excel
                   </button>
                   <nz-input-group style="width: 30%;" nzSize="small" [nzSuffix]="suffixIconSearch" class="ms-auto">
                    <input type="text"  [(ngModel)]="searchText" nz-input class="fs-12" (input)="onSearchChange($event)" style="font-style: italic;" placeholder="Tìm kiếm" />
                  </nz-input-group>
                  <ng-template #suffixIconSearch>
                    <nz-icon nzType="search" />
                  </ng-template>                  
                 </div>               
            </div>
            <div class="card-body p-0">
                <div id="datatable"></div>
            </div>
        </div>
     </nz-splitter-panel>
  </nz-splitter>
</ng-container>

<!-- #region Modal thêm sửa VPP -->
<div class="modal fade" id="detailProductModal" tabindex="-1" aria-labelledby="addProductModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header bg-primary text-uppercase py-2" >
       <h6 class="modal-title text-white" id="addProductModalLabel">Chi tiết sản phẩm</h6>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form  nz-form class="row g-3 needs-validation was-validated" >
          <div class="row">
            <div class="col-md-6 pb-3">
              <nz-form-label class="fs-12">Mã RTC </nz-form-label>
              <nz-form-control>
                  <input nz-input [(ngModel)]="newProduct.CodeRTC" name="CodeRTC" [disabled]="true" />
              </nz-form-control>
            </div>
            <div class="col-md-6 pb-3">
              <nz-form-label class="fs-12">Mã NCC<sup style="color: red;"> (*)</sup>  </nz-form-label>  
              <nz-form-control [nzSpan]="24" nzErrorTip="Vui lòng nhập Mã NCC">
                  <input nz-input placeholder="Nhập mã NCCC" required  [(ngModel)]="newProduct.CodeNCC"  name="CodeNCC" />
              </nz-form-control>
            </div>
          </div>

          <div class="row">
            <div>
              <div class="col md-12 pb-3">
                  <nz-form-label class="fs-12">Tên RTC</nz-form-label>
                  <nz-form-control>
                      <input nz-input placeholder="Nhập tên RTC" required   [(ngModel)]="newProduct.NameRTC" name="NamRTC" />
                  </nz-form-control>
              </div>
            </div>
          </div>
          <div class="row">
            <div>
                <div class="col md-12 pb-3">
                  <nz-form-label class="fs-12">Tên NCC<sup style="color: red;"> (*)</sup> </nz-form-label>
                  <nz-form-control [nzSpan]="24" nzErrorTip="Vui lòng nhập tên nhà cung cấp">
                      <input nz-input [(ngModel)]="newProduct.NameNCC" name="NameNCC"
                      placeholder="Nhập tên NCC" required />
                  </nz-form-control>
              </div>
            </div>
          </div>
          <div class="row">
              <div class="col md-6 pb-3 ">
                <nz-form-label class="fs-12">Đơn vị tính<sup style="color: red;"> (*)</sup></nz-form-label>
                <nz-form-control [nzSpan]="24" nzErrorTip="Vui lòng chọn đơn vị tính">
                  <nz-input-group nzSearch [nzAddOnAfter]="suffixIconButton" nzSize="default" class="w-100">
                    <nz-select
                      [(ngModel)]="newProduct.SupplyUnitID"
                      name="SupplyUnitID"
                      nzPlaceHolder="Chọn đơn vị"
                      class="fs-12 w-100"
                      required
                      nzShowSearch
                      nzAllowClear               
                    >
                      <nz-option
                        *ngFor="let unit of listUnit"
                        [nzValue]="unit.ID"
                        [nzLabel]="unit.Name"
                      ></nz-option>
                    </nz-select>
                  </nz-input-group>
                  <ng-template #suffixIconButton>
                    <button nz-button nzType="default" nzSize="default" nzSearch (click)="openModalDVT()">
                  <nz-icon nzType="plus" nzTheme="outline" />
                </button>
                  </ng-template>
                </nz-form-control>
            </div>
           
            <div class="col md-6 pb-4">
              <nz-form-label for="Price" class="fs-12">Giá sản phẩm <sup style="color: red;"> (*)</sup></nz-form-label>
              <nz-form-control [nzSpan]="24" nzErrorTip="Vui lòng nhập giá sản phẩm">
                <nz-input-number [style.width.%]="100" [(ngModel)]="newProduct.Price"
                placeholder="Nhập giá" name="Price" required>
                <span nzInputAddonAfter>VND</span>
                </nz-input-number>
              </nz-form-control>           
           
            </div>
          </div>
          <div class="row mb-3 ">
            <div class="col md-6 pb-4">
              <nz-form-label for="Price" class="fs-12">Định mức</nz-form-label>
              <nz-form-control [nzSpan]="24" nzErrorTip="Vui lòng nhập định mức">
                <nz-input-number [style.width.%]="100"  [(ngModel)]="newProduct.RequestLimit" placeholder="" name="RequestLimit" required>
                </nz-input-number>
              </nz-form-control>
            </div>
            <div class="col md-6">
              <nz-form-label class="fs-12">Chọn loại sản phẩm<sup style="color: red;"> (*)</sup> </nz-form-label>
              <nz-form-control [nzSpan]="24" nzErrorTip="Vui lòng chọn loại sản phẩm">
                <nz-input-group nzSearch nzSize="default" class="w-100">
                  <nz-select
                  [(ngModel)]="newProduct.Type"
                  name="Type"
                  nzPlaceHolder="Chọn loại sản phẩm"
                  class="fs-12"
                  required
                    nzShowSearch
                    nzAllowClear               
                  >
                  <nz-option
                  *ngFor="let type of typeOptions"
                  [nzValue]="type.id"
                  [nzLabel]="type.name">
                </nz-option>
                  </nz-select>
                </nz-input-group> 
              </nz-form-control>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary p-0 ps-2 pe-2 "  data-bs-dismiss="modal">Đóng</button>
        <button type="submit" class="btn btn-success p-0 ps-2 pe-2 " (click)="isCheckmode? update(): add()">Lưu</button>
      </div>
    </div>
  </div>
</div>
<!-- #endregion -->

<!-- #region Modal thêm đơn vị tính --> 
<div class="modal fade" id="detailProductModal" tabindex="-1" aria-labelledby="addProductModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div  class="modal-header  bg-primary text-white text-uppercase" >
       <h6 class="modal-title" id="addProductModalLabel">Chi tiết sản phẩm</h6>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form class="row g-3 needs-validation was-validated" novalidate>
          <div class="row">
            <div class="col-md-6 pb-3">
              <label for="CodeRTC" class="form-label fs-12">Mã RTC <sup style="color: red;"> (*)</sup></label>
              <input type="text" class="form-control fs-12 " [(ngModel)]="newProduct.CodeRTC" name="CodeRTC" readonly>
            </div>
            <div class="col-md-6 pb-3">
              <label for="CodeNCC" class="form-label fs-12">Mã NCC <sup style="color: red;"> (*)</sup></label>
              <input type="text" class="form-control fs-12 " [(ngModel)]="newProduct.CodeNCC" name="CodeNCC"
                placeholder="Nhập mã NCCC" required>
              <div class="invalid-feedback">
                Vui lòng nhập mã NCC!
              </div>
            </div>
          </div>
          <div class="row">
            <div>
              <div class="col md-12 pb-3">
                <label for="NameRTC" class="form-label fs-12">Tên RTC <sup style="color: red;"> (*)</sup></label>
                <input type="text" class="form-control fs-12" [(ngModel)]="newProduct.NameRTC" name="NamRTC"
                  placeholder="Nhập tên RTC">
              </div>
            </div>

          </div>
          <div class="row">
            <div>
                <div class="col md-12 pb-3">
                <label for="NameNCC" class="form-label fs-12">Tên NCC <sup style="color: red;"> (*)</sup></label>
                <input type="text" class="form-control fs-12" [(ngModel)]="newProduct.NameNCC" name="NameNCC"
                  placeholder="Nhập tên NCC" required>
                <div class="invalid-feedback">
                  Vui lòng nhập tên nhà cung cấp!
                </div>
              </div>
            </div>
          </div>
          <div class="row">
              <div class="col md-6 pb-3 ">
              <label for="SupplyUnitID" class="form-label fs-12">Đơn vị tính <sup style="color: red;"> (*)</sup></label>
              <div class="d-flex gap-2 align-items-center">
                <nz-select
                  [(ngModel)]="newProduct.SupplyUnitID"
                  name="SupplyUnitID"
                  nzPlaceHolder="Chọn đơn vị"
                  class="col-md-10 form-control form-control-sm p-0 border border-0 fs-12"
                  required>
                  <nz-option
                    *ngFor="let unit of listUnit"
                    [nzValue]="unit.ID"
                    [nzLabel]="unit.Name">
                  </nz-option>
                </nz-select>
                
                <button type="button" class="btn btn-outline-primary col-md-2 d-flex align-items-center justify-content-center"
                  data-bs-toggle="modal"
                  data-bs-target="#addUnitModal">
                  <i class="fa-solid fa-plus"></i>
                </button>
              </div>
              <div class="invalid-feedback ">
                Vui lòng chọn đơn vị tính!
              </div>
            </div>
            <div class="col md-6 pb-4">
              <label for="Price" class="form-label fs-12 ">Giá sản phẩm<sup style="color: red;"> (*)</sup></label>
              <input style="text-align: right;" type="number" min="1" class="form-control fs-12 " [(ngModel)]="newProduct.Price"
                placeholder="Nhập giá" name="Price" required>
              <div class="invalid-feedback">
                Vui lòng nhập giá sản phẩm!
              </div>
            </div>
          </div>
          <div class="row mb-3 ">
            <div class="col md-6 pb-4">
              <label for="RequestLimit" class="form-label fs-12">Định mức</label>
              <input type="number" style="text-align: right;" class="form-control fs-12" min="0"
                [(ngModel)]="newProduct.RequestLimit" placeholder="" name="RequestLimit" required>
                <div class="invalid-feedback">
                  Vui lòng nhập định mức!
                </div>
            </div>
            <div class="col md-6">
              <label for="Type" class="form-label fs-12 ">Chọn loại sản phẩm<sup style="color: red;"> (*)</sup></label>
              <nz-select
                [(ngModel)]="newProduct.Type"
                name="Type"
                nzPlaceHolder="Chọn loại sản phẩm"
                class="fs-12"
                required>
                <nz-option
                  *ngFor="let type of typeOptions"
                  [nzValue]="type.id"
                  [nzLabel]="type.name">
                </nz-option>
              </nz-select>
              <div class="invalid-feedback ">
                Vui lòng chọn loại sản phẩm!
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
         <button nz-button nzDanger nzSize="small" data-bs-dismiss="modal">Đóng</button>
        <button nz-button nzType="primary" nzSize="small" (click)="isCheckmode? update(): add()">Lưu</button>
      </div>
    </div>
  </div>
</div>
<!-- #endregion -->
<!-- #region modal hiện danh sách đơn vị tính và kèm chức năng thêm, sửa-->
<div class="modal fade" id="officeSupplyUnitModal" tabindex="-1" aria-labelledby="officeSupplyUnitModalLabel"  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header text-uppercase ">
       <h6 class="modal-title" id="addUnitModalLabel">Danh sách đơn vị tính</h6>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form class="needs-validation" novalidate>
          <div class="d-flex gap-2 align-items-center p-2">
              <input type="text" class="form-control form-control-sm fs-12" [(ngModel)]="selectedItem.Name" name="unitName" placeholder="Nhập đơn vị tính">
              <button class="fs-12 btn" nz-button nzType="default" nzSize="small"  (click)="saveSelectedItem()">
                <nz-icon nzType="edit" nzTheme="fill" />
              Cập nhật
            </button>		
          </div>
          <div class="card-body p-2">
            <div id="datatable2"></div>
          </div>
        </form>
      </div>   
    </div>
  </div>
</div>
<!-- #endregion -->
<!-- #region modal hiện nhập khẩu excel  -->
<div class="modal fade" id="ExcelModal" tabindex="-1" aria-labelledby="ExcelModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header text-uppercase ">
       <h6 class="modal-title" id="ExcelModalLabel">NHẬP DỮ LIỆU EXCEL</h6>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="d-flex gap-2 align-items-center p-2">
          <div class="flex-grow-1">
            <div class="progress-wrapper">
              <div style="text-align: center;" class="progress-text">{{ formatProgressText(displayProgress) }}</div>
              <nz-progress
                [nzPercent]="displayProgress"
                [nzStrokeColor]="{ '0%': '#108ee9', '100%': '#87d068' }"
                [nzShowInfo]="false"
              ></nz-progress>
            </div>
          </div>
        </div>
        <form class="needs-validation" novalidate>
          <div class="d-flex flex-column gap-2 p-2">
            <div class="d-flex gap-2 align-items-center">
              <div class="d-flex align-items-center gap-2" style="flex: 2;">
                <label class="mb-0 fs-12" style="white-space: nowrap;">Đường dẫn:</label>
                <div class="d-flex gap-2 flex-grow-1">
                  <input nz-input [style.width.%]="100" class="fs-12" name="path" id="pathInput" [(ngModel)]="filePath" [disabled]="true">
                  <input type="file" class="d-none fs-12" id="fileInput" accept=".xlsx,.xls" (change)="onFileSelected($event)">
                  <button type="button" class="btn btn-warning  btn-sm" (click)="openFileExplorer()" style="height: auto;">
                    <i class="fas fa-folder-open"></i>
                  </button>
                </div>
              </div>
              <div class="d-flex align-items-center gap-2" style="flex: 1;">
                <label class="mb-0 fs-12" style="white-space: nowrap;">Tên Sheet:</label>
                <select class="form-select form-select-sm fs-12" name="sheet" id="sheetSelect" [(ngModel)]="selectedSheet" (change)="onSheetChange()">
                  <option value="">Chọn Sheet</option>
                  <option *ngFor="let sheet of excelSheets" [value]="sheet">{{sheet}}</option>
                </select>
              </div>
            </div>
          </div>
          <div class="card-body p-2">
            <div id="datatableExcel" style="height: 300px; overflow-y: auto;">
            </div>
          </div>
          <div class="modal-footer">
             <button type="button" class="btn btn-outline-danger p-0 ps-2 pe-2 "  data-bs-dismiss="modal">Đóng</button>
            <button  type="button" class="btn btn-info p-0 ps-2 pe-2">
              <a href="/assets/templateForm/MauVPP.xlsx" download="MauVPP.xlsx" style="text-decoration: none; color: inherit;"><nz-icon nzType="download" nzTheme="outline" /> Mẫu</a>
            </button>
            <button type="submit" class="btn btn-success p-0 ps-2 pe-2 " (click)="saveExcelData()">Lưu</button>   
          </div>
        </form>
      </div>   
    </div>
  </div>
</div>
<!-- #endregion -->