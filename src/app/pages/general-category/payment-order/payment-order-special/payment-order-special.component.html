<div class="modal-content">
    <div class="modal-header bg-primary py-2">
        <h5 class="modal-title text-uppercase text-light" id="staticBackdropLabel">Chi tiết đề nghị thanh toán đặc biệt
        </h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="activeModal.close()"></button>
    </div>
    <div class="modal-body">
        <form nz-form nzLayout="vertical" [formGroup]="validateForm">
            <div nz-row [nzGutter]="16">

                <div nz-col nzSm="24" nzMd="3" nzLg="4">
                    <nz-form-item>
                        <nz-form-label>Người đề nghị</nz-form-label>
                        <nz-form-control nzErrorTip="">
                            <input nz-input [formControlName]="paymentOrderField.FullName.field">
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div nz-col nzSm="24" nzMd="3" nzLg="4">
                    <nz-form-item>
                        <nz-form-label>Bộ phận</nz-form-label>
                        <nz-form-control nzErrorTip="">
                            <input nz-input [formControlName]="paymentOrderField.DepartmentName.field">
                        </nz-form-control>
                    </nz-form-item>
                </div>

                <div nz-col nzXs="24" nzSm="12" nzMd="6" nzLg="4">
                    <nz-form-item>
                        <nz-form-label>Deadline thanh toán</nz-form-label>
                        <nz-form-control nzErrorTip="Chọn thời gian">
                            <nz-input-group nzSearch [nzAddOnBefore]="suffixIconButton">
                                <nz-date-picker class="w-100"
                                    [formControlName]="paymentOrderField.DeadlinePayment.field"
                                    [nzShowTime]="{ nzFormat: 'HH:mm' }" nzFormat="dd/MM/yyyy HH:mm">
                                </nz-date-picker>
                            </nz-input-group>
                            <ng-template #suffixIconButton>
                                <label nz-checkbox [formControlName]="paymentOrderField.IsUrgent.field"></label>
                            </ng-template>
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div nz-col nzXs="24" nzSm="12" nzMd="6" nzLg="12">
                    <nz-form-item>
                        <nz-form-label>Khách hàng <span class="text-danger ps-1">(*)</span></nz-form-label>
                        <nz-form-control nzErrorTip="Chọn khách hàng">
                            <nz-select nzShowSearch nzAllowClear nzPlaceHolder="Chọn khách hàng"
                                [formControlName]="paymentOrderField.CustomerID.field">
                                @for (item of customers; track item) {
                                <nz-option nzLabel="{{item.CustomerCode}} - {{item.CustomerName}}"
                                    [nzValue]="item.ID"></nz-option>
                                }
                            </nz-select>
                        </nz-form-control>
                    </nz-form-item>
                </div>
            </div>

            <div nz-row [nzGutter]="16">
                <div nz-col nzXs="24" nzSm="12" nzMd="6" nzLg="4">
                    <nz-form-item>
                        <nz-form-label>Sale phụ trách<span class="text-danger ps-1">(*)</span></nz-form-label>
                        <nz-form-control nzErrorTip="Chọn trưởng bộ phận">
                            <nz-select nzShowSearch nzAllowClear nzPlaceHolder="Chọn loại"
                                [formControlName]="paymentOrderField.ApprovedTBPID.field">
                                @for (item of approvedTBPs; track item) {
                                <nz-option nzLabel="{{item.FullName}}" [nzValue]="item.EmployeeID"></nz-option>
                                }
                            </nz-select>
                        </nz-form-control>
                    </nz-form-item>
                </div>

                <div nz-col nzXs="24" nzSm="12" nzMd="6" nzLg="4">
                    <nz-form-item>
                        <nz-form-label>Ban giám đốc<span class="text-danger ps-1">(*)</span></nz-form-label>
                        <nz-form-control nzErrorTip="Chọn ban giám đốc">
                            <nz-select nzShowSearch nzAllowClear nzPlaceHolder="Chọn giám đốc"
                                [formControlName]="paymentOrderField.ApprovedBGDID.field">
                                @for (item of approvedTBPs; track item) {
                                <nz-option nzLabel="{{item.FullName}}" [nzValue]="item.EmployeeID"></nz-option>
                                }
                            </nz-select>
                        </nz-form-control>
                    </nz-form-item>
                </div>

                <div nz-col nzXs="24" nzSm="12" nzMd="6" nzLg="4">
                    <nz-form-item>
                        <nz-form-label>Ngày đề nghị<span class="text-danger ps-1">(*)</span></nz-form-label>
                        <nz-form-control nzErrorTip="Chọn ngày">
                            <nz-date-picker class="w-100" [formControlName]="paymentOrderField.DateOrder.field"
                                nzFormat="dd/MM/yyyy" nzInputReadOnly="false">
                            </nz-date-picker>
                        </nz-form-control>
                    </nz-form-item>
                </div>

                <div nz-col nzXs="24" nzSm="12" nzMd="6" nzLg="6">
                    <nz-form-item>
                        <nz-form-label>Thời gian thanh quyết toán<span
                                class="text-danger ps-1">(*)</span></nz-form-label>
                        <nz-form-control nzErrorTip="Chọn ngày">
                            <nz-date-picker class="w-100" [formControlName]="paymentOrderField.DatePayment.field"
                                nzFormat="dd/MM/yyyy">
                            </nz-date-picker>
                        </nz-form-control>
                    </nz-form-item>
                </div>

                <div nz-col nzXs="24" nzSm="12" nzMd="6" nzLg="6">
                    <nz-form-item>
                        <nz-form-label>Phân loại thanh toán</nz-form-label>
                        <nz-form-control nzErrorTip="Chọn loại">
                            <nz-select nzShowSearch nzAllowClear nzPlaceHolder="Chọn loại"
                                [formControlName]="paymentOrderField.PaymentOrderTypeID.field">
                                <nz-option nzLabel="Thanh toán trước" nzValue="31"></nz-option>
                                <nz-option nzLabel="Thanh toán sau" nzValue="32"></nz-option>
                            </nz-select>
                        </nz-form-control>
                    </nz-form-item>
                </div>
            </div>

            <div nz-row [nzGutter]="16">
                <div nz-col nzXs="24" nzSm="12" nzMd="6" nzLg="12">
                    <nz-form-item>
                        <nz-form-label>Số PO</nz-form-label>
                        <nz-form-control nzErrorTip="Chọn po">
                            <nz-select nzShowSearch nzAllowClear nzPlaceHolder="Chọn loại"
                                [formControlName]="'PaymentOrderPOs'" nzMode="multiple">
                                @for (item of pokhs; track item) {
                                <nz-option nzLabel="{{item.PONumber}} - {{item.POCode}}"
                                    [nzValue]="item.ID"></nz-option>
                                }
                            </nz-select>
                        </nz-form-control>
                    </nz-form-item>
                </div>


                <div nz-col nzXs="24" nzSm="12" nzMd="6" nzLg="12">
                    <nz-form-item>
                        <nz-form-label>Số hóa đơn</nz-form-label>
                        <nz-form-control nzErrorTip="">
                            <nz-select nzShowSearch nzAllowClear nzPlaceHolder=""
                                [formControlName]="'PaymentOrderBillNumbers'" nzMode="multiple">
                                @for (item of billBumbers; track item) {
                                <nz-option nzLabel="{{item.BillNumber}}" [nzValue]="item.BillNumber"></nz-option>
                                }
                            </nz-select>
                        </nz-form-control>
                    </nz-form-item>
                </div>
            </div>

            <div nz-row [nzGutter]="16">
                <div nz-col nzXs="24" nzSm="12" nzMd="6" nzLg="12">
                    <nz-form-item>
                        <nz-form-label>Lý do<span class="text-danger ps-1">(*)</span></nz-form-label>
                        <nz-form-control nzErrorTip="Nhập lý do">
                            <nz-textarea-count [nzMaxCharacterCount]="100">
                                <textarea rows="4" [formControlName]="paymentOrderField.ReasonOrder.field"
                                    nz-input></textarea>
                            </nz-textarea-count>
                        </nz-form-control>
                    </nz-form-item>
                </div>

                <div nz-col nzXs="24" nzSm="12" nzMd="6" nzLg="12">
                    <nz-form-item class="m-0">
                        <input type="file" multiple (change)="handleChangeFile($event)">

                    </nz-form-item>
                    <div class="grid-container-file border" style="height: 100px; overflow: auto;">
                        <angular-slickgrid gridId="grdFile" [columns]="columnDefinitionFiles"
                            [options]="gridOptionFiles" [dataset]="datasetFile"
                            (onAngularGridCreated)="angularGridFileReady($event.detail)">
                        </angular-slickgrid>
                    </div>
                </div>
            </div>

            <div nz-row [nzGutter]="16">
                <div nz-col nzXs="24" nzSm="12" nzMd="6" nzLg="20">
                    <nz-form-item>
                        <nz-form-label>Số tiền đề nghị được ghi theo bảng kê dưới đây:</nz-form-label>
                    </nz-form-item>
                </div>

                <div nz-col nzXs="24" nzSm="12" nzMd="6" nzLg="4">
                    <nz-form-item>
                        <nz-form-label>Loại tiền<span class="text-danger ps-1">(*)</span></nz-form-label>
                        <nz-form-control nzErrorTip="Chọn loại tiền">
                            <nz-select nzShowSearch nzAllowClear nzPlaceHolder="Chọn loại tiền"
                                [formControlName]="paymentOrderField.Unit.field">
                                @for (item of units; track item) {
                                <nz-option nzLabel="{{item.text}}" [nzValue]="item.id"></nz-option>
                                }
                            </nz-select>
                        </nz-form-control>
                    </nz-form-item>
                </div>


            </div>
        </form>

        <!-- <button nz-button nzType="default" (click)="addItem()">
            <nz-icon nzType="plus" nzTheme="outline" /> Thêm chi tiết
        </button> -->
        <div class="grid-container border">
            <angular-slickgrid gridId="grdData" [columns]="columnDefinitions" [options]="gridOptions"
                [dataset]="dataset" (onAngularGridCreated)="angularGridReady($event.detail)"
                (onCellChange)="onCellChanged($event.detail.eventData, $event.detail.args)" footer>

                <ng-template #slickgridFooter>
                    <p class="m-0 fw-bold text-dark">Số tiền bằng chữ: {{paymentOrder.TotalMoneyText}}</p>
                </ng-template>
            </angular-slickgrid>


        </div>
    </div>
    <div class="modal-footer py-2">
        <button nz-button nzType="default" nzDanger="" (click)="activeModal.close()">
            <nz-icon nzType="close" nzTheme="outline" /> Đóng
        </button>
        <button nz-button nzType="default" (click)="submitForm()">
            <nz-icon nzType="save" nzTheme="outline" /> Lưu
        </button>
    </div>
</div>