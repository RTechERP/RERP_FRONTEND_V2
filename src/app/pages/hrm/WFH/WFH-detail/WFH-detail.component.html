<div class="modal-dialog-scrollable">
  <div class="modal-header bg-primary align-items-center ps-2">
    <h6 class="text-light text-uppercase m-0" style="padding: 0, 5rem">
      {{ modalTitle }}
    </h6>
  </div>

  <div class="modal-body">
    <div class="container-fluid">
      <div class="row g-3">
        <!-- Người đăng ký (bắt buộc) -->
        <div class="col-md-6">
          <nz-form-item class="pt-1">
            <nz-form-label class="fs-12 d-flex align-items-center">
              Người đăng ký <span class="text-danger ps-1">(*)</span>
            </nz-form-label>
            <!-- Người đăng ký -->
            <nz-select
              name="selectedEmployeeId"
              [(ngModel)]="selectedEmployeeId"
              class="w-100"
              nzShowSearch
              nzAllowClear
              nzPlaceHolder="Chọn người đăng ký"
              [nzFilterOption]="filterEmployeeOption"
              [disabled]="isEditMode || isFormDisabled"
              (ngModelChange)="onEmployeeChange()"
            >
              <nz-option-group *ngFor="let group of employeeGroups" [nzLabel]="group.label">
                <nz-option
                  *ngFor="let emp of group.options"
                  [nzLabel]="emp.Code + ' - ' + emp.FullName"
                  [nzValue]="emp.ID"
                >
                  <div class="employee-option">
                    <span class="employee-code">{{ emp.Code }}</span>
                    <span class="employee-name"> - {{ emp.FullName }}</span>
                    <small class="text-muted d-block">{{ emp.DepartmentName }}</small>
                  </div>
                </nz-option>
              </nz-option-group>
            </nz-select>
          </nz-form-item>
        </div>

        <!-- Người duyệt (bắt buộc) -->
        <div class="col-md-6">
          <nz-form-item class="pt-1">
            <nz-form-label class="fs-12 d-flex align-items-center">
              Người duyệt <span class="text-danger ps-1">(*)</span>
            </nz-form-label>
            <!-- Người duyệt -->
            <nz-select
              name="selectedApprovedId"
              [(ngModel)]="selectedApprovedId"
              class="w-100"
              nzShowSearch
              nzAllowClear
              nzPlaceHolder="Chọn người duyệt"
              [nzFilterOption]="filterApproverOption"
              [disabled]="isEditMode || isFormDisabled"
              (ngModelChange)="onApprovedChange()"
            >
              <nz-option-group *ngFor="let group of approverGroups" [nzLabel]="group.label">
                <nz-option
                  *ngFor="let appr of group.options"
                  [nzLabel]="appr.Code + ' - ' + appr.FullName"
                  [nzValue]="appr.ID"
                >
                  <div class="approver-option">
                    <span class="approver-code">{{ appr.Code }}</span>
                    <span class="approver-name"> - {{ appr.FullName }}</span>
                    <small class="text-muted d-block">{{ appr.DepartmentName }}</small>
                  </div>
                </nz-option>
              </nz-option-group>
            </nz-select>
          </nz-form-item>
        </div>

        <!-- Ngày WFH (bắt buộc) -->
        <div class="col-md-6">
          <nz-form-item class="pt-1">
            <nz-form-label class="fs-12 d-flex align-items-center">
              Ngày WFH <span class="text-danger ps-1">(*)</span>
            </nz-form-label>
            <nz-date-picker
              name="dateWFH"
              [(ngModel)]="dateWFH"
              class="w-100"
              nzPlaceHolder="Chọn ngày WFH"
              [nzDisabled]="isFormDisabled"
              (ngModelChange)="onDateChange()"
              nzFormat="dd/MM/yyyy"
            ></nz-date-picker>
          </nz-form-item>
        </div>

        <!-- Thời gian WFH (bắt buộc) -->
        <div class="col-md-6">
          <nz-form-item class="pt-1">
            <nz-form-label class="fs-12 d-flex align-items-center">
              Thời gian WFH <span class="text-danger ps-1">(*)</span>
            </nz-form-label>
            <nz-select
              name="selectedTimeWFH"
              [(ngModel)]="selectedTimeWFH"
              class="w-100"
              nzPlaceHolder="Chọn thời gian"
              [nzDisabled]="isFormDisabled"
              (ngModelChange)="onTimeWFHChange()"
            >
              <nz-option 
                *ngFor="let option of timeWFHOptions" 
                [nzValue]="option.value"
                [nzLabel]="option.label">
              </nz-option>
            </nz-select>
          </nz-form-item>
        </div>

        <!-- Lý do WFH (bắt buộc) -->
        <div class="col-12">
          <nz-form-item class="pt-1">
            <nz-form-label class="fs-12 d-flex align-items-center">
              Lý do WFH <span class="text-danger ps-1">(*)</span>
            </nz-form-label>
            <textarea
              name="reason"
              nz-input
              [(ngModel)]="reason"
              placeholder="Nhập lý do WFH"
              [disabled]="isFormDisabled"
              rows="3"
              maxlength="500"
            ></textarea>
          </nz-form-item>
        </div>

        <!-- Nội dung/Kế hoạch công việc (bắt buộc) -->
        <div class="col-12">
          <nz-form-item class="pt-1">
            <nz-form-label class="fs-12 d-flex align-items-center">
              Nội dung/Kế hoạch công việc <span class="text-danger ps-1">(*)</span>
            </nz-form-label>
            <textarea
              name="contentWork"
              nz-input
              [(ngModel)]="contentWork"
              placeholder="Nhập nội dung và kế hoạch công việc chi tiết"
              [disabled]="isFormDisabled"
              rows="4"
              maxlength="1000"
            ></textarea>
          </nz-form-item>
        </div>

        <!-- Đánh giá kết quả (chỉ hiển thị khi TBP duyệt) -->
        <div class="col-12" *ngIf="showEvaluateResults">
          <nz-form-item class="pt-1">
            <nz-form-label class="fs-12 d-flex align-items-center">
              Đánh giá kết quả <span class="text-danger ps-1">(*)</span>
            </nz-form-label>
            <textarea
              name="evaluateResults"
              nz-input
              [(ngModel)]="evaluateResults"
              placeholder="Nhập đánh giá kết quả công việc WFH"
              [disabled]="isFormDisabled"
              rows="3"
              maxlength="500"
            ></textarea>
          </nz-form-item>
        </div>

        <!-- Lý do sửa đổi -->
        <div class="col-12" *ngIf="isEditMode">
          <nz-form-item class="pt-1">
            <nz-form-label class="fs-12 d-flex align-items-center">
              Lý do sửa đổi
            </nz-form-label>
            <textarea
              name="reasonEdit"
              nz-input
              [(ngModel)]="reasonEdit"
              placeholder="Nhập lý do sửa đổi"
              [disabled]="isFormDisabled"
              rows="2"
              maxlength="300"
            ></textarea>
          </nz-form-item>
        </div>

        <!-- Lý do từ chối (chỉ hiển thị khi duyệt) -->
        <div class="col-12" *ngIf="showReasonDecline">
          <nz-form-item class="pt-1">
            <nz-form-label class="fs-12 d-flex align-items-center">
              Lý do từ chối
            </nz-form-label>
            <textarea
              name="reasonDecline"
              nz-input
              [(ngModel)]="reasonDecline"
              placeholder="Nhập lý do từ chối (nếu không duyệt)"
              [disabled]="isFormDisabled"
              rows="3"
              maxlength="500"
            ></textarea>
          </nz-form-item>
        </div>
      </div>
    </div>
  </div>

  <div class="modal-footer br p-1 d-flex align-items-center">
    <div class="d-flex align-items-center flex-wrap gap-1">
      <!-- Loading spinner -->
      <div *ngIf="loading" class="d-flex align-items-center me-2">
        <nz-spin nzSimple nzSize="small" class="me-2"></nz-spin>
        <span class="fs-12">Đang tải...</span>
      </div>

      <!-- Close button -->
      <button
        nz-button
        nzType="default"
        nzDanger
        (click)="closeModal()"
        [disabled]="saving"
      >
        Đóng
      </button>

      <!-- Save button (Add/Edit mode) -->
      <button 
        *ngIf="!isViewMode && !isApproveMode"
        nz-button
        nzType="primary"
        (click)="saveWFH()"
        [disabled]="saving || !isFormValid()"
      >
        <span *ngIf="saving" class="spinner-border spinner-border-sm me-2"></span>
        {{ saving ? 'Đang lưu...' : 'Lưu' }}
      </button>

      <!-- Approve buttons (Approve mode) -->
      <button 
        *ngIf="canApprove"
        nz-button
        nzType="primary"
        (click)="approveWFH()"
        [disabled]="saving"
      >
        <span *ngIf="saving" class="spinner-border spinner-border-sm me-2"></span>
        {{ saving ? 'Đang duyệt...' : 'Duyệt' }}
      </button>

      <button 
        *ngIf="canDecline"
        nz-button
        nzType="default"
        nzDanger
        (click)="declineWFH()"
        [disabled]="saving"
      >
        <span *ngIf="saving" class="spinner-border spinner-border-sm me-2"></span>
        {{ saving ? 'Đang từ chối...' : 'Từ chối' }}
      </button>
    </div>
  </div>
</div>