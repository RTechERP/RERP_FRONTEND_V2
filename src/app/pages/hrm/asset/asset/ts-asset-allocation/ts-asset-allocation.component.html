<ng-container class="w-100" >
  <nz-splitter>
    <nz-splitter-panel [nzSize]="sizeSearch" nzResizable="false">
      <div class="card h-100 border-0 rounded-0">
        <!-- Header -->
        <div class="card-header bg-white p-1">
          <div class="d-flex justify-content-between align-items-center">
            <h6 class="m-0 ms-2">Tìm kiếm</h6>
            <button class="border-0 me-2" nz-button nzSize="small" nzType="default" nzDanger
              (click)="toggleSearchPanel()">
              <nz-icon nzType="close" nzTheme="outline"></nz-icon>
            </button>
          </div>
        </div>
        <!-- Body -->
        <div class="card-body">
          <form nz-form nzLayout="vertical">
            <!-- Từ ngày -->
            <nz-form-item class="mt-2">
              <nz-form-label class="fs-12" [nzSpan]="24">Từ ngày</nz-form-label>
              <nz-form-control [nzSpan]="24">
                <nz-date-picker class="w-100" nzSize="small" [(ngModel)]="dateStart" name="dateStart"></nz-date-picker>
              </nz-form-control>
            </nz-form-item>

            <!-- Đến ngày -->
            <nz-form-item class="mt-2">
              <nz-form-label class="fs-12" [nzSpan]="24">Đến ngày</nz-form-label>
              <nz-form-control [nzSpan]="24">
                <nz-date-picker class="w-100" nzSize="small" [(ngModel)]="dateEnd" name="dateEnd"></nz-date-picker>
              </nz-form-control>
            </nz-form-item>

            <!-- Nhân viên -->
            <nz-form-item class="mt-2">
              <nz-form-label class="fs-12" [nzSpan]="24">Chọn nhân viên</nz-form-label>
              <nz-form-control [nzSpan]="24">
                <nz-select class="w-100 fs-12" nzSize="small" nzShowSearch nzAllowClear
                  nzPlaceHolder="Chọn nhân viên..." [(ngModel)]="employeeID" name="employeeID">
                  <nz-option *ngFor="let emp of emPloyeeLists" [nzLabel]="emp.Code + ' - ' + emp.FullName"
                    [nzValue]="emp.ID"></nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>
            <nz-form-item>
              <nz-form-label [nzSpan]="24">Trạng thái duyệt</nz-form-label>
              <nz-form-control [nzSpan]="24">
                <nz-select class="w-100" [(ngModel)]="selectedApproval" name="isApprovedStatus" nzAllowClear
                  nzSize="small">
                  <nz-option *ngFor="let item of statusData" [nzValue]="item.ID" [nzLabel]="item.Name"></nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>


            <!-- Từ khóa -->
            <nz-form-item class="mt-2">
              <nz-form-label class="fs-12" [nzSpan]="24">Từ khóa</nz-form-label>
              <nz-form-control [nzSpan]="24">
                <input nz-input placeholder="Nhập từ khóa" nzSize="small" [(ngModel)]="filterText" name="filterText" />
              </nz-form-control>
            </nz-form-item>
          </form>
        </div>
        <!-- Footer -->
        <div class="card-footer bg-white p-1 d-flex gap-1 justify-content-end flex-wrap">
          <button nz-button nzType="default" nzSize="small" (click)="resetSearch()">Đặt lại</button>
          <button nz-button nzType="primary" nzSize="small" (click)="getAllocation()">Tìm kiếm</button>
        </div>
      </div>
    </nz-splitter-panel>
    <nz-splitter-panel nzDefaultSize="100%">
      <div class="card h-100 border-0 rounded-0">
        <div class="card-header  bg-white p-1">
          <div class="d-flex h-40  gap-1">
            <button nz-button nzType="default" nzSize="small" (click)="toggleSearchPanel()">
              <nz-icon nzType="search" />
            </button>
            <button class="fs-12 btn-add" nz-button nzType="default" nzSize="small" (click)="onAddAllocation()"
              *hasPermission="'N23,N1'">
              <img src="assets/icon/action_add_item_16.png" /> Thêm
            </button>
            <button class="fs-12 btn-edit" nz-button nzType="default" nzSize="small" (click)="onEditAllocation()"
              *hasPermission="'N23,N1'">
              <img src="assets/icon/action_edit_item_16.png" />Sửa
            </button>
            <button class="fs-12 btn-delete" nz-button nzType="default" nzSize="small" (click)="onDeleteAllocation()"
              *hasPermission="'N23,N1'">
              <img src="assets/icon/action_delete_item_16.png" />Xóa
            </button>
            <div class="btn-group">
              <button class="fs-12" nz-button nzType="default" nzSize="small" nz-dropdown
                [nzDropdownMenu]="menuPerspnal" *hasPermission="''">
                <img src="assets/icon/action_confirm_tbp_16.png" />Cá nhân xác nhận
                <i nz-icon nzType="down"></i>
              </button>
              <button class="fs-12" nz-button nzType="default" nzSize="small" nz-dropdown [nzDropdownMenu]="menuHR"
                *hasPermission="'N23,N1'">
                <img src="assets/icon/action_confirm_tbp_16.png" />HR xác nhận
                <i nz-icon nzType="down"></i>
              </button>
              <button class="fs-12" nz-button nzType="default" nzSize="small" nz-dropdown [nzDropdownMenu]="menuKT"
                *hasPermission="'N67,N1'">
                <img src="assets/icon/action_confirm_tbp_16.png" />KT xác nhận
                <i nz-icon nzType="down"></i>
              </button>
              <nz-dropdown-menu #menuPerspnal="nzDropdownMenu">
                <ul nz-menu>
                  <li nz-menu-item (click)="updateApprove(1)">
                    <img src="assets/icon/action_approved_16.png" />
                    <span class="ms-1">Cá nhân duyệt</span>
                  </li>
                  <li nz-menu-item (click)="updateApprove(2)">
                    <img src="assets/icon/action_unapproved_16.png" />
                    <span class="ms-1">Cá nhân hủy duyệt</span>
                  </li>

                </ul>

              </nz-dropdown-menu>
              <nz-dropdown-menu #menuHR="nzDropdownMenu">
                <ul nz-menu>
                  <li nz-menu-item (click)="updateApprove(3)">
                    <img src="assets/icon/action_approved_16.png" />
                    <span class="ms-1">HR duyệt</span>
                  </li>
                  <li nz-menu-item (click)="updateApprove(4)">
                    <img src="assets/icon/action_unapproved_16.png" />
                    <span class="ms-1">HR hủy duyệt</span>
                  </li>

                </ul>

              </nz-dropdown-menu>
              <nz-dropdown-menu #menuKT="nzDropdownMenu">
                <ul nz-menu>
                  <li nz-menu-item (click)="updateApprove(5)">
                    <img src="assets/icon/action_approved_16.png" />
                    <span class="ms-1">Kế toán duyệt</span>
                  </li>
                  <li nz-menu-item (click)="updateApprove(6)">
                    <img src="assets/icon/action_unapproved_16.png" />
                    <span class="ms-1">Kế toán hủy duyệt</span>
                  </li>

                </ul>

              </nz-dropdown-menu>

            </div>
            <button class="fs-12" nz-button nzType="default" nzSize="small" (click)="exportAllocationAssetReport()">
              <img src="assets/icon/action_export_excel_16.png" />Xuất Phiếu
            </button>
                 <button class="fs-12" nz-button nzType="default" nzSize="small" (click)="getAllocation()">
              <img src="assets/icon/btn_refresh.png" />Refresh
            </button>
          </div>
        </div>

        <div class="card-body p-0" style="height: calc(100vh - 150px); display: flex; flex-direction: column;">
          <nz-spin [nzSpinning]="isLoading" nzTip="Đang tải dữ liệu..." style="height: 100%;">
          <nz-splitter nzLayout="vertical" style="height: 100%; flex: 1;">
            <!-- Bảng Master - Cấp phát (ở trên) - 60% -->
            <nz-splitter-panel [nzCollapsible]="false" [nzResizable]="false" nzSize="60%">
              <div class="grid-container" id="grid-container-allocation" style="height: 100%;">
                <angular-slickgrid
                  gridId="grvAssetAllocation"
                  [columns]="columnDefinitions"
                  [options]="gridOptions"
                  [dataset]="dataset"
                  (onAngularGridCreated)="angularGridReady($event.detail)"
                  (onSelectedRowsChanged)="handleRowSelection($event.detail.eventData, $event.detail.args)"
                  (onClick)="onCellClicked($event.detail.eventData, $event.detail.args)">
                </angular-slickgrid>
              </div>
            </nz-splitter-panel>

            <!-- Bảng Detail - Chi tiết cấp phát (ở dưới) - 40% -->
            <nz-splitter-panel [nzCollapsible]="false" [nzResizable]="false" nzSize="40%">
              <div style="height: 100%; display: flex; flex-direction: column;">
                <nz-tabset style="padding-left: 10px; flex: 1; display: flex; flex-direction: column; min-height: 0;">
                  <nz-tab [nzTitle]="detailTabTitle" style="height: 100%;">
                    <div id="grid-container-allocation-detail" style="height: 100%; width: 100%;">
                      <angular-slickgrid
                        gridId="grvAllocationDetail"
                        [columns]="columnDefinitionsDetail"
                        [options]="gridOptionsDetail"
                        [dataset]="datasetDetail"
                        (onAngularGridCreated)="angularGridDetailReady($event.detail)">
                      </angular-slickgrid>
                    </div>
                  </nz-tab>
                </nz-tabset>
              </div>
            </nz-splitter-panel>
          </nz-splitter>
        </nz-spin>
        </div>
      </div>
    </nz-splitter-panel>
  </nz-splitter>
</ng-container>