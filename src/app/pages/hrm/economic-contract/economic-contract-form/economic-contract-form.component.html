<div class="modal-header bg-primary p-2">
    <h6 class="modal-title text-white">{{ isEdit ? 'SỬA HỢP ĐỒNG KINH TẾ' : 'THÊM HỢP ĐỒNG KINH TẾ' }}</h6>
    <button type="button" class="btn-close" aria-label="Close" (click)="onCancel()"></button>
</div>

<div class="modal-body p-1" style="max-height: 70vh; overflow-y: auto; overflow-x: hidden;">
    <form nz-form [formGroup]="form" class="row g-3">
        <nz-row [nzGutter]="5">
            <nz-col [nzXs]="24" [nzSm]="24" [nzMd]="24">
                <fieldset class="reset mt-2">
                    <legend class="reset fs-12 p-0">THÔNG TIN CƠ BẢN</legend>
                    <nz-row [nzGutter]="16">
                        <nz-col [nzXs]="24" [nzSm]="12" [nzMd]="8">
                            <nz-form-item class="col-md-12">
                                <nz-form-label [nzSpan]="24">Số hợp đồng<span class="text-danger ps-1 me-1">
                                        (*)</span></nz-form-label>
                                <nz-form-control [nzSpan]="24" nzErrorTip="Vui lòng nhập số hợp đồng">
                                    <input nz-input formControlName="ContractNumber" placeholder="Nhập số hợp đồng" />
                                </nz-form-control>
                            </nz-form-item>
                        </nz-col>
                        <nz-col [nzXs]="24" [nzSm]="12" [nzMd]="8">
                            <nz-form-item class="col-md-12">
                                <nz-form-label [nzSpan]="24">Loại NCC/KH<span class="text-danger ps-1 me-1">
                                        (*)</span></nz-form-label>
                                <nz-form-control [nzSpan]="24">
                                    <nz-select formControlName="TypeNCC" nzPlaceHolder="Chọn loại" class="w-100">
                                        @for (item of typeNCCOptions; track item.value) {
                                        <nz-option [nzLabel]="item.label" [nzValue]="item.value"></nz-option>
                                        }
                                    </nz-select>
                                </nz-form-control>
                            </nz-form-item>
                        </nz-col>
                        <nz-col [nzXs]="24" [nzSm]="12" [nzMd]="8">
                            <nz-form-item class="col-md-12">
                                <nz-form-label [nzSpan]="24">Loại hợp đồng<span class="text-danger p-0 me-1">
                                        (*)</span> <button nz-button nzSize="small"
                                        style="width: 20px !important; height: 20px !important"
                                        class="fs-12 button button-succes" title="Thêm loại hợp đồng"
                                        (click)="addContractType()"><nz-icon nzType="plus" />
                                    </button></nz-form-label>
                                <nz-form-control [nzSpan]="24" nzErrorTip="Vui lòng chọn loại hợp đồng">
                                    <nz-select formControlName="EconomicContractTypeID"
                                        nzPlaceHolder="Chọn loại hợp đồng" nzShowSearch nzAllowClear class="w-100">
                                        @for (item of contractTypes; track item.ID) {
                                        <nz-option [nzLabel]="item.TypeName" [nzValue]="item.ID"></nz-option>
                                        }
                                    </nz-select>
                                </nz-form-control>
                            </nz-form-item>
                        </nz-col>
                    </nz-row>
                    <nz-row [nzGutter]="16" class="mt-2">

                        <nz-col [nzXs]="24" [nzSm]="24" [nzMd]="24">
                            <nz-form-item class="col-md-12">
                                <nz-form-label [nzSpan]="24">Nội dung hợp đồng<span class="text-danger ps-1 me-1">
                                        (*)</span></nz-form-label>
                                <nz-form-control [nzSpan]="24" nzErrorTip="Vui lòng nhập nội dung hợp đồng">
                                    <textarea nz-input formControlName="ContractContent"
                                        placeholder="Nhập nội dung hợp đồng" rows="2"></textarea>
                                </nz-form-control>
                            </nz-form-item>
                        </nz-col>
                    </nz-row>
                </fieldset>
            </nz-col>
        </nz-row>

        <nz-row [nzGutter]="5">
            <nz-col [nzXs]="24" [nzSm]="24" [nzMd]="24">
                <fieldset class="reset mt-2">
                    <legend class="reset fs-12 p-0">THÔNG TIN NCC/KHÁCH HÀNG</legend>
                    <nz-row [nzGutter]="16">
                        <nz-col [nzXs]="24" [nzSm]="12" [nzMd]="8">
                            <nz-form-item class="col-md-12">
                                <nz-form-label [nzSpan]="24">Tên NCC/KH<span class="text-danger ps-1 me-1">
                                        (*)</span></nz-form-label>
                                <nz-form-control [nzSpan]="24" nzErrorTip="Vui lòng nhập tên NCC/KH">
                                    <input nz-input formControlName="NameNcc" placeholder="Nhập tên NCC/Khách hàng" />
                                </nz-form-control>
                            </nz-form-item>
                        </nz-col>
                        <nz-col [nzXs]="24" [nzSm]="12" [nzMd]="8">
                            <nz-form-item class="col-md-12">
                                <nz-form-label [nzSpan]="24">MST</nz-form-label>
                                <nz-form-control [nzSpan]="24">
                                    <input nz-input formControlName="MSTNcc" placeholder="Nhập mã số thuế" />
                                </nz-form-control>
                            </nz-form-item>
                        </nz-col>
                        <nz-col [nzXs]="24" [nzSm]="12" [nzMd]="8">
                            <nz-form-item class="col-md-12">
                                <nz-form-label [nzSpan]="24">SĐT</nz-form-label>
                                <nz-form-control [nzSpan]="24">
                                    <input nz-input formControlName="SDTNcc" placeholder="Nhập số điện thoại" />
                                </nz-form-control>
                            </nz-form-item>
                        </nz-col>
                    </nz-row>
                    <nz-row [nzGutter]="16" class="mt-2">
                        <nz-col [nzXs]="24" [nzSm]="12" [nzMd]="8">
                            <nz-form-item class="col-md-12">
                                <nz-form-label [nzSpan]="24">Email</nz-form-label>
                                <nz-form-control [nzSpan]="24" nzErrorTip="Email không hợp lệ">
                                    <input nz-input formControlName="EmailNcc" placeholder="Nhập email" />
                                </nz-form-control>
                            </nz-form-item>
                        </nz-col>
                        <nz-col [nzXs]="24" [nzSm]="24" [nzMd]="16">
                            <nz-form-item class="col-md-12">
                                <nz-form-label [nzSpan]="24">Địa chỉ</nz-form-label>
                                <nz-form-control [nzSpan]="24">
                                    <input nz-input formControlName="AddressNcc" placeholder="Nhập địa chỉ" />
                                </nz-form-control>
                            </nz-form-item>
                        </nz-col>
                    </nz-row>
                </fieldset>
            </nz-col>
        </nz-row>

        <nz-row [nzGutter]="5">
            <nz-col [nzXs]="24" [nzSm]="24" [nzMd]="24">
                <fieldset class="reset mt-2">
                    <legend class="reset fs-12 p-0">THÔNG TIN TÀI CHÍNH & THỜI HẠN</legend>
                    <nz-row [nzGutter]="16">
                        <nz-col [nzXs]="24" [nzSm]="12" [nzMd]="6">
                            <nz-form-item class="col-md-12">
                                <nz-form-label [nzSpan]="24">Giá trị ký<span class="text-danger ps-1 me-1">
                                        (*)</span></nz-form-label>
                                <nz-form-control [nzSpan]="24" nzErrorTip="Vui lòng nhập giá trị ký">
                                    <nz-input-number formControlName="SignedAmount" [nzMin]="0" [nzStep]="1000000"
                                        class="w-100" [nzFormatter]="formatterNumber" [nzParser]="parserNumber">
                                    </nz-input-number>
                                </nz-form-control>
                            </nz-form-item>
                        </nz-col>
                        <nz-col [nzXs]="24" [nzSm]="12" [nzMd]="6">
                            <nz-form-item class="col-md-12">
                                <nz-form-label [nzSpan]="24">Loại tiền</nz-form-label>
                                <nz-form-control [nzSpan]="24">
                                    <nz-select formControlName="MoneyType" class="w-100">
                                        @for (item of moneyTypes; track item.value) {
                                        <nz-option [nzLabel]="item.label" [nzValue]="item.value"></nz-option>
                                        }
                                    </nz-select>
                                </nz-form-control>
                            </nz-form-item>
                        </nz-col>
                        <nz-col [nzXs]="24" [nzSm]="12" [nzMd]="6">
                            <nz-form-item class="col-md-12">
                                <nz-form-label [nzSpan]="24">Ngày ký<span class="text-danger ps-1 me-1">
                                        (*)</span></nz-form-label>
                                <nz-form-control [nzSpan]="24" nzErrorTip="Vui lòng chọn ngày ký">
                                    <nz-date-picker class="w-100" formControlName="SignDate"
                                        nzFormat="dd/MM/yyyy"></nz-date-picker>
                                </nz-form-control>
                            </nz-form-item>
                        </nz-col>
                        <nz-col [nzXs]="24" [nzSm]="12" [nzMd]="6">
                            <nz-form-item class="col-md-12">
                                <nz-form-label [nzSpan]="24">Trạng thái<span class="text-danger ps-1 me-1">
                                        (*)</span></nz-form-label>
                                <nz-form-control [nzSpan]="24" nzErrorTip="Vui lòng chọn trạng thái">
                                    <nz-select formControlName="StatusContract" class="w-100">
                                        @for (item of statusOptions; track item.value) {
                                        <nz-option [nzLabel]="item.label" [nzValue]="item.value"></nz-option>
                                        }
                                    </nz-select>
                                </nz-form-control>
                            </nz-form-item>
                        </nz-col>
                    </nz-row>
                    <nz-row [nzGutter]="16" class="mt-2">
                        <nz-col [nzXs]="24" [nzSm]="12" [nzMd]="6">
                            <nz-form-item class="col-md-12">
                                <nz-form-label [nzSpan]="24">Hiệu lực từ</nz-form-label>
                                <nz-form-control [nzSpan]="24">
                                    <nz-date-picker class="w-100" formControlName="EffectDateFrom"
                                        nzFormat="dd/MM/yyyy"></nz-date-picker>
                                </nz-form-control>
                            </nz-form-item>
                        </nz-col>
                        <nz-col [nzXs]="24" [nzSm]="12" [nzMd]="6">
                            <nz-form-item class="col-md-12">
                                <nz-form-label [nzSpan]="24">Hiệu lực đến</nz-form-label>
                                <nz-form-control [nzSpan]="24">
                                    <nz-date-picker class="w-100" formControlName="EffectDateTo"
                                        nzFormat="dd/MM/yyyy"></nz-date-picker>
                                </nz-form-control>
                            </nz-form-item>
                        </nz-col>
                        <nz-col [nzXs]="24" [nzSm]="12" [nzMd]="6">
                            <nz-form-item class="col-md-12">
                                <nz-form-label [nzSpan]="24">Đơn vị thời gian<span class="text-danger ps-1 me-1">
                                        (*)</span></nz-form-label>
                                <nz-form-control [nzSpan]="24" nzErrorTip="Vui lòng chọn đơn vị thời gian">
                                    <nz-select formControlName="TimeUnit" nzPlaceHolder="Chọn đơn vị thời gian"
                                        class="w-100">
                                        @for (item of timeUnitOptions; track item.value) {
                                        <nz-option [nzLabel]="item.label" [nzValue]="item.value"></nz-option>
                                        }
                                    </nz-select>
                                </nz-form-control>
                            </nz-form-item>
                        </nz-col>


                        <nz-col [nzXs]="24" [nzSm]="12" [nzMd]="6">
                            <nz-form-item class="col-md-12">
                                <nz-form-label [nzSpan]="24">Điều khoản<span class="text-danger ps-1 me-1">
                                        (*)</span> <button nz-button nzSize="small"
                                        style="width: 20px !important; height: 20px !important"
                                        class="fs-12 button button-succes me-2" title="Thêm điều khoản"
                                        (click)="addContractTerm()"><nz-icon nzType="plus" />
                                    </button></nz-form-label>
                                <nz-form-control [nzSpan]="24" nzErrorTip="Vui lòng chọn điều khoản">
                                    <nz-select formControlName="EconomicContractTermID" nzPlaceHolder="Chọn điều khoản"
                                        nzShowSearch nzAllowClear class="w-100">
                                        @for (item of contractTerms; track item.ID) {
                                        <nz-option [nzLabel]=" item.TermName" [nzValue]="item.ID"></nz-option>
                                        }
                                    </nz-select>
                                </nz-form-control>
                            </nz-form-item>
                        </nz-col>
                    </nz-row>
                    <nz-row>
                        <nz-col [nzXs]="24" [nzSm]="12" [nzMd]="24">
                            <nz-form-item class="col-md-12">
                                <nz-form-label [nzSpan]="24">Điều chỉnh</nz-form-label>
                                <nz-form-control [nzSpan]="24">
                                    <input nz-input formControlName="Adjustment" placeholder="Điều chỉnh" />
                                </nz-form-control>
                            </nz-form-item>
                        </nz-col>

                    </nz-row>
                    <nz-row [nzGutter]="16" class="mt-2">
                        <nz-col [nzXs]="24" [nzSm]="24" [nzMd]="24">
                            <nz-form-item class="col-md-12">
                                <nz-form-label [nzSpan]="24">Ghi chú</nz-form-label>
                                <nz-form-control [nzSpan]="24">
                                    <textarea nz-input formControlName="Note" placeholder="Nhập ghi chú"
                                        rows="2"></textarea>
                                </nz-form-control>
                            </nz-form-item>
                        </nz-col>
                    </nz-row>
                </fieldset>
            </nz-col>
        </nz-row>
    </form>
</div>

<div class="modal-footer">
    <button nz-button nzType="default" nzDanger (click)="onCancel()">Đóng</button>
    <button nz-button nzType="primary" (click)="onSubmit()" [nzLoading]="isLoading">Lưu</button>
</div>