<div class="modal-header primary">
    <h5 class="modal-title">{{ isEdit ? 'Sửa hợp đồng' : 'Thêm hợp đồng' }}</h5>
    <button type="button" class="btn-close" aria-label="Close" (click)="onCancel()"></button>
</div>

<div class="modal-body">
    <form nz-form [formGroup]="form" nzLayout="vertical">
        <!-- Row 1: Thông tin cơ bản -->
        <nz-divider nzText="Thông tin cơ bản" nzOrientation="left"></nz-divider>
        <div nz-row [nzGutter]="16">
            <div nz-col [nzSpan]="8">
                <nz-form-item>
                    <nz-form-label nzRequired>Số hợp đồng</nz-form-label>
                    <nz-form-control nzErrorTip="Vui lòng nhập số hợp đồng">
                        <input nz-input formControlName="ContractNumber" placeholder="Nhập số hợp đồng" />
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="8">
                <nz-form-item>
                    <nz-form-label nzRequired>Loại NCC/KH</nz-form-label>
                    <nz-form-control>
                        <nz-select formControlName="TypeNCC" nzPlaceHolder="Chọn loại">
                            @for (item of typeNCCOptions; track item.value) {
                            <nz-option [nzLabel]="item.label" [nzValue]="item.value"></nz-option>
                            }
                        </nz-select>
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="8">
                <nz-form-item>
                    <nz-form-label>Loại hợp đồng</nz-form-label>
                    <nz-form-control>
                        <nz-select formControlName="EconomicContractTypeID" nzPlaceHolder="Chọn loại hợp đồng"
                            nzShowSearch nzAllowClear>
                            @for (item of contractTypes; track item.ID) {
                            <nz-option [nzLabel]="item.TypeName" [nzValue]="item.ID"></nz-option>
                            }
                        </nz-select>
                    </nz-form-control>
                </nz-form-item>
            </div>
        </div>

        <div nz-row [nzGutter]="16">
            <div nz-col [nzSpan]="8">
                <nz-form-item>
                    <nz-form-label>Điều khoản</nz-form-label>
                    <nz-form-control>
                        <nz-select formControlName="EconomicContractTermID" nzPlaceHolder="Chọn điều khoản" nzShowSearch
                            nzAllowClear>
                            @for (item of contractTerms; track item.ID) {
                            <nz-option [nzLabel]="item.TermCode + ' - ' + item.TermName"
                                [nzValue]="item.ID"></nz-option>
                            }
                        </nz-select>
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="16">
                <nz-form-item>
                    <nz-form-label>Nội dung hợp đồng</nz-form-label>
                    <nz-form-control>
                        <textarea nz-input formControlName="ContractContent" placeholder="Nhập nội dung hợp đồng"
                            [nzAutosize]="{ minRows: 2, maxRows: 4 }"></textarea>
                    </nz-form-control>
                </nz-form-item>
            </div>
        </div>

        <!-- Row 2: Thông tin NCC/KH -->
        <nz-divider nzText="Thông tin NCC/Khách hàng" nzOrientation="left"></nz-divider>
        <div nz-row [nzGutter]="16">
            <div nz-col [nzSpan]="8">
                <nz-form-item>
                    <nz-form-label nzRequired>Tên NCC/KH</nz-form-label>
                    <nz-form-control nzErrorTip="Vui lòng nhập tên">
                        <input nz-input formControlName="NameNcc" placeholder="Nhập tên NCC/Khách hàng" />
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="8">
                <nz-form-item>
                    <nz-form-label>MST</nz-form-label>
                    <nz-form-control>
                        <input nz-input formControlName="MSTNcc" placeholder="Nhập mã số thuế" />
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="8">
                <nz-form-item>
                    <nz-form-label>SĐT</nz-form-label>
                    <nz-form-control>
                        <input nz-input formControlName="SDTNcc" placeholder="Nhập số điện thoại" />
                    </nz-form-control>
                </nz-form-item>
            </div>
        </div>

        <div nz-row [nzGutter]="16">
            <div nz-col [nzSpan]="8">
                <nz-form-item>
                    <nz-form-label>Email</nz-form-label>
                    <nz-form-control nzErrorTip="Email không hợp lệ">
                        <input nz-input formControlName="EmailNcc" placeholder="Nhập email" />
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="16">
                <nz-form-item>
                    <nz-form-label>Địa chỉ</nz-form-label>
                    <nz-form-control>
                        <input nz-input formControlName="AddressNcc" placeholder="Nhập địa chỉ" />
                    </nz-form-control>
                </nz-form-item>
            </div>
        </div>

        <!-- Row 3: Thông tin tài chính -->
        <nz-divider nzText="Thông tin tài chính & Thời hạn" nzOrientation="left"></nz-divider>
        <div nz-row [nzGutter]="16">
            <div nz-col [nzSpan]="8">
                <nz-form-item>
                    <nz-form-label>Giá trị ký</nz-form-label>
                    <nz-form-control>
                        <nz-input-number formControlName="SignedAmount" [nzMin]="0" [nzStep]="1000000"
                            style="width: 100%;" [nzFormatter]="formatterNumber" [nzParser]="parserNumber">
                        </nz-input-number>
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="4">
                <nz-form-item>
                    <nz-form-label>Loại tiền</nz-form-label>
                    <nz-form-control>
                        <nz-select formControlName="MoneyType">
                            @for (item of moneyTypes; track item.value) {
                            <nz-option [nzLabel]="item.label" [nzValue]="item.value"></nz-option>
                            }
                        </nz-select>
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="6">
                <nz-form-item>
                    <nz-form-label>Ngày ký</nz-form-label>
                    <nz-form-control>
                        <nz-date-picker class="w-100" formControlName="SignDate" nzFormat="dd/MM/yyyy"></nz-date-picker>
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="6">
                <nz-form-item>
                    <nz-form-label>Trạng thái</nz-form-label>
                    <nz-form-control>
                        <nz-select formControlName="StatusContract">
                            @for (item of statusOptions; track item.value) {
                            <nz-option [nzLabel]="item.label" [nzValue]="item.value"></nz-option>
                            }
                        </nz-select>
                    </nz-form-control>
                </nz-form-item>
            </div>
        </div>

        <div nz-row [nzGutter]="16">
            <div nz-col [nzSpan]="6">
                <nz-form-item>
                    <nz-form-label>Hiệu lực từ</nz-form-label>
                    <nz-form-control>
                        <nz-date-picker class="w-100" formControlName="EffectDateFrom"
                            nzFormat="dd/MM/yyyy"></nz-date-picker>
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="6">
                <nz-form-item>
                    <nz-form-label>Hiệu lực đến</nz-form-label>
                    <nz-form-control>
                        <nz-date-picker class="w-100" formControlName="EffectDateTo"
                            nzFormat="dd/MM/yyyy"></nz-date-picker>
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="6">
                <nz-form-item>
                    <nz-form-label>Đơn vị thời gian</nz-form-label>
                    <nz-form-control>
                        <input nz-input formControlName="TimeUnit" placeholder="VD: 1 năm, 6 tháng..." />
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="6">
                <nz-form-item>
                    <nz-form-label>Điều chỉnh</nz-form-label>
                    <nz-form-control>
                        <input nz-input formControlName="Adjustment" placeholder="Điều chỉnh" />
                    </nz-form-control>
                </nz-form-item>
            </div>
        </div>

        <!-- Row 4: Ghi chú -->
        <div nz-row [nzGutter]="16">
            <div nz-col [nzSpan]="24">
                <nz-form-item>
                    <nz-form-label>Ghi chú</nz-form-label>
                    <nz-form-control>
                        <textarea nz-input formControlName="Note" placeholder="Nhập ghi chú"
                            [nzAutosize]="{ minRows: 2, maxRows: 4 }"></textarea>
                    </nz-form-control>
                </nz-form-item>
            </div>
        </div>
    </form>
</div>

<div class="modal-footer">
    <button nz-button nzType="default" (click)="onCancel()">
        <span nz-icon nzType="close"></span> Hủy
    </button>
    <button nz-button nzType="primary" (click)="onSubmit()" [nzLoading]="isLoading">
        <span nz-icon nzType="save"></span> Lưu
    </button>
</div>