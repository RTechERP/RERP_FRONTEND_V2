<!-- Main Modal Header -->
<div class="modal-header bg-primary p-2">
  <h6 class="modal-title text-white text-uppercase" id="bonusModalLabel">
    QUẢN LÝ PHỤ PHÍ
  </h6>
  <button type="button" class="btn-close btn-close-white" aria-label="Close" (click)="closeMainModal()"></button>
</div>

<!-- Main Modal Body -->
<div class="modal-body p-0">
  <nz-splitter>
    <nz-splitter-panel nzSize="50%">
      <!-- Vehicle Panel -->
      <div class="card h-100 border-0 rounded-0">
        <div class="card-header bg-white py-2 px-0">
          <div class="d-flex justify-content-between align-items-center">
            <h6 class="mb-0">Phụ cấp phương tiện</h6>
            <div class="d-flex gap-2">
              <button class="btn-add" nz-button nzType="default" nzSize="small" (click)="openVehicleAddModal()">
                <img src="assets/icon/action_add_item_16.png" alt="Thêm" /> Thêm
              </button>
              <button class="btn-edit" nz-button nzType="default" nzSize="small" (click)="openVehicleEditModal()">
                <img src="assets/icon/action_edit_item_16.png" alt="Sửa" /> Sửa
              </button>
              <button class="btn-delete" nz-button nzType="default" nzSize="small" (click)="openVehicleDeleteModal()">
                <img src="assets/icon/action_delete_item_16.png" alt="Xóa" /> Xóa
              </button>
            </div>
          </div>
        </div>
        <div class="card-body p-0 position-relative">
          <div *ngIf="isVehicleLoading">
            <nz-spin [nzSpinning]="isVehicleLoading" nzSimple [style]="{
              position: 'absolute',
              top: '0',
              left: '0',
              width: '100%',
              height: '100%',
              background: 'rgba(255,255,255,0.4)',
              zIndex: '999',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center'
            }"></nz-spin>
          </div>
          <div id="tb_employee_bussiness_vehicle"></div>
        </div>
      </div>
    </nz-splitter-panel>

    <nz-splitter-panel nzSize="50%">
      <!-- Type Panel -->
      <div class="card h-100 border-0 rounded-0">
        <div class="card-header bg-white py-2 px-0">
          <div class="d-flex justify-content-between align-items-center">
            <h6 class="mb-0">Loại phụ cấp công tác</h6>
            <div class="d-flex gap-2">
              <button class="btn-add" nz-button nzType="default" nzSize="small" (click)="openTypeAddModal()">
                <img src="assets/icon/action_add_item_16.png" alt="Thêm" /> Thêm
              </button>
              <button class="btn-edit" nz-button nzType="default" nzSize="small" (click)="openTypeEditModal()">
                <img src="assets/icon/action_edit_item_16.png" alt="Sửa" /> Sửa
              </button>
              <button class="btn-delete" nz-button nzType="default" nzSize="small" (click)="openTypeDeleteModal()">
                <img src="assets/icon/action_delete_item_16.png" alt="Xóa" /> Xóa
              </button>
            </div>
          </div>
        </div>
        <div class="card-body p-0 position-relative">
          <div *ngIf="isTypeLoading">
            <nz-spin [nzSpinning]="isTypeLoading" nzSimple [style]="{
              position: 'absolute',
              top: '0',
              left: '0',
              width: '100%',
              height: '100%',
              background: 'rgba(255,255,255,0.4)',
              zIndex: '999',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center'
            }"></nz-spin>
          </div>
          <div id="tb_employee_bussiness_type"></div>
        </div>
      </div>
    </nz-splitter-panel>
  </nz-splitter>
</div>

<!-- Vehicle Modal -->
<nz-modal [(nzVisible)]="isVehicleModalVisible" [nzTitle]="vehicleModalTitle" (nzOnCancel)="closeVehicleModal()"
  [nzFooter]="vehicleModalFooter" [nzWidth]="600" nzClassName="custom-modal">
  <ng-container *nzModalContent>
    <app-vehicle-form #vehicleForm [vehicleData]="selectedVehicle" [isEditMode]="isVehicleEditMode"
      (formSubmit)="onSubmitVehicle($event)" (formCancel)="closeVehicleModal()">
    </app-vehicle-form>
  </ng-container>
</nz-modal>

<ng-template #vehicleModalTitle>
  <span class="text-white">{{ isVehicleEditMode ? 'Sửa phụ cấp phương tiện' : 'Thêm phụ cấp phương tiện' }}</span>
</ng-template>

<ng-template #vehicleModalFooter>
  <div class="d-flex align-items-center justify-content-between flex-wrap w-100">
    <!-- Loading spinner -->
    <div *ngIf="isVehicleSubmitting" class="d-flex align-items-center">
      <nz-spin nzSimple nzSize="small" class="me-2"></nz-spin>
      <span class="fs-12">Đang lưu...</span>
    </div>
    <div *ngIf="!isVehicleSubmitting"></div>

    <!-- Buttons aligned to right -->
    <div class="d-flex gap-1">
      <!-- Close button -->
      <button nz-button nzType="default" nzDanger (click)="closeVehicleModal()" [disabled]="isVehicleSubmitting">
        Đóng
      </button>

      <!-- Save button -->
      <button nz-button nzType="primary" (click)="vehicleForm.onSubmit()" [disabled]="isVehicleSubmitting">
        <span *ngIf="isVehicleSubmitting" class="spinner-border spinner-border-sm me-2"></span>
        {{ isVehicleSubmitting ? 'Đang lưu...' : 'Lưu' }}
      </button>
    </div>
  </div>
</ng-template>

<!-- Type Modal -->
<nz-modal [(nzVisible)]="isTypeModalVisible" [nzTitle]="typeModalTitle" (nzOnCancel)="closeTypeModal()"
  [nzFooter]="typeModalFooter" [nzWidth]="600" nzClassName="custom-modal">
  <ng-container *nzModalContent>
    <app-type-form #typeForm [typeData]="selectedType" [isEditMode]="isTypeEditMode" (formSubmit)="onSubmitType($event)"
      (formCancel)="closeTypeModal()">
    </app-type-form>
  </ng-container>
</nz-modal>

<ng-template #typeModalTitle>
  <span class="text-white">{{ isTypeEditMode ? 'Sửa loại phụ cấp công tác' : 'Thêm loại phụ cấp công tác' }}</span>
</ng-template>

<ng-template #typeModalFooter>
  <div class="d-flex align-items-center justify-content-between flex-wrap w-100">
    <!-- Loading spinner -->
    <div *ngIf="isTypeSubmitting" class="d-flex align-items-center">
      <nz-spin nzSimple nzSize="small" class="me-2"></nz-spin>
      <span class="fs-12">Đang lưu...</span>
    </div>
    <div *ngIf="!isTypeSubmitting"></div>

    <!-- Buttons aligned to right -->
    <div class="d-flex gap-1">
      <!-- Close button -->
      <button nz-button nzType="default" nzDanger (click)="closeTypeModal()" [disabled]="isTypeSubmitting">
        Đóng
      </button>

      <!-- Save button -->
      <button nz-button nzType="primary" (click)="typeForm.onSubmit()" [disabled]="isTypeSubmitting">
        <span *ngIf="isTypeSubmitting" class="spinner-border spinner-border-sm me-2"></span>
        {{ isTypeSubmitting ? 'Đang lưu...' : 'Lưu' }}
      </button>
    </div>
  </div>
</ng-template>