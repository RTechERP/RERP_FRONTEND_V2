<div class="modal-dialog-scrollable">
  <div class="modal-header bg-primary align-items-center ps-2">
    <h6 class="text-light text-uppercase m-0" style="padding: 0, 5rem">
      CHI TIẾT CÔNG TÁC
    </h6>
    <button type="button" class="btn-close " (click)="activeModal.close()" aria-label="Close"></button>
  </div>

  <div class="modal-body p-2 w-100 pt-0">
    <div class="card h-100 border-0 rounded-0">
      <div class="card-header bg-white" style="padding-left: 0;">
        <div class="card-body p-0">
          <form [formGroup]="searchForm" class="d-flex gap-2 align-items-center">
            <div class="d-flex">
              <nz-form-label>Nhân viên</nz-form-label>
              <nz-form-control>
                <nz-select formControlName="employeeId" nzPlaceHolder="Chọn nhân viên" nzAllowClear nzShowSearch
                  [nzFilterOption]="filterEmployeeOption"
                  nzSize="small" style="width: 15vw;">
                  <nz-option-group *ngFor="let group of employeeGroups" [nzLabel]="group.label">
                    <nz-option
                      *ngFor="let emp of group.options"
                      [nzLabel]="emp.Code + ' - ' + emp.FullName"
                      [nzValue]="emp.ID"
                    >
                      <div>
                        <span>{{ emp.Code }}</span>
                        <span> - {{ emp.FullName }}</span>
                        <small class="text-muted d-block">{{ emp.DepartmentName }}</small>
                      </div>
                    </nz-option>
                  </nz-option-group>
                </nz-select>
              </nz-form-control>
            </div>
            <div class="d-flex">
              <nz-form-label>Người duyệt</nz-form-label>
              <nz-form-control>
                <nz-select formControlName="approverId" nzPlaceHolder="Chọn người duyệt" nzAllowClear nzShowSearch nzSize="small"
                  [nzFilterOption]="filterApproverOption"
                  style="width: 15vw;">
                  <nz-option
                    *ngFor="let appr of approverList"
                    [nzLabel]="appr.Code + ' - ' + appr.FullName"
                    [nzValue]="appr.EmployeeID"
                  >
                
                  </nz-option>
                </nz-select>
              </nz-form-control>
            </div>
            <div class="d-flex align-items-center">
              <label nz-checkbox [nzChecked]="isProblem" (nzCheckedChange)="onIsProblemChange($event)">
                Đăng ký bổ sung
              </label>
            </div>
            <div class="d-flex">
              <nz-form-label>Ngày
              </nz-form-label>
              <nz-form-control>
                <nz-date-picker formControlName="dateRegister" nzFormat="dd/MM/yyyy" [nzSize]="'small'"
                  nzAllowClear="false"></nz-date-picker>
              </nz-form-control>
            </div>
            <div class="d-flex align-items-center gap-2">
              <nz-form-label>File đính kèm</nz-form-label>
              <nz-upload
                [nzBeforeUpload]="beforeUpload"
                [nzFileList]="fileList"
                [nzShowUploadList]="false">
                <button nz-button nzSize="small" type="button">
                  <span nz-icon nzType="upload"></span>
                  Chọn file
                </button>
              </nz-upload>
              <span *ngIf="attachFileName" class="text-primary" style="font-size: 12px;">
                {{ attachFileName }}
                <span nz-icon nzType="close" class="text-danger cursor-pointer ms-1" 
                  (click)="removeFile()" title="Xóa file"></span>
              </span>
              <ng-container *ngIf="existingFiles.length > 0">
                <span *ngFor="let file of existingFiles" class="text-success" style="font-size: 12px;">
                  {{ file.FileName || file.OriginPath }}
                  <span nz-icon nzType="close" class="text-danger cursor-pointer ms-1" 
                    (click)="deleteExistingFile(file.ID)" title="Xóa file"></span>
                </span>
              </ng-container>
            </div>
          </form>
        </div>
      </div>
      <div class="card-body p-0 position-relative">
        <div *ngIf="isLoading">
          <nz-spin [nzSpinning]="isLoading" nzSimple [style]="{
            position: 'absolute',
            top: '0',
            left: '0',
            width: '100%',
            height: '100%',
            background: 'rgba(255,255,255,0.4)',
            zIndex: '999',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center'
          }"></nz-spin>
        </div>
        <div #tbEmployeeBussinessDetail id="tb_employee_bussiness_detail"></div>
      </div>

    </div>
  </div>

</div>

<div class="modal-footer br p-1 d-flex align-items-center">
  <div class="d-flex align-items-center flex-wrap gap-1">
    <button type="button" class="btn btn-outline-danger" style="border: 1px solid; border-radius: 0;"
      (click)="activeModal.dismiss()" [disabled]="isSaving">
      Đóng
    </button>
    <button type="button" style="border-radius: 0;" class="btn btn-primary" (click)="onSubmit()" [disabled]="isSaving">
      <span *ngIf="!isSaving">Lưu</span>
      <span *ngIf="isSaving">
        <nz-spin nzSimple [nzSize]="'small'" style="margin-right: 4px;"></nz-spin>
        Đang lưu...
      </span>
    </button>
  </div>
</div>