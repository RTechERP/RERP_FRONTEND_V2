<div class="modal-dialog-scrollable">
  <div class="modal-header bg-primary p-2">
    <h6 class="modal-title text-white" id="curricularModalLabel">{{ modalTitle }}</h6>
    <button type="button" class="btn-close" aria-label="Close" (click)="closeModal()"></button>
  </div>

  <div class="modal-body">
    <form [formGroup]="curricularForm" nz-form nzLayout="vertical">
      <!-- Row 1: Nhân viên và Ngày -->
      <nz-row [nzGutter]="[24, 16]">
        <nz-col [nzSpan]="12">
          <nz-form-item class="pt-1">
            <nz-form-label class="fs-12 d-flex align-items-center">
              Nhân viên <span class="text-danger ps-1">(*)</span>
            </nz-form-label>
            <nz-form-control [nzErrorTip]="hasError('employeeId') ? getErrorMessage('employeeId') : undefined">
              <nz-select
                formControlName="employeeId"
                class="w-100"
                nzShowSearch
                nzAllowClear
                nzPlaceHolder="Chọn nhân viên"
                [nzFilterOption]="filterEmployeeOption"
                [nzDisabled]="isFormDisabled"
                [class.ng-invalid]="hasError('employeeId')"
              >
                <nz-option-group *ngFor="let group of employeeGroups" [nzLabel]="group.label">
                  <nz-option
                    *ngFor="let option of group.options"
                    nzCustomContent="true"
                    [nzLabel]="option.item.Code + ' - ' + option.item.FullName"
                    [nzValue]="option.item.ID"
                  >
                    <div class="employee-option">
                      <span class="employee-code">{{ option.item.Code }}</span>
                      <span class="employee-name"> - {{ option.item.FullName }}</span>
                    </div>
                  </nz-option>
                </nz-option-group>
              </nz-select>
            </nz-form-control>
          </nz-form-item>
        </nz-col>
        <nz-col [nzSpan]="12">
          <nz-form-item class="pt-1">
            <nz-form-label class="fs-12 d-flex align-items-center">
              Ngày <span class="text-danger ps-1">(*)</span>
            </nz-form-label>
            <nz-form-control [nzErrorTip]="hasError('date') ? getErrorMessage('date') : undefined">
              <nz-date-picker
                formControlName="date"
                class="w-100"
                nzPlaceHolder="Chọn ngày"
                [nzDisabled]="isFormDisabled"
                [class.ng-invalid]="hasError('date')"
                nzFormat="dd/MM/yyyy"
              ></nz-date-picker>
            </nz-form-control>
          </nz-form-item>
        </nz-col>
      </nz-row>

      <!-- Row 2: Mã ngoại khóa -->
      <nz-row [nzGutter]="[24, 16]">
        <nz-col [nzSpan]="24">
          <nz-form-item class="pt-1">
            <nz-form-label class="fs-12 d-flex align-items-center">
              Mã ngoại khóa <span class="text-danger ps-1">(*)</span>
            </nz-form-label>
            <nz-form-control [nzErrorTip]="hasError('curricularCode') ? getErrorMessage('curricularCode') : undefined">
              <input
                formControlName="curricularCode"
                nz-input
                placeholder="Nhập mã ngoại khóa"
                [disabled]="isFormDisabled"
                [class.ng-invalid]="hasError('curricularCode')"
              />
            </nz-form-control>
          </nz-form-item>
        </nz-col>
      </nz-row>

      <!-- Row 3: Tên ngoại khóa -->
      <nz-row [nzGutter]="[24, 16]">
        <nz-col [nzSpan]="24">
          <nz-form-item class="pt-1">
            <nz-form-label class="fs-12 d-flex align-items-center">
              Tên ngoại khóa <span class="text-danger ps-1">(*)</span>
            </nz-form-label>
            <nz-form-control [nzErrorTip]="hasError('curricularName') ? getErrorMessage('curricularName') : undefined">
              <textarea
                formControlName="curricularName"
                nz-input
                placeholder="Nhập tên ngoại khóa"
                [disabled]="isFormDisabled"
                [class.ng-invalid]="hasError('curricularName')"
                rows="4"
                maxlength="500"
              ></textarea>
            </nz-form-control>
          </nz-form-item>
        </nz-col>
      </nz-row>

      <!-- Row 4: Ghi chú -->
      <nz-row [nzGutter]="[24, 16]">
        <nz-col [nzSpan]="24">
          <nz-form-item class="pt-1">
            <nz-form-label class="fs-12">Ghi chú</nz-form-label>
            <nz-form-control>
              <textarea
                formControlName="note"
                nz-input
                placeholder="Nhập ghi chú"
                [disabled]="isFormDisabled"
                rows="3"
                maxlength="500"
              ></textarea>
            </nz-form-control>
          </nz-form-item>
        </nz-col>
      </nz-row>
    </form>
  </div>

  <div class="modal-footer br p-1 d-flex align-items-center">
    <div class="d-flex align-items-center flex-wrap gap-1">
      <!-- Loading spinner -->
      <div *ngIf="loading" class="d-flex align-items-center me-2">
        <nz-spin nzSimple nzSize="small" class="me-2"></nz-spin>
        <span class="fs-12">Đang tải...</span>
      </div>

      <!-- Close button -->
      <button
        nz-button
        nzType="default"
        nzDanger
        (click)="closeModal()"
        [disabled]="saving"
      >
        Đóng
      </button>

      <!-- Save button (Add/Edit mode) -->
      <button 
        *ngIf="!isViewMode"
        nz-button
        nzType="primary"
        (click)="saveCurricular()"
        [disabled]="saving"
      >
        <span *ngIf="saving" class="spinner-border spinner-border-sm me-2"></span>
        {{ saving ? 'Đang lưu...' : 'Lưu' }}
      </button>
    </div>
  </div>
</div>