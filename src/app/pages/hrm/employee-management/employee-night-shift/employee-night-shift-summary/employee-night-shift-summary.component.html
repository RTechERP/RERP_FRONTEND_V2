<div class="modal-dialog-scrollable">
  <div class="modal-header bg-primary p-2">
    <h6 class="modal-title text-white m-0">TỔNG HỢP LÀM ĐÊM THEO THÁNG</h6>
    <button type="button" class="btn-close" (click)="closeModal()" aria-label="Close"></button>
  </div>
  <div class="modal-body p-2">
    <nz-splitter style="height: 100%;">
      <nz-splitter-panel *ngIf="isSearchVisible" [nzSize]="'20%'" [nzResizable]="false">
        <div class="card h-100 border-0 rounded-0 d-flex flex-column">
          <!-- Header -->
          <div class="card-header bg-white p-1 flex-shrink-0">
            <div class="d-flex justify-content-between align-items-center">
              <h6 class="m-0 ms-2">Tìm kiếm</h6>
              <button class="border-0 me-2" nz-button nzSize="small" nzType="default" nzDanger
                (click)="toggleSearchPanel()">
                <nz-icon nzType="close" nzTheme="outline"></nz-icon>
              </button>
            </div>
          </div>
          <!-- Body -->
          <div class="card-body flex-grow-1 overflow-auto">
            <form nz-form nzLayout="vertical">
              <nz-form-item class="mt-2">
                <nz-form-label class="fs-12" [nzSpan]="24">Năm</nz-form-label>
                <nz-form-control [nzSpan]="24">
                  <nz-select class="w-100 fs-12" nzSize="default" nzPlaceHolder="Chọn năm..."
                    [(ngModel)]="selectedYear" (ngModelChange)="onYearMonthChange()" name="selectedYear">
                    <nz-option *ngFor="let year of years" [nzLabel]="year.toString()" [nzValue]="year"></nz-option>
                  </nz-select>
                </nz-form-control>
              </nz-form-item>

              <nz-form-item class="mt-2">
                <nz-form-label class="fs-12" [nzSpan]="24">Tháng</nz-form-label>
                <nz-form-control [nzSpan]="24">
                  <nz-select class="w-100 fs-12" nzSize="default" nzPlaceHolder="Chọn tháng..."
                    [(ngModel)]="selectedMonth" (ngModelChange)="onYearMonthChange()" name="selectedMonth">
                    <nz-option *ngFor="let month of months" [nzLabel]="month.label" [nzValue]="month.value"></nz-option>
                  </nz-select>
                </nz-form-control>
              </nz-form-item>

              <nz-form-item class="mt-2">
                <nz-form-label class="fs-12" [nzSpan]="24">Phòng ban</nz-form-label>
                <nz-form-control [nzSpan]="24">
                  <nz-select class="w-100 fs-12" nzSize="default" nzShowSearch nzAllowClear
                    nzPlaceHolder="Chọn phòng ban..." [(ngModel)]="departmentID" (ngModelChange)="onDepartmentChange()"
                    name="departmentID">
                    <nz-option *ngFor="let dept of departments" [nzLabel]="dept.Name "
                      [nzValue]="dept.ID"></nz-option>
                  </nz-select>
                </nz-form-control>
              </nz-form-item>

              <nz-form-item class="mt-2">
                <nz-form-label class="fs-12" [nzSpan]="24">Nhân viên</nz-form-label>
                <nz-form-control [nzSpan]="24">
                  <nz-select class="w-100 fs-12" nzSize="default" nzShowSearch nzAllowClear
                    nzPlaceHolder="Chọn nhân viên..." [(ngModel)]="employeeID" (ngModelChange)="onEmployeeChange()"
                    name="employeeID">
                    <nz-option-group *ngFor="let group of employees" [nzLabel]="group.label">
                      <nz-option *ngFor="let emp of group.options"
                        [nzLabel]="emp.item.Code + ' - ' + emp.item.FullName" [nzValue]="emp.item.ID"></nz-option>
                    </nz-option-group>
                  </nz-select>
                </nz-form-control>
              </nz-form-item>

              <!-- Từ khóa -->
              <nz-form-item class="mt-2">
                <nz-form-label class="fs-12" [nzSpan]="24">Từ khóa</nz-form-label>
                <nz-form-control [nzSpan]="24">
                  <input nz-input placeholder="Nhập từ khóa" [(ngModel)]="keyWord"
                    (ngModelChange)="onKeywordChange($event)" nzSize="default" name="keyWord" />
                </nz-form-control>
              </nz-form-item>
            </form>
          </div>
          <!-- Footer -->
          <div class="card-footer bg-white p-1 d-flex gap-1 justify-content-end flex-wrap flex-shrink-0">
            <button nz-button nzType="default" nzSize="small" (click)="resetSearch()">Đặt lại</button>
            <button nz-button nzType="primary" nzSize="small" (click)="loadData()">Tìm kiếm</button>
          </div>
        </div>
      </nz-splitter-panel>
      <nz-splitter-panel [nzSize]="isSearchVisible ? '80%' : '100%'">
        <div class="card border-0 rounded-0 h-100 d-flex flex-column">
          <div class="card-header bg-white p-1 flex-shrink-0">
            <div class="d-flex justify-content-between align-items-center">
              <h6 class="m-0 ms-2">Danh sách tổng hợp</h6>
              <div class="d-flex gap-1 align-items-center">
                <button nz-button nzType="default" nzSize="small" (click)="exportToExcel()">
                  <img src="assets/icon/action_export_excel_16.png" alt="Xuất Excel" style="width:16px; height:16px; object-fit:contain" />
                  Xuất Excel
                </button>
                <button nz-button nzType="default" nzSize="small" (click)="toggleSearchPanel()">
                  <nz-icon nzType="search"></nz-icon>
                </button>
              </div>
            </div>
          </div>
          <div class="card-body p-1 position-relative flex-grow-1" style="min-height: 0; height: 100%;">
            <nz-spin [nzSpinning]="isLoading" nzTip="Đang tải dữ liệu..." style="height: 100%;">
              <div #summaryTable style="height: 100%;"></div>
            </nz-spin>
          </div>
        </div>
      </nz-splitter-panel>
    </nz-splitter>
  </div>
</div>
