<ng-container class="w-100">
  <div class="card border-0 rounded-0" style="height: 89vh !important;">
    <!-- Backdrop overlay cho mobile -->
    <div class="filter-backdrop" *ngIf="shouldShowSearchBar && isMobile()" (click)="ToggleSearchPanelNew()"></div>

    <!-- Mobile search toggle button -->
    <div class="mobile-search-toggle d-flex justify-content-end p-2" *ngIf="isMobile()">
      <button nz-button nzType="primary" nzShape="circle" (click)="ToggleSearchPanelNew($event)">
        <nz-icon nzType="search" />
      </button>
    </div>

    <!-- Filter bar - inline layout -->
    <div class="filter-bar bg-light border-bottom p-2" *ngIf="shouldShowSearchBar" [class.mobile-modal]="true">
      <div class="filter-bar-header d-flex justify-content-between align-items-center mb-2" *ngIf="isMobile()">
        <span class="fw-bold fs-12">Tìm kiếm</span>
        <button nz-button nzType="text" nzShape="circle" nzSize="small" nzDanger (click)="ToggleSearchPanelNew()">
          <nz-icon nzType="close" />
        </button>
      </div>
      <form nz-form class="mobile-filter-form">
        <nz-row [nzGutter]="[8, 8]" nzAlign="bottom">
          <!-- Từ ngày -->
          <nz-col [nzXs]="12" [nzSm]="12" [nzMd]="6" [nzLg]="3" [nzXl]="3">
            <nz-form-item class="mb-0">
              <nz-form-label class="fs-12">Từ ngày</nz-form-label>
              <nz-form-control>
                <nz-date-picker [(ngModel)]="DateStart" nzFormat="dd/MM/yyyy" nzSize="small" name="dateStart"
                  class="w-100"></nz-date-picker>
              </nz-form-control>
            </nz-form-item>
          </nz-col>

          <!-- Đến ngày -->
          <nz-col [nzXs]="12" [nzSm]="12" [nzMd]="6" [nzLg]="3" [nzXl]="3">
            <nz-form-item class="mb-0">
              <nz-form-label class="fs-12">Đến ngày</nz-form-label>
              <nz-form-control>
                <nz-date-picker [(ngModel)]="DateEnd" nzFormat="dd/MM/yyyy" nzSize="small" name="dateEnd"
                  class="w-100"></nz-date-picker>
              </nz-form-control>
            </nz-form-item>
          </nz-col>

          <!-- Phòng ban -->
          <nz-col [nzXs]="24" [nzSm]="12" [nzMd]="6" [nzLg]="4" [nzXl]="4">
            <nz-form-item class="mb-0">
              <nz-form-label class="fs-12">Phòng ban</nz-form-label>
              <nz-form-control>
                <nz-select class="w-100" nzSize="small" nzShowSearch nzAllowClear nzPlaceHolder="Chọn phòng ban..."
                  [(ngModel)]="DepartmentID" name="departmentID" [nzFilterOption]="filterOption">
                  <nz-option *ngFor="let item of dataDepartment" [nzLabel]="item.Name" [nzValue]="item.ID"></nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>
          </nz-col>

          <!-- Trạng thái -->
          <nz-col [nzXs]="12" [nzSm]="12" [nzMd]="6" [nzLg]="3" [nzXl]="3">
            <nz-form-item class="mb-0">
              <nz-form-label class="fs-12">Trạng thái</nz-form-label>
              <nz-form-control>
                <nz-select class="w-100" [(ngModel)]="IsApproved" name="isApproved" nzSize="small"
                  nzPlaceHolder="Tất cả...">
                  <nz-option *ngFor="let item of statusData" [nzValue]="item.ID" [nzLabel]="item.Name"></nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>
          </nz-col>

          <!-- Từ khóa và nút tìm kiếm -->
          <nz-col [nzXs]="24" [nzSm]="24" [nzMd]="12" [nzLg]="6" [nzXl]="5">
            <nz-form-item class="mb-0">
              <nz-form-label class="fs-12">Từ khóa</nz-form-label>
              <nz-form-control>
                <div class="d-flex gap-1">
                  <input nz-input placeholder="Nhập từ khóa" [(ngModel)]="Keyword" (keyup.enter)="searchData()"
                    nzSize="small" name="filterText" class="flex-grow-1" />
                  <button nz-button nzType="primary" nzSize="small" style="width: 40px;" (click)="searchData()">
                    <nz-icon nzType="search" />
                  </button>
                  <button nz-button nzType="default" nzSize="small" style="width: 40px;" (click)="resetSearch()">
                    <nz-icon nzType="reload" />
                  </button>
                </div>
              </nz-form-control>
            </nz-form-item>
          </nz-col>
        </nz-row>
      </form>
    </div>

    <!-- Content với bảng -->
    <div class="card-body p-0 position-relative" [class.with-search-bar]="shouldShowSearchBar"
      [class.without-search-bar]="!shouldShowSearchBar"
      style="height: calc(100vh - 160px); display: flex; flex-direction: column;">
      <nz-spin [nzSpinning]="isLoading" nzTip="Đang tải dữ liệu..." style="height: 100%;">
        <nz-tabset class="summary-tabs" [(nzSelectedIndex)]="selectedTabIndex"
          (nzSelectedIndexChange)="onTabChange($event)" style="height: 100%; display: flex; flex-direction: column;">

          <!-- Tab 1: Đăng ký nghỉ -->
          <nz-tab [nzTitle]="'Đăng kí nghỉ (' + datasetOnLeave.length + ')'" [nzForceRender]="true">
            <div class="grid-container" id="grid-on-leave" style="height: 70vh; width: 100%;">
              <angular-slickgrid gridId="grvOnLeave" [columns]="columnsOnLeave" [options]="gridOptionsOnLeave"
                [dataset]="datasetOnLeave" (onAngularGridCreated)="angularGridOnLeaveReady($event.detail)">
              </angular-slickgrid>
            </div>
          </nz-tab>

          <!-- Tab 2: Đi muộn về sớm -->
          <nz-tab [nzTitle]="'Đi muộn về sớm (' + datasetEarlyLate.length + ')'" [nzForceRender]="true">
            <div class="grid-container" id="grid-early-late" style="height: 70vh; width: 100%;">
              <angular-slickgrid gridId="grvEarlyLate" [columns]="columnsEarlyLate" [options]="gridOptionsEarlyLate"
                [dataset]="datasetEarlyLate" (onAngularGridCreated)="angularGridEarlyLateReady($event.detail)">
              </angular-slickgrid>
            </div>
          </nz-tab>

          <!-- Tab 3: Làm thêm -->
          <nz-tab [nzTitle]="'Làm thêm (' + datasetOverTime.length + ')'" [nzForceRender]="true">
            <div class="grid-container" id="grid-over-time" style="height: 70vh; width: 100%;">
              <angular-slickgrid gridId="grvOverTime" [columns]="columnsOverTime" [options]="gridOptionsOverTime"
                [dataset]="datasetOverTime" (onAngularGridCreated)="angularGridOverTimeReady($event.detail)">
              </angular-slickgrid>
            </div>
          </nz-tab>

          <!-- Tab 4: Công tác -->
          <nz-tab [nzTitle]="'Công tác (' + datasetBussiness.length + ')'" [nzForceRender]="true">
            <div class="grid-container" id="grid-bussiness" style="height: 70vh; width: 100%;">
              <angular-slickgrid gridId="grvBussiness" [columns]="columnsBussiness" [options]="gridOptionsBussiness"
                [dataset]="datasetBussiness" (onAngularGridCreated)="angularGridBussinessReady($event.detail)">
              </angular-slickgrid>
            </div>
          </nz-tab>

          <!-- Tab 5: Làm đêm -->
          <nz-tab [nzTitle]="'Làm đêm (' + datasetNightShift.length + ')'" [nzForceRender]="true">
            <div class="grid-container" id="grid-night-shift" style="height: 70vh; width: 100%;">
              <angular-slickgrid gridId="grvNightShift" [columns]="columnsNightShift" [options]="gridOptionsNightShift"
                [dataset]="datasetNightShift" (onAngularGridCreated)="angularGridNightShiftReady($event.detail)">
              </angular-slickgrid>
            </div>
          </nz-tab>

          <!-- Tab 6: Làm việc ở nhà -->
          <nz-tab [nzTitle]="'Làm việc ở nhà (' + datasetWFH.length + ')'" [nzForceRender]="true">
            <div class="grid-container" id="grid-wfh" style="height: 70vh; width: 100%;">
              <angular-slickgrid gridId="grvWFH" [columns]="columnsWFH" [options]="gridOptionsWFH"
                [dataset]="datasetWFH" (onAngularGridCreated)="angularGridWFHReady($event.detail)">
              </angular-slickgrid>
            </div>
          </nz-tab>

          <!-- Tab 7: Quên chấm công -->
          <nz-tab [nzTitle]="'Quên chấm công (' + datasetENF.length + ')'" [nzForceRender]="true">
            <div class="grid-container" id="grid-enf" style="height: 70vh; width: 100%;">
              <angular-slickgrid gridId="grvENF" [columns]="columnsENF" [options]="gridOptionsENF"
                [dataset]="datasetENF" (onAngularGridCreated)="angularGridENFReady($event.detail)">
              </angular-slickgrid>
            </div>
          </nz-tab>

        </nz-tabset>
      </nz-spin>
    </div>
  </div>
</ng-container>