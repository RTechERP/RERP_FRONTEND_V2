<div class="modal-dialog-scrollable">
    <div class="modal-header bg-primary align-items-center ps-2 border-0">
        <h6 class="text-light text-uppercase m-0" style="padding: 0,5rem">
            Báo cáo bảng lương
        </h6>
        <button type="button" class="btn-close" (click)="activeModal.dismiss()" aria-label="Close"></button>
    </div>
    <div class="modal-body pt-0 pb-0 p-0 w-100 h-100">
        <nz-splitter>
            <nz-splitter-panel [nzSize]="sizeSearch" nzResizable="false">
                <div class="card h-100 border-0 rounded-0">
                    <div class="card-header bg-white p-1">
                        <div class="d-flex justify-content-between align-items-center">
                            <h6 class="m-0 ms-2">Tìm kiếm</h6>
                            <button class="border-0 me-2" nz-button nzSize="small" nzType="default" nzDanger
                                (click)="toggleSearchPanel()">
                                <nz-icon nzType="close" nzTheme="outline" />
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <form nz-form nzLayout="vertical">
                            <nz-form-item>
                                <nz-form-label class="fs-12 p-0" [nzSpan]="24">Năm</nz-form-label>
                                <nz-form-control [nzSpan]="24">
                                    <nz-date-picker nzMode="year" [(ngModel)]="year" name="year" class="w-100"
                                        nzAllowClear="false"></nz-date-picker>
                                </nz-form-control>
                            </nz-form-item>
                            <nz-form-item>
                                <nz-form-label [nzSpan]="24" class="fs-12 p-0">
                                    Tháng
                                </nz-form-label>
                                <nz-form-control [nzSpan]="24" nzErrorTip="Vui lòng chọn tháng!">
                                    <nz-select [(ngModel)]="month" name="_Month" class="w-100" nzAllowClear
                                        nzPlaceHolder="Chọn tháng">
                                        @for (i of [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]; track
                                        $index) {
                                        <nz-option class="text-center" [nzValue]="i"
                                            [nzLabel]="'Tháng ' + i"></nz-option>
                                        }
                                    </nz-select>
                                </nz-form-control>
                            </nz-form-item>
                            <nz-form-item>
                                <nz-form-label class="fs-12 p-0" [nzSpan]="24">Nhân viên</nz-form-label>
                                <nz-form-control [nzSpan]="24">
                                    <nz-select name="employeeId" class="w-100" nzShowSearch nzAllowClear
                                        nzPlaceHolder="Chọn nhân viên" [(ngModel)]="employeeId">
                                        @for (parent of employees; track $index) {
                                        <nz-option-group [nzLabel]="parent.label">
                                            @for (child of parent.options; track $index) {
                                            <nz-option nzCustomContent="true" [nzLabel]="child.item.FullName"
                                                [nzValue]="child.item.EmployeeID">{{
                                                child.item.Code + " - " + child.item.FullName
                                                }}</nz-option>
                                            }
                                        </nz-option-group>
                                        }
                                    </nz-select>
                                </nz-form-control>
                            </nz-form-item>
                            <nz-form-item>
                                <nz-form-label class="fs-12 p-0" [nzSpan]="24">Phòng ban</nz-form-label>
                                <nz-form-control [nzSpan]="24">
                                    <nz-select class="w-100" nzShowSearch nzAllowClear nzPlaceHolder="Chọn phòng ban"
                                        [(ngModel)]="departmentId" name="departmentId">
                                        <ng-container *ngFor="let item of departments">
                                            <nz-option [nzLabel]="item.Code +' - '+ item.Name" [nzValue]="item.ID">
                                            </nz-option>
                                        </ng-container>
                                    </nz-select>
                                </nz-form-control>
                            </nz-form-item>
                            <nz-form-item>
                                <nz-form-label class="fs-12 p-0" [nzSpan]="24">Tìm kiếm</nz-form-label>
                                <nz-form-control [nzSpan]="24">
                                    <input name="keyword" [(ngModel)]="keyWord" nz-input placeholder="Nhập từ khóa" />
                                </nz-form-control>
                            </nz-form-item>
                        </form>
                    </div>
                    <div class="card-footer bg-white p-1 d-flex gap-1 justify-content-end">
                        <button nz-button nzType="default" nzSize="small" (click)="resetSearch()"> Đặt lại</button>
                        <button nz-button nzType="primary" nzSize="small" (click)="getPayrollReport()">Tìm kiếm</button>
                    </div>
                </div>
            </nz-splitter-panel>
            <nz-splitter-panel nzDefaultSize="100%">
                <div class="card h-100 border-0 rounded-0">
                    <div class="card-header bg-white p-1">
                        <div class="d-flex gap-1 align-items-center">
                            <!-- Nhóm nút bên trái -->
                            <button nz-button nzType="default" nzSize="small" (click)="toggleSearchPanel()">
                                <nz-icon nzType="search" />
                            </button>
                            <button class="fs-12 btn-edit" nz-button nzType="default" nzSize="small"
                                (click)="handlePayrollDetailAction('edit')">
                                <img src="assets/icon/action_edit_item_16.png" alt="Sửa" />Sửa
                            </button>

                            <button class="fs-12" nz-button nzType="default" nzSize="small" (click)="handlePayrollDetailAction('update')">
                                <img src="assets/icon/action_reset_16.png" alt="Cập nhật" />
                                Cập nhật
                            </button>
                            <button class="fs-12" nz-button nzType="default" nzSize="small" (click)="handlePayrollDetailAction('updateall')">
                                <img src="assets/icon/action_update_db_16.png" alt="Cập nhật tất cả" />
                                Cập nhật tất cả
                            </button>

                            <button class="fs-12" nz-button nzType="default" nzSize="small" (click)="handlePayrollDetailAction('publish')">
                                <img src="assets/icon/action_approved_16.png" alt="Công bố" />
                                Công bố
                            </button>

                            <button class="fs-12" nz-button nzType="default" nzDanger nzSize="small"
                                (click)="handlePayrollDetailAction('unpublish')">
                                <img src="assets/icon/action_unapproved_16.png" alt="Hủy công bố" />
                                Hủy công bố
                            </button>

                            <button class="fs-12" nz-button nzType="default" nzSize="small" (click)="importExcel()">
                                <img src="assets/icon/import-excel.png" alt="Nhập excel" />
                                Nhập Excel
                            </button>

                            <!-- <button class="fs-12" nz-button nzType="default" nzSize="small" (click)="handlePayrollDetailAction('updateall')">
                                <img src="assets/icon/action_update_db_16.png" alt="Nhập excel" />
                                Load dữ liệu tự động
                            </button> -->

                            <button class="fs-12" nz-button nzType="default" nzSize="small" (click)="exportExcel()">
                                <img src="assets/icon/action_export_excel_16.png" alt="Xuất excel" />
                                Xuất Excel
                            </button>
                        </div>
                    </div>

                    <div class="card-body p-0 d-flex align-items-center justify-content-center" style="position: relative">
                        <div *ngIf="isLoadTable">
                            <nz-spin [nzSpinning]="isLoadTable" nzSimple [ngStyle]="{
                                position: 'absolute',
                                top: '0',
                                left: '0',
                                width: '100%',
                                height: '100%',
                                background: 'rgba(255,255,255,0.4)',
                                zIndex: '999',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center'
                            }"></nz-spin>
                        </div>
                        <div #tb_payrollReport></div>
                    </div>
                </div>
            </nz-splitter-panel>
        </nz-splitter>
    </div>
</div>