<div class="modal-header bg-primary text-uppercase py-2 flex-shrink-0" *ngIf="!isEmbedded">
  <h6 class="modal-title text-white">Chi tiết phiếu xuất</h6>
  <button type="button" class="btn-close" (click)="closeModal()" aria-label="Close"></button>
</div>
<div class="modal-body p-2 flex-grow-1 overflow-visible" style="overflow-y: unset;">


  <!-- Đổi sang vertical: label nằm trên input -->
  <form nz-form [nzLayout]="'vertical'" [nzLabelAlign]="'left'" class="mt-2" [formGroup]="validateForm">
    <!-- Hàng 1: 4 cột (Số phiếu, Trạng thái, Loại kho, Kho) -->
    <div nz-row [nzGutter]="16">
      <div nz-col [nzSpan]="18">
        <nz-form-item>
          <nz-form-label [nzSpan]="24" nzRequired>Số phiếu</nz-form-label>
          <nz-form-control [nzSpan]="24">
            <input nz-input [formControlName]="billExportTechnicalProtectiveGearField.Code.field"
              placeholder="Nhập số phiếu!" [readonly]="isCheckmode" />
          </nz-form-control>
        </nz-form-item>
      </div>

      <div nz-col [nzSpan]="6">
        <nz-form-item>
          <nz-form-label class="fs-12" nzRequired>Loại phiếu</nz-form-label>
          <nz-form-control>
            <nz-select [formControlName]="billExportTechnicalProtectiveGearField.BillType.field" nzShowSearch
              nzAllowClear nzPlaceHolder="Chọn loại phiếu" (ngModelChange)="changeStatus()">
              <nz-option *ngFor="let id of cbbStatus" [nzValue]="id.ID" [nzLabel]="id.Name" nzCustomContent>
                {{ id.Name }}
              </nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>

      </div>
      <div nz-col [nzSpan]="18">
        <nz-form-item>
          <nz-form-label class="fs-12">Nhà cung cấp</nz-form-label>
          <nz-form-control>
            <nz-select [formControlName]="billExportTechnicalProtectiveGearField.SupplierSaleID.field" nzShowSearch
              nzAllowClear nzPlaceHolder="Chọn nhà cung cấp">
              <nz-option *ngFor="let id of supplierList" [nzValue]="id.ID" [nzLabel]="id.NameNCC" nzCustomContent>
                {{ id.CodeNCC }} - {{ id.NameNCC }}
              </nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </div>

      <div nz-col [nzSpan]="6">
        <nz-form-item>
          <nz-form-label class="fs-12">Người nhận</nz-form-label>
          <nz-form-control>
            <nz-select [formControlName]="billExportTechnicalProtectiveGearField.ReceiverID.field" nzShowSearch
              nzAllowClear nzPlaceHolder="Chọn người nhận">
              <nz-option *ngFor="let id of receiverAndDeliverList" [nzValue]="id.ID" [nzLabel]="id.FullName"
                nzCustomContent>
                {{ id.FullName }} - {{ id.LoginName }}
              </nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="18">
        <nz-form-item>
          <nz-form-label class="fs-12">Loại kho</nz-form-label>
          <nz-form-control>
            <input [formControlName]="billExportTechnicalProtectiveGearField.WarehouseType.field" nz-input
              placeholder="Nhập loại kho" />
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="6">
        <nz-form-item>
          <nz-form-label class="fs-12">Liên hệ</nz-form-label>
          <nz-form-control>
            <input [formControlName]="billExportTechnicalProtectiveGearField.Deliver.field" nz-input
              placeholder="Nhập liên hệ" />
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="18">
        <nz-form-item>
          <nz-form-label class="fs-12">Dự án</nz-form-label>
          <nz-form-control>
            <input [formControlName]="billExportTechnicalProtectiveGearField.ProjectName.field" nz-input
              placeholder="Nhập dự án" />
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="6">
        <nz-form-item>
          <nz-form-label class="fs-12">Người nhận</nz-form-label>
          <nz-form-control>
            <input [formControlName]="billExportTechnicalProtectiveGearField.Receiver.field" nz-input
              placeholder="Nhập người nhận" />
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="18">
        <nz-form-item>
          <nz-form-label class="fs-12">Khách hàng</nz-form-label>
          <nz-form-control>
            <nz-select [formControlName]="billExportTechnicalProtectiveGearField.CustomerID.field" nzShowSearch
              nzAllowClear nzPlaceHolder="Chọn khách hàng">
              <nz-option *ngFor="let id of customerList" [nzValue]="id.ID" [nzLabel]="id.CustomerName" nzCustomContent>
                {{ id.CustomerCode }} - {{ id.CustomerName }}
              </nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzSpan]="6">
        <nz-form-item>
          <nz-form-label class="fs-12">Ngày xuất</nz-form-label>
          <nz-form-control>
            <nz-date-picker [formControlName]="billExportTechnicalProtectiveGearField.CreatedDate.field"
              [nzFormat]="dateFormat" class="w-100"></nz-date-picker>
          </nz-form-control>
        </nz-form-item>
      </div>
    </div>


  </form>

  <nz-tabset nzSize="small" [nzAnimated]="false" (nzSelectedIndexChange)="onTabChange($event)">
    <nz-tab nzTitle="Danh sách sản phẩm" nzForceRender="true">
      <div class="position-relative" style="height: 38vh;">
        <div #table_BillExportDetails style="height: 100%;"></div>
      </div>
    </nz-tab>
    <!-- <nz-tab nzTitle="Hồ sơ đi kèm" nzForceRender="true">
      <div class="position-relative" style="height: 38vh;">
        <div #table_DocumnetImport style="height: 100%;"></div>
      </div>
    </nz-tab> -->
  </nz-tabset>
  <!-- Product Selection Popup -->
  <div *ngIf="showProductPopup" style="position: fixed; z-index: 10000; min-width: 600px; max-width: 800px;"
    [style.top]="popupPosition.top" [style.left]="popupPosition.left">
    <app-tabulator-popup [data]="productOptions" [columns]="productPopupColumns" [searchFields]="productSearchFields"
      [searchPlaceholder]="'Tìm kiếm sản phẩm...'" [height]="'350px'" (rowSelected)="onProductSelected($event)"
      (closed)="onPopupClosed()"></app-tabulator-popup>
  </div>

</div>

<div class="modal-footer flex-shrink-0">
  <button class="fs-12 btn" nz-button nzDanger (click)="closeModal()" [disabled]="isSaving">Đóng</button>
  <button class="fs-12 btn" nz-button nzType="primary" (click)="saveDataBillExport()" [nzLoading]="isSaving"
    [disabled]="isSaving">Lưu</button>
</div>