<ng-container class="w-100 h-100 d-flex flex-column">
  <div class="card-header bg-white p-1" style="overflow-x: auto; flex-shrink: 0;">
    <div class="d-flex gap-1 align-items-center">
      <button nz-button nzType="default" nzSize="small" class="fs-12 btn-add" (click)="addNewTrackingMark()">
        <img src="assets/icon/action_add_item_16.png" alt="Thêm" />Thêm
      </button>
      <button class="fs-12 btn-edit" nz-button nzType="default" nzSize="small" (click)="openEditModal()">
        <img src="assets/icon/action_edit_item_16.png" alt="Sửa" /> Sửa
      </button>
      <button class="fs-12 btn-delete" nz-button nzType="default" nzSize="small" (click)="onDeleteTrackingMark()">
        <img src="assets/icon/action_delete_item_16.png" alt="Xóa" /> Xóa
      </button>
      <div class="border-start mx-1" style="height: 20px;"></div>
      <button class="fs-12" nz-button nzType="primary" nzSize="small" (click)="batchApprove(1)">
        <span nz-icon nzType="check" nzTheme="outline"></span> Xác nhận hoàn thành
      </button>
      <button class="fs-12" nz-button nzType="default" nzSize="small" nzDanger (click)="batchApprove(2)">
        <span nz-icon nzType="close" nzTheme="outline"></span> Hủy duyệt
      </button>
      <span *ngIf="selectedRows.length > 0" class="ms-2 text-primary" style="font-size: 12px;">
        (Đã chọn: {{selectedRows.length}})
      </span>
      <div class="ms-auto d-flex gap-2 align-items-center" style="font-size: 12px;">
        <div class="d-flex align-items-center gap-1">
          <div style="width: 20px; height: 16px; background-color: #ffcdd2; border: 1px solid #ccc;"></div>
          <span>Hủy duyệt</span>
        </div>
        <div class="d-flex align-items-center gap-1">
          <div style="width: 20px; height: 16px; background-color: #ffe0b2; border: 1px solid #ccc;"></div>
          <span>Đóng dấu gấp</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Filter bar - hiển thị dạng hàng ngang -->
  <div class="filter-bar bg-light border-bottom p-2">
    <form nz-form nzLayout="inline" class="d-flex flex-wrap gap-2 align-items-center">
      <nz-form-item class="mb-0">
        <nz-form-label class="fs-12" style="font-size: 12px; display: flex; align-items: center;">Từ
          ngày</nz-form-label>
        <nz-form-control>
          <nz-date-picker [(ngModel)]="filters.dateStart" name="dateStart" nzFormat="dd/MM/yyyy"
            style="width: 130px; font-size: 12px;" nzSize="small"></nz-date-picker>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item class="mb-0">
        <nz-form-label class="fs-12" style="font-size: 12px; display: flex; align-items: center;">Đến
          ngày</nz-form-label>
        <nz-form-control>
          <nz-date-picker [(ngModel)]="filters.dateEnd" name="dateEnd" nzFormat="dd/MM/yyyy"
            style="width: 130px; font-size: 12px;" nzSize="small"></nz-date-picker>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item class="mb-0">
        <nz-form-label class="fs-12" style="font-size: 12px; display: flex; align-items: center;">Phòng
          ban</nz-form-label>
        <nz-form-control>
          <nz-select name="departmentId" nzShowSearch nzAllowClear nzSize="small" style="width: 180px;"
            nzPlaceHolder="Tất cả" [(ngModel)]="filters.departmentId">
            <nz-option [nzValue]="0" nzLabel="Tất cả"></nz-option>
            <nz-option *ngFor="let dept of departments" [nzValue]="dept.ID" [nzLabel]="dept.Name"></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item class="mb-0">
        <nz-form-label class="fs-12" style="font-size: 12px; display: flex; align-items: center;">Nhân
          viên</nz-form-label>
        <nz-form-control>
          <nz-select name="employeeId" nzShowSearch nzAllowClear nzSize="small" style="width: 200px;"
            nzPlaceHolder="Tất cả" [(ngModel)]="filters.employeeId">
            <nz-option [nzValue]="0" nzLabel="Tất cả"></nz-option>
            <nz-option *ngFor="let emp of employees" [nzValue]="emp.ID"
              [nzLabel]="emp.Code + ' - ' + emp.FullName"></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>

      <!-- Nút tìm kiếm với dropdown cho filter bổ sung -->
      <nz-form-item class="mb-0">
        <nz-form-control>
          <div class="btn-group">
            <button nz-button nzType="primary" nzSize="small" (click)="search()">
              Tìm kiếm
            </button>
            <button nz-button nzType="primary" nzSize="small" nz-dropdown [nzDropdownMenu]="advancedSearchMenu"
              nzTrigger="click" nzPlacement="bottomRight" style="padding-left: 8px; padding-right: 8px;">
              <i nz-icon nzType="down"></i>
            </button>
            <nz-dropdown-menu #advancedSearchMenu="nzDropdownMenu">
              <div class="p-3"
                style="min-width: 400px; background-color: #ffffff; border: 1px solid #d9d9d9; border-radius: 4px; box-shadow: 0 2px 8px rgba(0,0,0,0.15);">
                <form nz-form nzLayout="vertical">
                  <nz-form-item class="mb-2">
                    <nz-form-label class="fs-12">Trạng thái</nz-form-label>
                    <nz-form-control class="w-100">
                      <nz-select name="status" nzSize="small" nzPlaceHolder="Chọn trạng thái" class="w-100"
                        [(ngModel)]="filters.status">
                        <nz-option [nzValue]="-1" nzLabel="Tất cả"></nz-option>
                        <nz-option [nzValue]="0" nzLabel="Chưa hoàn thành"></nz-option>
                        <nz-option [nzValue]="1" nzLabel="Hoàn thành"></nz-option>
                        <nz-option [nzValue]="2" nzLabel="Đã hủy"></nz-option>
                      </nz-select>
                    </nz-form-control>
                  </nz-form-item>

                  <nz-form-item class="mb-0">
                    <nz-form-label class="fs-12">Từ khóa</nz-form-label>
                    <nz-form-control class="w-100">
                      <input nz-input placeholder="Nhập từ khóa" nzSize="small" [(ngModel)]="filters.keyword"
                        name="keyword" style="font-size: 12px;" class="w-100" (keyup.enter)="search()" />
                    </nz-form-control>
                  </nz-form-item>
                </form>
              </div>
            </nz-dropdown-menu>
          </div>
        </nz-form-control>
      </nz-form-item>
    </form>
  </div>

  <!-- Content -->
  <div class="flex-grow-1" style="height: calc(100vh - 150px);">
    <nz-splitter class="h-100">
      <nz-splitter-panel>
        <div #tb_Master id="tb_Master" style="height: 100%;"></div>
      </nz-splitter-panel>
      <nz-splitter-panel [nzSize]="sizeFiles" nzResizable="true">
        <div class="card h-100 border-0 rounded-0">
          <div class="card-header bg-white p-1">
            <div class="d-flex justify-content-between align-items-center">
              <h6 class="m-0 ms-2">File đính kèm</h6>
              <button class="border-0 me-2" nz-button nzSize="small" nzType="default" nzDanger
                (click)="sizeFiles = '0'; filesData = [];">
                <span nz-icon nzType="close" nzTheme="outline"></span>
              </button>
            </div>
          </div>
          <div class="card-body p-0" style="height: calc(100% - 40px);">
            <div #tb_Files id="tb_Files" style="height: 100%;"></div>
          </div>
        </div>
      </nz-splitter-panel>
    </nz-splitter>
  </div>
</ng-container>

<!-- Template cho modal cập nhật ngày dự kiến hoàn thành -->
<ng-template #expectDateCompleteModalContent>
  <div style="padding: 20px;">
    <div class="mb-3">
      <label class="d-block mb-2">Ngày dự kiến hoàn thành:</label>
      <nz-date-picker [(ngModel)]="expectDateCompleteValue" nzFormat="dd/MM/yyyy"
        nzPlaceHolder="Chọn ngày dự kiến hoàn thành" style="width: 100%;">
      </nz-date-picker>
    </div>
  </div>
</ng-template>

<!-- Template cho modal nhập lý do hủy duyệt -->
<ng-template #reasonCancelModalContent>
  <div style="padding: 20px;">
    <div class="mb-3">
      <label class="d-block mb-2">Lý do hủy duyệt <span class="text-danger">(*)</span>:</label>
      <textarea nz-input [(ngModel)]="reasonCancelValue" placeholder="Nhập lý do hủy duyệt" rows="4"
        style="width: 100%;" [ngModelOptions]="{standalone: true}">
      </textarea>
    </div>
  </div>
</ng-template>