<div class="modal-header bg-primary p-2">
    <h6 class="modal-title text-white">BÁO SỬA PHƯƠNG TIỆN</h6>
    <button type="button" class="btn-close" aria-label="Close" (click)="close()"></button>
</div>

<div class="modal-body">
    <form [formGroup]="formGroup" class="row g-3 ">
        <nz-row [nzGutter]="5">
            <nz-col [nzSpan]="12">
                <fieldset class="reset mt-2">
                    <legend class="reset fs-12 p-0">THÔNG TIN XE</legend>
                    <nz-row [nzGutter]="24">
                        <nz-col [nzSpan]="24">
                            <nz-form-item class="col-md-12">
                                <nz-form-label [nzSpan]="24">Chọn xe<span class="text-danger ps-1 me-1"> (*)
                                    </span>
                                </nz-form-label>
                                <nz-form-control [nzErrorTip]="'Chọn xe'">
                                    <nz-input-group required nzSearch nzSize="default" class="w-100">
                                        <nz-select nzSize="default" formControlName="VehicleManagementID"
                                            name="VehicleManagementID" nzPlaceHolder="Chọn xe" class="fs-12 w-100"
                                            required nzShowSearch nzAllowClear>
                                            <nz-option *ngFor="let item of vehicleList" [nzValue]="item.ID"
                                                [nzLabel]="item.STT + ' - ' + item.VehicleName">
                                            </nz-option>
                                        </nz-select>
                                    </nz-input-group>

                                </nz-form-control>
                            </nz-form-item>
                        </nz-col>
                    </nz-row>
                    <nz-row [nzGutter]="24">
                        <nz-col [nzSpan]="24">
                            <nz-form-item class="col-md-12">
                                <nz-form-label [nzSpan]="24">Biển số xe
                                </nz-form-label>
                                <nz-form-control [nzSpan]="24">
                                    <input nz-input formControlName="LicensePlate" readonly />
                                </nz-form-control>
                            </nz-form-item>
                        </nz-col>
                    </nz-row>
                </fieldset>
            </nz-col>
            <nz-col [nzSpan]="12">
                <fieldset class="reset mt-2">
                    <legend class="reset fs-12 p-0">THÔNG TIN LÁI XE</legend>
                    <nz-row [nzGutter]="24">
                        <nz-col [nzSpan]="24">
                            <nz-form-item class="col-md-12">
                                <nz-form-label [nzSpan]="24">Chọn nhân viên<span class="text-danger ps-1 me-1"> (*)
                                    </span>
                                </nz-form-label>
                                <nz-form-control [nzSpan]="24">
                                    <nz-input-group required nzSearch nzSize="default" class="w-100">
                                        <nz-select nzSize="default" formControlName="EmployeeID" name="EmployeeID"
                                            nzPlaceHolder="Chọn nhân viên" class="fs-12 w-100" required nzShowSearch
                                            nzAllowClear>
                                            <nz-option *ngFor="let item of employeeList" [nzValue]="item.ID"
                                                [nzLabel]="item.Code + ' - ' + item.FullName">
                                            </nz-option>
                                        </nz-select>
                                    </nz-input-group>
                                </nz-form-control>
                            </nz-form-item>
                        </nz-col>
                    </nz-row>
                    <nz-row [nzGutter]="24">
                        <nz-col [nzSpan]="6">
                            <nz-form-item class="col-md-12">
                                <nz-form-label [nzSpan]="24">Mã NV<span class="text-danger ps-1 me-1"> (*)
                                    </span></nz-form-label>
                                <nz-form-control [nzSpan]="24">
                                    <input nz-input type="text" formControlName="EmployeeCode" readonly />
                                </nz-form-control>
                            </nz-form-item>
                        </nz-col>
                        <nz-col [nzSpan]="18">
                            <nz-form-item class="col-md-12">
                                <nz-form-label [nzSpan]="24">SDT<span class="text-danger ps-1 "> (*)
                                    </span></nz-form-label>
                                <nz-form-control [nzSpan]="24">
                                    <input nz-input formControlName="SDT" readonly />
                                </nz-form-control>
                            </nz-form-item>
                        </nz-col>
                    </nz-row>

                </fieldset>
            </nz-col>
        </nz-row>
        <nz-row [nzGutter]="5">
            <nz-col [nzSpan]="24">
                <fieldset class="reset mt-2">
                    <legend class="reset fs-12 p-0">THÔNG TIN SỬA CHỮA</legend>
                    <nz-row [nzGutter]="24">
                        <nz-col [nzSpan]="8">
                            <nz-form-item class="col-md-12">
                                <nz-form-label [nzSpan]="24">Loại sửa chữa<span class="text-danger ps-1 me-1"> (*)
                                    </span> <button nz-button nzSize="small" class="fs-12 button button-succes me-2"
                                        title="Thêm loại sửa chữa" (click)="addType()"><nz-icon nzType="plus" />
                                    </button></nz-form-label>
                                <nz-form-control [nzSpan]="24">
                                    <nz-input-group required nzSearch nzSize="default" class="w-100">
                                        <nz-select nzSize="default" formControlName="VehicleRepairTypeID"
                                            name="VehicleRepairTypeID" nzPlaceHolder="Chọn loại sửa chữa"
                                            class="fs-12 w-100" required nzShowSearch nzAllowClear>
                                            <nz-option *ngFor="let item of TypeList" [nzValue]="item.ID"
                                                [nzLabel]="item.STT + ' - ' + item.RepairTypeName">
                                            </nz-option>
                                        </nz-select>
                                    </nz-input-group>
                                </nz-form-control>
                            </nz-form-item>
                        </nz-col>

                        <nz-col [nzSpan]="8">
                            <nz-form-item class="col-md-12">
                                <nz-form-label [nzSpan]="24">CP ước tính<span class="text-danger ps-1 me-1"> (*)
                                    </span></nz-form-label>
                                <nz-form-control [nzSpan]="24" [nzErrorTip]="formGroup.get('CostRepairEstimate')?.invalid && (formGroup.get('CostRepairEstimate')?.dirty || formGroup.get('CostRepairEstimate')?.touched)
          ? 'Vui lòng nhập chi phí ước tính!'
          : undefined">
                                    <input nz-input type="text" placeholder="Nhập Chi phí ước tính"
                                        formControlName="CostRepairEstimate" />
                                </nz-form-control>
                            </nz-form-item>
                        </nz-col>
                        <nz-col [nzSpan]="8">
                            <nz-form-item class="col-md-12">
                                <nz-form-label [nzSpan]="24">CP thực tế<span class="text-danger ps-1 me-1"> (*)
                                    </span></nz-form-label>
                                <nz-form-control [nzSpan]="24" [nzErrorTip]="formGroup.get('CostRepairActual')?.invalid && (formGroup.get('CostRepairActual')?.dirty || formGroup.get('CostRepairActual')?.touched)
          ? 'Vui lòng nhập chi phí thực tế!'
          : undefined">
                                    <input nz-input type="text" placeholder="Nhập chi phí thực tế"
                                        formControlName="CostRepairActual" />
                                </nz-form-control>
                            </nz-form-item>
                        </nz-col>
                    </nz-row>
                    <nz-row [nzGutter]="24">
                        <nz-col [nzSpan]="8">
                            <nz-form-item class="col-md-12">
                                <nz-form-label [nzSpan]="24">Ngày báo sửa<span class="text-danger ps-1 me-1"> (*)
                                    </span></nz-form-label>
                                <nz-form-control [nzSpan]="24"
                                    [nzErrorTip]="formGroup.get('DateReport')?.invalid && (formGroup.get('DateReport')?.dirty || formGroup.get('DateReport')?.touched) ? 'Vui lòng nhập số thứ tự!' : undefined">
                                    <input nz-input type="date" placeholder="Chọn ngày báo sửa"
                                        formControlName="DateReport" />
                                </nz-form-control>
                            </nz-form-item>
                        </nz-col>
                        <nz-col [nzSpan]="8">
                            <nz-form-item class="col-md-12">
                                <nz-form-label [nzSpan]="24">Ngày bắt đầu<span class="text-danger ps-1 me-1"> (*)
                                    </span></nz-form-label>
                                <nz-form-control [nzSpan]="24" [nzErrorTip]="formGroup.get('TimeStartRepair')?.invalid && (formGroup.get('TimeStartRepair')?.dirty || formGroup.get('TimeStartRepair')?.touched)
          ? 'Vui lòng chọn ngày bắt đầu!'
          : undefined">
                                    <input nz-input type="date" placeholder="Chọn ngày bắt đầu"
                                        formControlName="TimeStartRepair" />
                                </nz-form-control>
                            </nz-form-item>
                        </nz-col>
                        <nz-col [nzSpan]="8 ">
                            <nz-form-item class="col-md-12">
                                <nz-form-label [nzSpan]="24">Ngày kết thúc</nz-form-label>
                                <nz-form-control [nzSpan]="24">
                                    <input nz-input type="date" placeholder="Nhập ngày kết thúc"
                                        formControlName="TimeEndRepair" />
                                </nz-form-control>
                            </nz-form-item>
                        </nz-col>
                    </nz-row>
                    <nz-row [nzGutter]="24">


                        <nz-col [nzSpan]="6">
                            <nz-form-item class="col-md-12">
                                <nz-form-label [nzSpan]="24">Tên Gara Sửa chữa<span class="text-danger ps-1 me-1"> (*)
                                    </span></nz-form-label>
                                <nz-form-control [nzSpan]="24" [nzErrorTip]="formGroup.get('RepairGarageName')?.invalid && (formGroup.get('RepairGarageName')?.dirty || formGroup.get('RepairGarageName')?.touched)
          ? 'Vui lòng nhập tên gara sửa chữa!'
          : undefined">
                                    <input nz-input type="text" placeholder="Nhập gara sửa chữa"
                                        formControlName="RepairGarageName" />
                                </nz-form-control>
                            </nz-form-item>
                        </nz-col>
                        <nz-col [nzSpan]="6">
                            <nz-form-item class="col-md-12">
                                <nz-form-label [nzSpan]="24">SĐT Gara<span class="text-danger ps-1 me-1"> (*)
                                    </span></nz-form-label>
                                <nz-form-control [nzErrorTip]="
      formGroup.get('ContactPhone')?.hasError('required') ? 'Bắt buộc' :
      formGroup.get('ContactPhone')?.hasError('phoneVN') ? 'SĐT không hợp lệ' : ''
    ">
                                    <input nz-input placeholder="Nhập SDT gara sửa chữa" formControlName="ContactPhone"
                                        maxlength="12" />
                                </nz-form-control>
                            </nz-form-item>
                        </nz-col>
                        <nz-col [nzSpan]="12">
                            <nz-form-item class="col-md-12">
                                <nz-form-label [nzSpan]="24">
                                    Hóa đơn<span class="text-danger ps-1 me-1"> (*)</span>
                                </nz-form-label>
                                <nz-form-control>
                                    <div style="display: flex; gap: 8px; align-items: center;">

                                        <nz-upload [nzFileList]="fileList" [nzBeforeUpload]="beforeUpload"
                                            [nzShowUploadList]="false" (nzRemove)="onRemove($any($event))">
                                            <button nz-button>
                                                <nz-icon nzType="upload" /> Chọn file
                                            </button>
                                        </nz-upload>

                                    <input nz-input formControlName="FileName" placeholder="Chưa chọn file" readonly />



                                    </div>

                                </nz-form-control>
                            </nz-form-item>
                        </nz-col>
                    </nz-row>
                    <nz-row [nzGutter]="24">
                        <nz-col [nzSpan]="12">
                            <nz-form-item class="col-md-12">
                                <nz-form-label [nzSpan]="24">Lý do sửa chữa<span class="text-danger ps-1 me-1"> (*)
                                    </span>
                                </nz-form-label>
                                <!-- <nz-form-control [nzSpan]="24" [nzErrorTip]="
          formGroup.get('Reason')?.hasError('required') && (formGroup.get('Reason')?.dirty || formGroup.get('Reason')?.touched)
            ? 'Vui lòng nhập lí do sửa chữa'>
                                    <textarea nz-input rows=" 3" placeholder="Nhập lí do sửa chữa"
                                    formControlName="Reason"></textarea>
                                </nz-form-control> -->

                                <nz-form-control [nzSpan]="24" [nzErrorTip]="
    (formGroup.get('Reason')?.hasError('required') &&
     (formGroup.get('Reason')?.dirty || formGroup.get('Reason')?.touched))
      ? 'Vui lòng nhập lý do sửa chữa!'
      : undefined
  ">
                                    <textarea nz-input rows="3" placeholder="Nhập lý do sửa chữa"
                                        formControlName="Reason"></textarea>
                                </nz-form-control>
                            </nz-form-item>
                        </nz-col>
                        <nz-col [nzSpan]="12">
                            <nz-form-item class="col-md-12">
                                <nz-form-label [nzSpan]="24">Ghi chú
                                </nz-form-label>
                                <nz-form-control [nzSpan]="24">
                                    <textarea nz-input rows="3" placeholder="Nhập ghi chú"
                                        formControlName="Note"></textarea>
                                </nz-form-control>
                            </nz-form-item>
                        </nz-col>
                    </nz-row>
                </fieldset>
            </nz-col>
        </nz-row>
    </form>
</div>
<div class="modal-footer">
    <button nz-button nzType="default" nzDanger (click)="close()">Đóng</button>
    <button nz-button nzType="primary" (click)="save()">Lưu dữ liệu</button>
</div>