<ng-container class="w-100">
    <div class="card border-0 rounded-0 h-100">
        <div class="card-header bg-white p-1 d-flex align-items-center justify-content-between"
            >
            <!-- Bên trái: Các nút hành động -->
            <div class="d-flex gap-1">
                <button nz-button nzType="default" nzSize="small" (click)="toggleSearchBar(); $event.stopPropagation()"
                    (mousedown)="$event.stopPropagation()" (touchstart)="$event.stopPropagation()"
                    (touchend)="$event.stopPropagation()" class="sticky-toggle-btn"
                    [attr.aria-label]="showSearchBar ? 'Ẩn tìm kiếm' : 'Hiện tìm kiếm'"
                    [attr.aria-expanded]="showSearchBar" type="button">
                    <nz-icon [nzType]="showSearchBar ? 'up' : 'down'" />
                </button>
                <button nz-button nzSize="small" class="fs-12 button button-succes btn-add"
                    (click)="onAddMeetingMinutes(false)">
                    <img src="assets/icon/action_add_item_16.png" alt="Thêm mới" /> Thêm
                </button>
                <button class="fs-12 btn-edit" nz-button nzType="default" nzSize="small"
                    (click)="onAddMeetingMinutes(true)">
                    <img src="assets/icon/action_edit_item_16.png" alt="Sửa"> Sửa
                </button>
                <button class="fs-12 btn-delete" nz-button nzType="default" nzSize="small" nzDanger
                    (click)="onDeleteMeetingMinutes()">
                    <img src="assets/icon/action_delete_item_16.png" alt="Xóa" /> Xóa
                </button>
                <button nz-button nzType="default" nzSize="small" class="fs-12 btn" (click)="exportExcel()">
                    <img src="assets/icon/action_export_excel_16.png" alt="Xuất Excel" class="me-1" /> Xuất Excel
                </button>
            </div>

            <!-- Bên phải: Tìm kiếm -->
            <!-- <div class="d-flex gap-1 align-items-center">
                <input nz-input nzSize="small" nzAllowClear placeholder="Nhập từ khóa" style="width: 250px"
                    [(ngModel)]="searchParams.Keywords" (keyup.enter)="searchData()" />
                <button nz-button nzType="default" nzSize="small" (click)="searchData()" class="btn">
                    <nz-icon nzType="search" />
                </button>
            </div> -->
        </div>

        <!-- Backdrop overlay cho mobile -->
        <div class="filter-backdrop" *ngIf="showSearchBar" (click)="toggleSearchBar()" [class.mobile-only]="true">
        </div>

        <!-- Filter bar - hiển thị dạng hàng ngang trên desktop, modal trên mobile -->
        <div class="filter-bar bg-light border-bottom p-2" *ngIf="showSearchBar" [class.mobile-modal]="true">
            <form nz-form class="mobile-filter-form">
                <nz-row [nzGutter]="[8, 8]" nzAlign="bottom">
                    <!-- Từ ngày -->
                    <nz-col [nzXs]="24" [nzSm]="12" [nzMd]="6" [nzLg]="5" [nzXl]="5">
                        <nz-form-item class="mb-0">
                            <nz-form-label class="fs-12" style="font-size: 12px;">Từ ngày</nz-form-label>
                            <nz-form-control>
                                <nz-date-picker [nzFormat]="dateFormat" class="w-100" nzSize="small"
                                    [(ngModel)]="searchParams.DateStart" [ngModelOptions]="{ standalone: true }"
                                    name="dateStart">
                                </nz-date-picker>
                            </nz-form-control>
                        </nz-form-item>
                    </nz-col>

                    <!-- Đến ngày -->
                    <nz-col [nzXs]="24" [nzSm]="12" [nzMd]="6" [nzLg]="5" [nzXl]="5">
                        <nz-form-item class="mb-0">
                            <nz-form-label class="fs-12" style="font-size: 12px;">Đến ngày</nz-form-label>
                            <nz-form-control>
                                <nz-date-picker [nzFormat]="dateFormat" class="w-100" nzSize="small"
                                    [(ngModel)]="searchParams.DateEnd" [ngModelOptions]="{ standalone: true }"
                                    name="dateEnd">
                                </nz-date-picker>
                            </nz-form-control>
                        </nz-form-item>
                    </nz-col>

                    <!-- Loại cuộc họp -->
                    <nz-col [nzXs]="24" [nzSm]="12" [nzMd]="6" [nzLg]="6" [nzXl]="6">
                        <nz-form-item class="mb-0">
                            <nz-form-label class="fs-12" style="font-size: 12px;">Loại cuộc họp</nz-form-label>
                            <nz-form-control>
                                <nz-select [(ngModel)]="searchParams.MeetingTypeID"
                                    [ngModelOptions]="{ standalone: true }" nzPlaceHolder="Chọn loại phòng họp"
                                    nzShowSearch nzAllowClear nzSize="small" class="w-100" name="meetingTypeID">
                                    <nz-option-group *ngFor="let group of meetingTypeGroupsData"
                                        [nzLabel]="getGroupName(group.GroupID)">
                                        <nz-option *ngFor="let room of group.Rooms"
                                            [nzLabel]="room.TypeCode + ' - ' + room.TypeName" [nzValue]="room.ID">
                                        </nz-option>
                                    </nz-option-group>
                                </nz-select>
                            </nz-form-control>
                        </nz-form-item>
                    </nz-col>

                      <nz-col [nzXs]="24" [nzSm]="12" [nzMd]="6" [nzLg]="6" [nzXl]="6">
                        <nz-form-item class="mb-0">
                            <nz-form-label class="fs-12" style="font-size: 12px;">Từ khóa</nz-form-label>
                            <nz-form-control>
                                <input nz-input nzSize="small" nzAllowClear placeholder="Nhập từ khóa"
                                    style="width: 250px" [(ngModel)]="searchParams.Keywords"
                                    (keyup.enter)="searchData()" />
                            </nz-form-control>
                        </nz-form-item>
                    </nz-col>

                    <!-- Nút Đặt lại và Tìm kiếm -->
                    <nz-col [nzXs]="24" [nzSm]="24" [nzMd]="12" [nzLg]="2" [nzXl]="2">
                        <nz-form-item class="mb-0">
                            <nz-form-label class="fs-12" style="font-size: 12px;"
                                [style.visibility]="'hidden'">.</nz-form-label>
                            <nz-form-control>
                                <div class="d-flex gap-1">
                                    <!-- <button nz-button nzType="default" nzSize="small" (click)="resetForm()">
                                        Đặt lại
                                    </button> -->
                                    <button nz-button nzType="primary" nzSize="small" (click)="searchData()">
                                        Tìm kiếm
                                    </button>
                                </div>
                            </nz-form-control>
                        </nz-form-item>
                    </nz-col>
                </nz-row>
            </form>
        </div>

        <!-- Content với bảng -->
        <div class="card-body p-0" style="height: calc(100vh - 120px);" [class.with-search-bar]="showSearchBar"
            [class.without-search-bar]="!showSearchBar">
            <nz-splitter nzLayout="vertical" style="height: 100%;">
                <nz-splitter-panel nzDefaultSize="50%" nzMin="30%" nzMax="70%">
                    <div class="grid-container" id="grid-meeting-minutes">
                        <nz-spin [nzSpinning]="isLoading">
                            <angular-slickgrid gridId="meetingMinutesGrid" [columns]="columnsMeetingMinutes"
                                [options]="gridOptionsMeetingMinutes" [dataset]="datasetMeetingMinutes"
                                (onAngularGridCreated)="onMeetingMinutesGridReady($event.detail)"
                                (onSelectedRowsChanged)="onMeetingMinutesRowSelected($event)">
                            </angular-slickgrid>
                        </nz-spin>
                    </div>
                </nz-splitter-panel>
                <nz-splitter-panel nzDefaultSize="50%" nzMin="30%" nzMax="70%">
                    <nz-tabset [(nzSelectedIndex)]="mainTabIndex" (nzSelectedIndexChange)="onMainTabChange($event)"
                        style="height: 100%;">
                        <nz-tab nzTitle="Nhân viên">
                            <nz-tabset [(nzSelectedIndex)]="activeTab" (nzSelectedIndexChange)="onTabChange($event)"
                                style="height: 100%;">
                                <nz-tab nzTitle="Nhân viên tham gia">
                                    <div class="grid-container" id="grid-employee">
                                        <angular-slickgrid *ngIf="gridsReady && mainTabIndex === 0 && activeTab === 0"
                                            gridId="employeeGrid" [columns]="columnsEmployee"
                                            [options]="gridOptionsEmployee" [dataset]="datasetEmployee"
                                            (onAngularGridCreated)="onEmployeeGridReady($event.detail)"></angular-slickgrid>
                                    </div>
                                </nz-tab>
                                <nz-tab nzTitle="Nội dung">
                                    <div class="grid-container" id="grid-employee-content">
                                        <angular-slickgrid *ngIf="gridsReady && mainTabIndex === 0 && activeTab === 1"
                                            gridId="employeeContentGrid" [columns]="columnsEmployeeContent"
                                            [options]="gridOptionsEmployeeContent" [dataset]="datasetEmployeeContent"
                                            (onAngularGridCreated)="onEmployeeContentGridReady($event.detail)"></angular-slickgrid>
                                    </div>
                                </nz-tab>
                            </nz-tabset>
                        </nz-tab>
                        <nz-tab nzTitle="Khách hàng">
                            <nz-tabset [(nzSelectedIndex)]="activeCustomerTab"
                                (nzSelectedIndexChange)="onCustomerTabChange($event)" style="height: 100%;">
                                <nz-tab nzTitle="Khách hàng tham gia">
                                    <div class="grid-container" id="grid-customer">
                                        <angular-slickgrid
                                            *ngIf="gridsReady && mainTabIndex === 1 && activeCustomerTab === 0"
                                            gridId="customerGrid" [columns]="columnsCustomer"
                                            [options]="gridOptionsCustomer" [dataset]="datasetCustomer"
                                            (onAngularGridCreated)="onCustomerGridReady($event.detail)"></angular-slickgrid>
                                    </div>
                                </nz-tab>
                                <nz-tab nzTitle="Nội dung">
                                    <div class="grid-container" id="grid-customer-content">
                                        <angular-slickgrid
                                            *ngIf="gridsReady && mainTabIndex === 1 && activeCustomerTab === 1"
                                            gridId="customerContentGrid" [columns]="columnsCustomerContent"
                                            [options]="gridOptionsCustomerContent" [dataset]="datasetCustomerContent"
                                            (onAngularGridCreated)="onCustomerContentGridReady($event.detail)"></angular-slickgrid>
                                    </div>
                                </nz-tab>
                            </nz-tabset>
                        </nz-tab>
                        <nz-tab nzTitle="File đính kèm">
                            <div class="grid-container" id="grid-file">
                                <angular-slickgrid *ngIf="gridsReady && mainTabIndex === 2" gridId="fileGrid"
                                    [columns]="columnsFile" [options]="gridOptionsFile" [dataset]="datasetFile"
                                    (onAngularGridCreated)="onFileGridReady($event.detail)"
                                    (onClick)="onFileRowClick($event)"></angular-slickgrid>
                            </div>
                        </nz-tab>
                    </nz-tabset>
                </nz-splitter-panel>
            </nz-splitter>
        </div>
    </div>
</ng-container>