<ng-container class="w-100">
  <div class="card h-100 border-0 rounded-0">
    <!-- Search Panel Above Grid -->

    <!-- Toolbar -->
    <div class="card-header bg-white p-1">
      <div class="d-flex gap-1">
        <button
          class="btn-add"
          nz-button
          nzType="default"
          nzSize="small"
          *hasPermission="'N27,N1,N33,N34,N69'"
          (click)="openModalBillImportDetail(false)"
        >
          <img
            class="btn-action-icon"
            src="assets/icon/action_add_item_16.png"
            alt="Thêm"
          />
          Thêm
        </button>
        <button
          class="btn-edit"
          nz-button
          nzType="default"
          nzSize="small"
          *hasPermission="'N27,N1,N33,N34,N69'"
          (click)="openModalBillImportDetail(true)"
        >
          <img
            class="btn-action-icon"
            src="assets/icon/action_edit_item_16.png"
            alt="Sửa"
          />
          Sửa
        </button>
        <button
          class="btn-delete"
          nz-button
          nzType="default"
          nzSize="small"
          *hasPermission="'N27,N1,N33,N34,N69'"
          (click)="deleteBillImport()"
        >
          <img
            class="btn-action-icon"
            src="assets/icon/action_delete_item_16.png"
            alt="Xóa"
          />
          Xóa
        </button>
        |
        <button
          class="fs-12 btn"
          nz-button
          nzType="default"
          nzSize="small"
          *hasPermission="'N11,N50,N1'"
          (click)="IsApproved(true)"
        >
          <img
            class="btn-action-icon"
            src="assets/icon/action_check_24.svg"
            alt="Nhận chứng từ"
          />
          Nhận chứng từ
        </button>
        <button
          class="fs-12 btn"
          nz-button
          nzType="default"
          nzSize="small"
          *hasPermission="'N11,N1,N18'"
          (click)="IsApproved(false)"
        >
          <img
            class="btn-action-icon"
            src="assets/icon/action_cancle_24.svg"
            alt="Hủy chứng từ"
          />
          Hủy chứng từ
        </button>
        <button
          class="fs-12 btn"
          nz-button
          nzType="default"
          nzSize="small"
          (click)="onExportExcel()"
        >
          <img
            class="btn-action-icon"
            src="assets/icon/action_export_excel_16.png"
            alt="Xuất Excel"
          />
          Xuất Excel
        </button>
        <button
          class="fs-12 btn"
          nz-button
          nzType="default"
          nzSize="small"
          *hasPermission="'N27,N1,N33,N34,N69'"
          (click)="convertExport()"
        >
          <img
            class="btn-action-icon"
            src="assets/icon/export_warehouse.png"
            alt="Xuất hàng"
          />
          Xuất hàng
        </button>
        <button
          class="fs-12 btn"
          nz-button
          nzType="default"
          nzSize="small"
          (click)="onExportExcelKT()"
        >
          <img
            class="btn-action-icon"
            src="assets/icon/action_export_excel_16.png"
            alt="Excel KT"
          />
          Excel KT
        </button>
        <button
          class="fs-12 btn"
          nz-button
          nzType="default"
          nzSize="small"
          (click)="exportExcel()"
        >
          <img
            class="btn-action-icon"
            src="assets/icon/action_export_excel_16.png"
            alt="Xuất danh sách"
          />
          Xuất danh sách
        </button>
        <button
          class="fs-12 btn"
          nz-button
          nzType="default"
          nzSize="small"
          (click)="openFolderTree()"
        >
          <img
            class="btn-action-icon"
            src="assets/icon/tree_folder_16.png"
            alt="Cây thư mục"
          />
          Cây thư mục
        </button>
        <button
          class="fs-12 btn"
          nz-button
          nzType="default"
          nzSize="small"
          *hasPermission="'N52,N36,N1,N34'"
          (click)="openModalBillDocumentImport()"
        >
          <img
            class="btn-action-icon"
            src="assets/icon/document.png"
            alt="Hồ sơ chứng từ"
          />
          Hồ sơ chứng từ
        </button>
        <button
          class="fs-12 btn"
          nz-button
          nzType="default"
          nzSize="small"
          (click)="openModalScanBill()"
        >
          <img
            class="btn-action-icon"
            src="assets/icon/qr.png"
            alt="QR Code Phiếu"
          />
          QR Code Phiếu
        </button>
        <button
          class="fs-12 btn"
          nz-button
          nzType="default"
          nzSize="small"
          (click)="openModalBillImportSynthetic()"
        >
          <img
            class="btn-action-icon"
            src="assets/icon/summary.png"
            alt="Tổng hợp"
          />
          Tổng hợp
        </button>
      </div>
    </div>
    <div class="card-header bg-white p-2">
      <form nz-form nzLayout="inline" (keyup.enter)="onSearch()">
        <nz-form-item>
          <nz-form-label class="fs-12">Từ ngày</nz-form-label>
          <nz-form-control>
            <nz-date-picker
              [nzFormat]="dateFormat"
              nzSize="small"
              [(ngModel)]="searchParams.dateStart"
              name="dateStart"
              [nzDisabled]="checked"
              (ngModelChange)="onDateStartChange($event)"
              style="width: 130px"
            >
            </nz-date-picker>
          </nz-form-control>
        </nz-form-item>

        <nz-form-item>
          <nz-form-label class="fs-12">Đến ngày</nz-form-label>
          <nz-form-control>
            <nz-date-picker
              [nzFormat]="dateFormat"
              nzSize="small"
              [(ngModel)]="searchParams.dateEnd"
              name="dateEnd"
              [nzDisabled]="checked"
              (ngModelChange)="onDateEndChange($event)"
              style="width: 130px"
            >
            </nz-date-picker>
          </nz-form-control>
        </nz-form-item>

        <nz-form-item>
          <nz-form-label class="fs-12">Lọc kho</nz-form-label>
          <nz-form-control>
            <nz-select
              nzAllowClear="true"
              nzAllowClear="true"
              [(ngModel)]="selectedKhoTypes"
              (ngModelChange)="onKhoTypeChange($event)"
              [nzMode]="'multiple'"
              [nzPlaceHolder]="'Chọn nhóm kho'"
              [nzMaxTagCount]="2"
              name="selectedKhoTypes"
              nzSize="small"
              style="width: 200px"
            >
              <nz-option
                *ngFor="let item of dataProductGroup"
                [nzLabel]="item.ProductGroupName"
                [nzValue]="item.ID"
              ></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>

        <nz-form-item>
          <nz-form-label class="fs-12">Lọc phiếu</nz-form-label>
          <nz-form-control>
            <nz-select
              nzShowSearch
              nzAllowClear
              nzSize="small"
              [(ngModel)]="searchParams.status"
              name="status"
              style="width: 150px"
            >
              <nz-option
                *ngFor="let item of cbbStatus"
                [nzValue]="item.ID"
                [nzLabel]="item.Name"
              >
                <div class="d-flex align-items-center">
                  <span class="me-2">{{ item.ID }}</span>
                  <span>{{ item.Name }}</span>
                </div>
              </nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>

        <nz-form-item>
          <nz-form-label class="fs-12">Từ khóa</nz-form-label>
          <nz-form-control>
            <input
              nz-input
              placeholder="Nhập từ khóa"
              [(ngModel)]="searchParams.keyword"
              name="keyword"
              nzSize="small"
              (keyup.enter)="onSearch()"
              style="width: 200px"
            />
          </nz-form-control>
        </nz-form-item>

        <nz-form-item>
          <nz-form-control>
            <label
              nz-checkbox
              [(ngModel)]="checked"
              name="checked"
              (ngModelChange)="onCheckboxChange()"
              >Tất cả thời gian</label
            >
          </nz-form-control>
        </nz-form-item>

        <nz-form-item>
          <nz-form-control>
            <button
              nz-button
              nzType="primary"
              nzSize="small"
              (click)="onSearch()"
            >
              Tìm kiếm
            </button>
          </nz-form-control>
        </nz-form-item>
      </form>
    </div>

    <!-- Grid Content -->
    <div class="card-body p-0">
      <!-- Master Grid -->
      <div class="grid-container-master">
        <angular-slickgrid
          [gridId]="'gridMaster-' + wareHouseCode"
          [columns]="columnDefinitionsMaster"
          [options]="gridOptionsMaster"
          [dataset]="datasetMaster"
          (onAngularGridCreated)="angularGridMasterReady($event.detail)"
          (onSelectedRowsChanged)="onMasterRowSelectionChanged($event.detail.eventData, $event.detail.args)"
          (onDblClick)="openModalBillImportDetail(true)"
        >
        </angular-slickgrid>
      </div>
      <!-- Detail Grid -->
      <div class="mt-2">
        <fieldset class="detail-fieldset">
          <legend class="detail-legend">
            {{ tabDetailTitle }}
          </legend>

          <nz-spin [nzSpinning]="isDetailLoad" nzTip="Đang tải dữ liệu...">
            <div class="grid-container-detail">
              <angular-slickgrid
                [gridId]="'gridDetail-' + wareHouseCode"
                [columns]="columnDefinitionsDetail"
                [options]="gridOptionsDetail"
                [dataset]="datasetDetail"
                (onAngularGridCreated)="angularGridDetailReady($event.detail)"
              >
              </angular-slickgrid>
            </div>
          </nz-spin>
        </fieldset>
      </div>
    </div>
  </div>
</ng-container>
