<div class="modal-header bg-primary text-uppercase py-2">
    <h6 class="modal-title text-white">CHI TIẾT BÀI ĐÁNH GIÁ</h6>
    <button type="button" class="btn-close" (click)="cancel()" aria-label="Close"></button>
</div>

<div class="modal-body p-3">
    <nz-spin [nzSpinning]="isLoading" nzTip="Đang xử lý...">
        <!-- Form Fields -->
        <div class="row mb-2 align-items-center">
            <!-- Session -->
            <div class="col-md-2">
                <label class="m-0 text-nowrap">
                    Kỳ đánh giá
                    <span class="text-danger">*</span>
                </label>
            </div>
            <div class="col-md-4">
                <nz-select nzShowSearch nzPlaceHolder="Chọn kỳ đánh giá" [(ngModel)]="selectedSessionId"
                    style="width: 100%;" nzSize="small" [nzDisabled]="isEditMode || true">
                    <nz-option *ngFor="let item of sessions" [nzValue]="item.ID"
                        [nzLabel]="item.Code + ' - ' + item.Name">
                    </nz-option>
                </nz-select>
                <span class="text-danger fs-xs" *ngIf="errors.sessionId">{{ errors.sessionId }}</span>
            </div>

            <!-- Deadline -->
            <div class="col-auto">
                <label class="m-0 text-nowrap">
                    Hạn làm bài
                    <span class="text-danger">*</span>
                </label>
            </div>
            <div class="col">
                <nz-date-picker [(ngModel)]="deadline" nzFormat="dd/MM/yyyy" nzSize="small"
                    style="width: 100%;"></nz-date-picker>
                <span class="text-danger fs-xs" *ngIf="errors.deadline">{{ errors.deadline }}</span>
            </div>

            <!-- IsActive -->
            <div class="col-md-2">
                <label nz-checkbox [(ngModel)]="isActive">Hoạt động</label>
            </div>
        </div>

        <!-- Exam Code -->
        <div class="row mb-2 align-items-center">
            <div class="col-md-2">
                <label class="m-0 text-nowrap">
                    Mã bài đánh giá
                    <span class="text-danger">*</span>
                </label>
            </div>
            <div class="col-md-10">
                <input nz-input nzSize="small" [(ngModel)]="examCode" placeholder="Nhập mã bài đánh giá" />
                <span class="text-danger fs-xs" *ngIf="errors.examCode">{{ errors.examCode }}</span>
            </div>
        </div>

        <!-- Exam Name -->
        <div class="row mb-3 align-items-center">
            <div class="col-md-2">
                <label class="m-0 text-nowrap">
                    Tên bài đánh giá
                    <span class="text-danger">*</span>
                </label>
            </div>
            <div class="col-md-10">
                <input nz-input nzSize="small" [(ngModel)]="examName" placeholder="Nhập tên bài đánh giá" />
                <span class="text-danger fs-xs" *ngIf="errors.examName">{{ errors.examName }}</span>
            </div>
        </div>

        <!-- Position Grid -->
        <div class="position-grid-wrapper">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <label class="m-0">Danh sách vị trí</label>
                <span class="text-muted fs-xs">Đã chọn: {{ selectedPositionIds.length }} vị trí</span>
            </div>
            <span class="text-danger fs-xs d-block mb-1" *ngIf="errors.positions">{{ errors.positions }}</span>
            <div class="grid-container-position">
                <nz-spin [nzSpinning]="isLoadingGrid" nzTip="Đang tải..." class="h-100 w-100">
                    <angular-slickgrid [gridId]="gridId" [columns]="columnDefinitions" [options]="gridOptions"
                        [dataset]="dataset" (onAngularGridCreated)="angularGridReady($event.detail)">
                    </angular-slickgrid>
                </nz-spin>
            </div>
        </div>
    </nz-spin>
</div>

<div class="modal-footer p-2">
    <button nz-button nzType="default" nzSize="default" (click)="cancel()">
        <span nz-icon nzType="close"></span> Đóng
    </button>
    <button nz-button nzType="primary" nzSize="default" (click)="saveAndClose()" [nzLoading]="isLoading">
        <span nz-icon nzType="save"></span> Lưu
    </button>
</div>