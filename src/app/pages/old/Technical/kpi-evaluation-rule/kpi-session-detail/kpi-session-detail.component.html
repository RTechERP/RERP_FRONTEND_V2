<div class="modal-header bg-primary text-uppercase py-2">
    <h6 class="modal-title text-white">CHI TIẾT KỲ ĐÁNH GIÁ</h6>
    <button type="button" class="btn-close" (click)="cancel()" aria-label="Close"></button>
</div>

<div class="modal-body p-3">
    <nz-spin [nzSpinning]="isLoading" nzTip="Đang xử lý...">
        <!-- Copy checkbox -->
        <div class="d-flex justify-content-end mb-2">
            <label nz-checkbox [(ngModel)]="isCopy" (ngModelChange)="onCopyChange()">
                Sao chép
            </label>
        </div>

        <!-- Group: TỪ (Source session for copy) -->
        <nz-card nzTitle="TỪ" class="mb-3" [nzBodyStyle]="{'padding': '12px'}" *ngIf="isCopy">
            <div class="row align-items-center">
                <div class="col-md-3">
                    <label class="m-0 text-nowrap font-weight-bold">
                        Kỳ đánh giá
                        <span class="text-danger">(*)</span>
                    </label>
                </div>
                <div class="col-md-9">
                    <nz-select nzShowSearch nzAllowClear nzPlaceHolder="Chọn kỳ đánh giá nguồn"
                        [(ngModel)]="fromSessionId" style="width: 100%;" nzSize="small">
                        <nz-option *ngFor="let item of kpiSessions" [nzValue]="item.ID"
                            [nzLabel]="item.Code + ' - ' + item.Name">
                        </nz-option>
                    </nz-select>
                    <span class="text-danger fs-xs" *ngIf="errors.fromSessionId">{{ errors.fromSessionId }}</span>
                </div>
            </div>
        </nz-card>

        <!-- Group: ĐẾN (Target session details) -->
        <nz-card nzTitle="ĐẾN" [nzBodyStyle]="{'padding': '12px'}">
            <!-- Row 1: Năm, Quý, Phòng ban -->
            <div class="row mb-2 align-items-center">
                <div class="col-md-3">
                    <label class="m-0 text-nowrap font-weight-bold">
                        Năm
                        <span class="text-danger">(*)</span>
                    </label>
                </div>
                <div class="col-md-9">
                    <div class="row g-2 align-items-center">
                        <div class="col-md-2">
                            <nz-input-number [(ngModel)]="year" [nzMin]="2024" [nzMax]="2100" [nzStep]="1"
                                nzSize="small" style="width: 100%;" (ngModelChange)="onYearChange()">
                            </nz-input-number>
                            <span class="text-danger fs-xs" *ngIf="errors.year">{{ errors.year }}</span>
                        </div>
                        <div class="col-md-1 text-center">
                            <label class="m-0 text-nowrap">Quý <span class="text-danger">(*)</span></label>
                        </div>
                        <div class="col-md-1">
                            <nz-input-number [(ngModel)]="quarter" [nzMin]="1" [nzMax]="4" [nzStep]="1" nzSize="small"
                                style="width: 100%;" (ngModelChange)="onQuarterChange()">
                            </nz-input-number>
                            <span class="text-danger fs-xs" *ngIf="errors.quarter">{{ errors.quarter }}</span>
                        </div>
                        <div class="col-md-2 text-end">
                            <label class="m-0 text-nowrap">Phòng ban <span class="text-danger">(*)</span></label>
                        </div>
                        <div class="col-md-6">
                            <nz-select nzShowSearch nzPlaceHolder="Chọn phòng ban" [(ngModel)]="selectedDepartmentId"
                                style="width: 100%;" nzSize="small" (ngModelChange)="onDepartmentChange()">
                                <nz-option *ngFor="let dept of departments" [nzValue]="dept.ID" [nzLabel]="dept.Name">
                                </nz-option>
                            </nz-select>
                            <span class="text-danger fs-xs" *ngIf="errors.departmentId">{{ errors.departmentId }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Row 2: Mã kỳ đánh giá -->
            <div class="row mb-2 align-items-center">
                <div class="col-md-3">
                    <label class="m-0 text-nowrap font-weight-bold">
                        Mã kỳ đánh giá
                        <span class="text-danger">(*)</span>
                    </label>
                </div>
                <div class="col-md-9">
                    <input nz-input nzSize="small" [(ngModel)]="code" (blur)="errors.code = ''" />
                    <span class="text-danger fs-xs" *ngIf="errors.code">{{ errors.code }}</span>
                </div>
            </div>

            <!-- Row 3: Tên kỳ đánh giá -->
            <div class="row align-items-center">
                <div class="col-md-3">
                    <label class="m-0 text-nowrap font-weight-bold">
                        Tên kỳ đánh giá
                        <span class="text-danger">(*)</span>
                    </label>
                </div>
                <div class="col-md-9">
                    <input nz-input nzSize="small" [(ngModel)]="name" (blur)="errors.name = ''" />
                    <span class="text-danger fs-xs" *ngIf="errors.name">{{ errors.name }}</span>
                </div>
            </div>
        </nz-card>
    </nz-spin>
</div>

<div class="modal-footer p-2">
    <button nz-button nzType="default" nzSize="default" (click)="cancel()">
        <i class="fas fa-times"></i> Đóng
    </button>
    <button nz-button nzType="primary" nzSize="default" (click)="save()" [nzLoading]="isLoading">
        <i class="fas fa-save"></i> Lưu
    </button>
</div>