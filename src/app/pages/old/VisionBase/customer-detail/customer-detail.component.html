<div class="modal-header bg-primary text-uppercase py-2">
  <h6 class="modal-title text-white">CHI TIẾT KHÁCH HÀNG </h6>
  <button
    type="button"
    class="btn-close"
    (click)="closeModal()"
    aria-label="Close"
  ></button>
</div>

<div class="modal-body p-1 " style="max-height: 80vh; overflow-y: auto;">
  <form nz-form [formGroup]="formGroup" class="g-3 needs-validation was-validated">
    <div class="container-fluid">
    <div nz-row [nzGutter]="12" style="margin-top: 10px !important;">
    <div nz-col [nzSpan]="12">
      <div nz-row [nzGutter]="12" class="pb-2">
         <div nz-col class="col-md-4">
          <nz-form-item>
            <nz-form-label
              class="fs-12 d-flex align-items-center"
              [nzSpan]="24"
            >
              Tỉnh <span class="text-danger ps-1">*</span>
            </nz-form-label>
            <nz-form-control [nzSpan]="24" [nzErrorTip]="getFieldError('province')">
              <nz-select
                formControlName="province"
                nzShowSearch
                nzAllowClear
                nzSize="default"
                class="w-100"
                (ngModelChange)="onProvinceChange($event)"
              >
                <nz-option
                  *ngFor="let item of provincesData"
                  [nzValue]="item.Name"
                  [nzLabel]="item.Name + ' - ' + item.Code"
                >
                </nz-option>
              </nz-select>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col class="col-md-5">
          <nz-form-item>
            <nz-form-label
              class="fs-12 d-flex align-items-center"
              [nzSpan]="24"
            >
              Mã khách <span class="text-danger ps-1">*</span>
            </nz-form-label>
            <nz-form-control [nzSpan]="24">
              <nz-input-group nzCompact>
                <input
                  nz-input
                  type="text"
                  formControlName="provinceCode"
                  style="width: 40%"
                  [disabled]="true"
                
                />
                <input nz-input
                type="text"   placeholder="-" style="text-align: center; width: 20%;" [disabled]="true"/>
                <input
                  nz-input
                  type="text"
                  formControlName="customerCode"
                  style="width: 40%"
                />
              </nz-input-group>
            </nz-form-control>
          </nz-form-item>
        </div>
        
        <div nz-col class="col-md-3">
          <nz-form-item>
            <nz-form-label
              class="fs-12 d-flex align-items-center"
              [nzSpan]="24"
            >
              Ký hiệu <span style="color: red">*</span>
            </nz-form-label>
            <nz-form-control [nzSpan]="24" [nzErrorTip]="getFieldError('customerShortName')">
              <input
                nz-input
                type="text"
                formControlName="customerShortName"
              />
            </nz-form-control>
          </nz-form-item>
        </div>
      </div>
    </div>
    <div nz-col [nzSpan]="12">
      <div nz-row [nzGutter]="12" class="pb-2">
        <div nz-col class="col-md-4">
          <nz-form-item>
            <nz-form-label
              class="fs-12 d-flex align-items-center"
              [nzSpan]="24"
            >
              Mã số thuế
            </nz-form-label>
            <nz-form-control [nzSpan]="24">
              <input
                nz-input
                type="text"
                formControlName="taxCode"
              />
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col class="col-md-5">
          <nz-form-item>
            <nz-form-label
              class="fs-12 d-flex align-items-center"
              [nzSpan]="24"
            >
              Loại hình
            </nz-form-label>
            <nz-form-control [nzSpan]="24">
              <nz-select
              formControlName="customerType"
              nzShowSearch
              nzAllowClear
              nzPlaceHolder="--Chọn loại hình--"
              nzSize="default"
              class="w-100"
            >
              <nz-option
                *ngFor="let item of customerTypeData"
                [nzValue]="item.value"
                [nzLabel]="item.customerType"
              >
              </nz-option>
            </nz-select>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col class="col-md-3 align-items-center h-auto">
          <nz-form-item>
            <div [style.visibility]="'hidden'">Big Account</div>
          <label class="mb-0 fs-12 invisible">Big Account</label>
              <label
                class="mb-0 fs-12 "
                nz-checkbox
                formControlName="isBigAccount"
                >Big Account</label
              >
            </nz-form-item>
        </div>
      </div>
    </div>
  </div>
      <div class="row g-2 align-items-end" style="margin-top: -15px !important;">
        <div class="col-md-6">
          <nz-form-item>
            <nz-form-label  class="fs-12 d-flex align-items-center"
            [nzSpan]="24">
              Tên khách hàng<span class="text-danger ps-1">*</span>
            </nz-form-label>
            <nz-form-control [nzErrorTip]="getFieldError('fullName')">
              <input
                nz-input
                class="w-100"
                nzSize="default"
                formControlName="fullName"
                placeholder="Nhập tên khách hàng"
              />
            </nz-form-control>
          </nz-form-item>
        </div>

        <div class="col-md-6 ">
          <nz-form-item>
            <nz-form-label  class="fs-12 d-flex align-items-center w-100"
            [nzSpan]="24">
              Sản phẩm đã bán
              <button class="p-0 m-0 px-1 fs-12 h-auto" 
              nz-button 
              nzType="text" 
              nzSize="small"
                  title="Thêm sản phẩm">
                  <i class="fas fa-plus"></i>
              </button>
            </nz-form-label>
            <nz-form-control [nzSpan]="24">
              <nz-select
              formControlName="businessField"
              nzShowSearch
              nzAllowClear
              nzPlaceHolder="--Chọn sản phẩm đã bán--"
              nzSize="default"
              class="w-100"
            >
              <nz-option
                *ngFor="let item of businessFieldData"
                [nzValue]="item.ID"
                [nzLabel]="item.Name + ' - ' + item.Note"
              ></nz-option>
            </nz-select>
            </nz-form-control>
          </nz-form-item>
        </div>
      </div>

      <div class="row g-2 align-items-end">
        <div class="col-md-6">
          <nz-form-item>
            <nz-form-label  class="fs-12 d-flex align-items-center"
            [nzSpan]="24">
              Địa chỉ <span class="text-danger ps-1">*</span>
            </nz-form-label>
            <nz-form-control [nzErrorTip]="getFieldError('address')">
              <input
                nz-input
                class="w-100"
                nzSize="default"
                formControlName="address"
                placeholder="Nhập địa chỉ"
              />
            </nz-form-control>
          </nz-form-item>
        </div>

        <div class="col-md-3">
          <nz-form-item>
            <nz-form-label  class="fs-12 d-flex align-items-center"
            [nzSpan]="24">
            Công nợ 
            </nz-form-label>
            <nz-form-control [nzErrorTip]="getFieldError('address')">
              <input
            nz-input
            class="w-100"
            nzSize="default"
            formControlName="debt"
            placeholder="Nhập công nợ"
          />
            </nz-form-control>
          </nz-form-item>
        </div>
        <div class="col-md-3">
          <nz-form-item>
            <nz-form-label  class="fs-12 d-flex align-items-center"
            [nzSpan]="24">
            Lưu ý chứng từ
            </nz-form-label>
            <nz-form-control [nzErrorTip]="getFieldError('address')">
              <input
              nz-input
              class="w-100"
              nzSize="default"
              formControlName="noteVoucher"
              placeholder="Nhập lưu ý chứng từ"
            />
            </nz-form-control>
          </nz-form-item>
        </div>
      </div>
      <div class="row g-2 align-items-end">
        <div class="col-md-6 d-flex align-items-end">
          <div class="flex-grow-1">
            <nz-form-item>
              <nz-form-label  class="fs-12 d-flex align-items-center"
              [nzSpan]="24">
                Ngành nghề <span class="text-danger ps-1">*</span>
                <button class="p-0 m-0 px-1 fs-12 h-auto" 
                nz-button 
                nzType="text" 
                nzSize="small"
                    title="Thêm ngành nghề" (click)="openCustomerMajorDetail()">
                    <i class="fas fa-plus"></i>
                </button>
              </nz-form-label>
              <nz-form-control [nzErrorTip]="getFieldError('majorId')">
                <nz-select
                  formControlName="majorId"
                  nzShowSearch
                  nzAllowClear
                  nzPlaceHolder="--Chọn ngành nghề--"
                  nzSize="default"
                  class="w-100"
                >
                  <nz-option
                    *ngFor="let item of majorData"
                    [nzValue]="item.ID"
                    [nzLabel]="item.Name"
                  >
                  </nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>
          </div>
        </div>
        <div class="col-md-6">
          <nz-form-item>
            <nz-form-label  class="fs-12 d-flex align-items-center"
            [nzSpan]="24">
            Đầu mối gửi chứng từ bản cứng
            </nz-form-label>
            <nz-form-control [nzErrorTip]="getFieldError('address')">
              <input
              nz-input
              class="w-100"
              nzSize="default"
              formControlName="hardCopyVoucher"
            />
            </nz-form-control>
          </nz-form-item>
        </div>
      </div>
      <div class="row g-2 align-items-end">
        <div class="col-md-6">
          <nz-form-item>
            <nz-form-label  class="fs-12 d-flex align-items-center"
            [nzSpan]="24">
            SP chi tiết
            </nz-form-label>
            <nz-form-control [nzErrorTip]="getFieldError('address')">
              <input
            nz-input
            class="w-100"
            nzSize="default"
            formControlName="productDetails"
          />
            </nz-form-control>
          </nz-form-item>
        </div>
        <div class="col-md-6">
          <nz-form-item>
            <nz-form-label  class="fs-12 d-flex align-items-center"
            [nzSpan]="24">
            Đầu mối gửi check chứng từ
            </nz-form-label>
            <nz-form-control [nzErrorTip]="getFieldError('address')">
              <input
              nz-input
              class="w-100"
              nzSize="default"
              formControlName="checkVoucher"
            />
            </nz-form-control>
          </nz-form-item>
        </div>
      </div>
      <div class="row g-2 align-items-end">
        <div class="col-md-6">
          <nz-form-item>
            <nz-form-label  class="fs-12 d-flex align-items-center"
            [nzSpan]="24">
            Lưu ý giao
            </nz-form-label>
            <nz-form-control [nzErrorTip]="getFieldError('address')">
              <input
              nz-input
              class="w-100"
              nzSize="default"
              formControlName="noteDelivery"
            />
            </nz-form-control>
          </nz-form-item>
        </div>
        <div class="col-md-6">
          <nz-form-item>
            <nz-form-label  class="fs-12 d-flex align-items-center"
            [nzSpan]="24">
            Ngày chốt công nợ
            </nz-form-label>
            <nz-form-control [nzErrorTip]="getFieldError('address')">
              <nz-date-picker
            formControlName="closingDateDebt"
            class="w-100"
            nzSize="default"
            nzFormat="dd/MM/yyyy"
          ></nz-date-picker>
            </nz-form-control>
          </nz-form-item>
        </div>
      </div>

      <!-- Bảng khách hàng chi tiết -->
      <div class="row mt-3">
        <nz-splitter style="max-height: 40vh">
          <nz-splitter-panel [nzCollapsible]="true" nzDefaultSize="50%">
            <div #tb_DataTable id="tb_DataTable"></div>
          </nz-splitter-panel>
          <nz-splitter-panel
            [nzCollapsible]="{ start: true }"
            nzDefaultSize="25%"
          >
            <div #tb_AddressTable id="tb_AddressTable"></div>
          </nz-splitter-panel>
          <nz-splitter-panel nzDefaultSize="25%">
            <div #tb_SaleTable id="tb_SaleTable"></div>
          </nz-splitter-panel>
        </nz-splitter>
      </div>
    </div>
  </form>
</div>
<div class="modal-footer">
  <button
    nz-button
    nzType="default"
    nzDanger="true"
    nzSize="default"
    (click)="closeModal()"
  >
    Đóng
  </button>
  <button nz-button nzType="primary" nzSize="default" (click)="saveAndClose()">
    Lưu
  </button>
</div>
