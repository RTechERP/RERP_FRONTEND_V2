<!-- quotation-kh-detail.component.html -->
<div class="modal-header bg-primary text-uppercase py-2">
  <h6 class="modal-title text-white">KẾ HOẠCH TUẦN</h6>
  <button type="button" class="btn-close" (click)="closeModal()" aria-label="Close"></button>
</div>

<div class="modal-body p-1">
  <form>
    <div class="container-fluid">
      <div class="row g-2 align-items-end">

        <div class="col-auto">
          <button nz-button nzType="default" nzSize="small" (click)="decreaseWeek()" class="flex-1">
            <nz-icon nzType="left"></nz-icon>
          </button>
        </div>

        <div class="col">
          <label class="mb-0 fs-12">Từ ngày</label>
          <nz-date-picker name="startDate" class="w-100" nzSize="small" [(ngModel)]="filters.startDate"
            [nzDisabled]="true">
          </nz-date-picker>
        </div>

        <div class="col">
          <label class="mb-0 fs-12">Đến ngày</label>
          <nz-date-picker name="endDate" class="w-100" nzSize="small" [(ngModel)]="filters.endDate" [nzDisabled]="true">
          </nz-date-picker>
        </div>

        <div class="col-auto">
          <button nz-button nzType="default" nzSize="small" (click)="increaseWeek()" class="flex-1">
            <nz-icon nzType="right"></nz-icon>
          </button>
        </div>

        <div class="col-12 col-md-3">
          <label class="mb-0 fs-12">Họ tên</label>
          <nz-select [nzDisabled]="true" nzShowSearch nzAllowClear class="w-100" nzSize="small"
            [(ngModel)]="filters.userId" name="userId">
            <nz-option *ngFor="let item of filterUserData" [nzValue]="item.UserID"
              [nzLabel]="item.Code + '-' + item.FullName">
            </nz-option>
          </nz-select>
        </div>
      </div>

      <!-- Bảng sản phẩm chi tiết -->
      <!-- <div class="row mt-3">
        <div #tb_MainTable id="tb_MainTable"></div>
      </div> -->

      <!-- Form động theo dữ liệu -->
      <div class="row mt-3">
        <div class="col-12 mb-3">
          <nz-collapse>
            <nz-collapse-panel *ngFor="let item of mainData; let i = index"
              [nzHeader]="'Ngày: ' + formatDate(item.DatePlan)" [nzActive]="false" [nzExtra]="extraTpl">

              <ng-template #extraTpl>
                <button nz-button nzType="text" nzDanger nzSize="small" (click)="deleteItem(item, $event)" type="button"
                  title="Xóa">
                  <nz-icon nzType="delete"></nz-icon>
                </button>
              </ng-template>

              <form nz-form nzLayout="vertical" class="compact-form px-2">
                <div class="row g-2">
                  <div class="col-12 col-md-6">
                    <nz-form-item class="mb-2">
                      <nz-form-label class="mb-1 mt-2 ps-1">Nội dung</nz-form-label>
                      <nz-form-control>
                        <textarea nz-input rows="2" [(ngModel)]="item.ContentPlan" [name]="'contentPlan_' + i"
                          (ngModelChange)="onFieldChange(item)" placeholder="Nhập nội dung công việc">
                        </textarea>
                      </nz-form-control>
                    </nz-form-item>
                  </div>

                  <div class="col-12 col-md-6">
                    <nz-form-item class="mb-2">
                      <nz-form-label class="mb-1 mt-2 ps-1">Kết quả mong đợi</nz-form-label>
                      <nz-form-control class="mb-3">
                        <textarea nz-input rows="2" [(ngModel)]="item.Result" [name]="'result_' + i"
                          (ngModelChange)="onFieldChange(item)" placeholder="Nhập kết quả mong đợi">
                        </textarea>
                      </nz-form-control>
                    </nz-form-item>
                  </div>
                </div>
              </form>

            </nz-collapse-panel>
          </nz-collapse>

          <div *ngIf="mainData.length === 0" class="text-center text-muted py-5">
            <nz-icon nzType="inbox" nzTheme="outline" style="font-size: 48px;"></nz-icon>
            <p class="mt-2">Không có dữ liệu</p>
          </div>
        </div>
      </div>
    </div>
  </form>
</div>

<div class="modal-footer py-1">
  <button nz-button nzType="default" nzDanger="true" nzSize="default" (click)="closeModal()">Đóng</button>
  <button nz-button nzType="primary" nzSize="default" (click)="saveAndClose()">Lưu</button>
</div>