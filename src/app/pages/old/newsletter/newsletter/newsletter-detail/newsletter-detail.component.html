<div class="newsletter-detail-wrapper">
    <!-- Pinned Close Button -->
    <button type="button" class="btn-close pinned-close-btn" (click)="onClose()" aria-label="Close"></button>

    <div class="newsletter-detail-container">
        <div class="newsletter-detail-inner">
            <!-- Loading Spinner -->
            <div *ngIf="isLoading" class="text-center py-5">
                <nz-spin nzSize="large" nzTip="Đang tải..."></nz-spin>
            </div>

            <!-- Newsletter Content -->
            <div *ngIf="!isLoading && newsletter" class="newsletter-content">
                <!-- Header -->
                <div class="newsletter-header mb-4">
                    <h2 class="newsletter-title mb-3">{{ newsletter.Title }}</h2>
                    <div class="newsletter-meta d-flex gap-3 text-muted">
                        <span><i nz-icon nzType="user" nzTheme="outline"></i> {{ newsletter.CreatedBy }}</span>
                        <span><i nz-icon nzType="calendar" nzTheme="outline"></i> {{ newsletter.CreatedDate |
                            date:'dd/MM/yyyy
                            HH:mm' }}</span>
                        <span *ngIf="newsletter.NewsletterTypeName" class="badge bg-primary">{{
                            newsletter.NewsletterTypeName
                            }}</span>
                    </div>
                </div>

                <!-- Content -->
                <div class="newsletter-body mb-4">
                    <div class="content-html" [innerHTML]="sanitizedContent"></div>
                </div>

                <!-- Main Image -->
                <div *ngIf="newsletter.ServerImgPath" class="newsletter-image mb-4">
                    <img [src]="getImageUrl()" [alt]="newsletter.Title" class="img-fluid rounded shadow-sm"
                        style="max-width: 100%; height: auto; cursor: pointer;" (click)="viewImage()"
                        title="Click để xem ảnh">
                </div>

                <!-- Attached Files -->
                <div *ngIf="newsletterFiles.length > 0" class="newsletter-files">
                    <h5 class="mb-3">
                        <i nz-icon nzType="paper-clip" nzTheme="outline"></i>
                        Tài liệu đính kèm ({{ newsletterFiles.length }})
                    </h5>
                    <div class="file-list">
                        <div *ngFor="let file of newsletterFiles"
                            class="file-item d-flex align-items-center justify-content-between p-3 mb-2 border rounded">
                            <div class="file-info d-flex align-items-center">
                                <i nz-icon nzType="file" nzTheme="outline" class="me-2 text-primary"
                                    style="font-size: 24px;"></i>
                                <div>
                                    <div class="file-name fw-bold text-truncate" [title]="file.FileName">{{
                                        file.FileName }}</div>
                                    <small class="text-muted">{{ file.CreatedDate | date:'dd/MM/yyyy HH:mm' }}</small>
                                </div>
                            </div>
                            <div class="d-flex gap-2">
                                <button nz-button nzType="default" nzSize="small" (click)="viewFile(file)"
                                    title="Xem file">
                                    <i nz-icon nzType="eye" nzTheme="outline"></i>
                                    Xem
                                </button>
                                <button nz-button nzType="primary" nzSize="small" (click)="downloadFile(file)"
                                    title="Tải xuống">
                                    <i nz-icon nzType="download" nzTheme="outline"></i>
                                    Tải xuống
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- No Files Message -->
                <div *ngIf="newsletterFiles.length === 0" class="text-center text-muted py-3">
                    <i nz-icon nzType="inbox" nzTheme="outline" style="font-size: 48px; opacity: 0.3;"></i>
                    <p class="mt-2">Không có tài liệu đính kèm</p>
                </div>
            </div>

            <!-- Error State -->
            <div *ngIf="!isLoading && !newsletter" class="text-center py-5">
                <i nz-icon nzType="exclamation-circle" nzTheme="outline" class="text-danger"
                    style="font-size: 48px;"></i>
                <p class="mt-3 text-muted">Không thể tải thông tin bản tin</p>
            </div>
        </div>
    </div>
</div>