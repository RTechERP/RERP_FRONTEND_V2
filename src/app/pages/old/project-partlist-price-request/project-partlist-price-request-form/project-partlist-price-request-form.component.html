<div class="modal-header bg-primary p-2">
  <h6 class="modal-title text-white py-2">CHI TIẾT YÊU CẦU</h6>
  <button type="button" class="btn-close" aria-label="Close" (click)="close()"></button>
</div>

<div class="modal-body p-1" style="max-height: 70vh; overflow-y: auto; overflow-x: hidden;">
  <form nz-form class="row g-3">
    <nz-row [nzGutter]="16" class="mt-2">
      <nz-col [nzXs]="24" [nzSm]="24" [nzMd]="8" [nzLg]="8">
        <nz-form-item class="col-md-12">
          <nz-form-label [nzSpan]="24">Người yêu cầu<span class="text-danger ps-1 me-1"> (*)
            </span>
          </nz-form-label>
          <nz-form-control [nzSpan]="24" [nzErrorTip]="'Chọn người yêu cầu'">
            <nz-input-group required nzSearch nzSize="default" class="w-100">
              <nz-select
                nzSize="default"
                id="requesterSelect"
                [(ngModel)]="requester"
                name="requesterId"
                nzPlaceHolder="Chọn người yêu cầu"
                class="fs-12 w-100"
                required
                nzShowSearch
                nzAllowClear
             
                (nzSearchChange)="requesterSearchChange($event)"
             
                [nzDisabled]="isEditMode && !isVPP"
              >
                <nz-option-group *ngFor="let group of employeeGroups" [nzLabel]="group.department">
                  <nz-option
                    class="cdk-overlay-container"
                    *ngFor="let item of group.items"
                    [nzValue]="item.ID"
                    [nzLabel]="item.Code + ' - ' + item.FullName"
                  ></nz-option>
                </nz-option-group>
              </nz-select>
            </nz-input-group>
          </nz-form-control>
        </nz-form-item>
      </nz-col>
      <nz-col [nzXs]="24" [nzSm]="24" [nzMd]="8" [nzLg]="8">
        <nz-form-item class="col-md-12">
          <nz-form-label [nzSpan]="24">Ngày yêu cầu<span class="text-danger ps-1 me-1"> (*)
            </span>
          </nz-form-label>
          <nz-form-control [nzSpan]="24" [nzErrorTip]="'Chọn ngày yêu cầu'">
            <nz-date-picker
              [(ngModel)]="requestDate"
              name="requestDate"
              nzFormat="dd/MM/yyyy"
              nzSize="default"
              style="width: 100%"
              nzPlaceHolder="Chọn ngày yêu cầu"
            ></nz-date-picker>
          </nz-form-control>
        </nz-form-item>
      </nz-col>
      <nz-col [nzXs]="24" [nzSm]="24" [nzMd]="8" [nzLg]="8">
        <nz-form-item class="col-md-12">
          <nz-form-label [nzSpan]="24">Loại yêu cầu<span class="text-danger ps-1 me-1"> (*)
            </span>
          </nz-form-label>
          <nz-form-control [nzSpan]="24" [nzErrorTip]="'Chọn loại yêu cầu'">
            <nz-select
              nzSize="default"
              id="priceRequestTypeSelect"
              [(ngModel)]="priceRequestTypeID"
              name="priceRequestTypeID"
              (ngModelChange)="onPriceRequestTypeChange($event)"
              nzPlaceHolder="Chọn loại yêu cầu"
              class="fs-12 w-100"
              required
              [nzLoading]="priceRequestTypeLoading"
            >
              <nz-option
                *ngFor="let item of priceRequestTypes"
                [nzValue]="item.ID"
                [nzLabel]="item.RequestTypeName"
              ></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </nz-col>
    </nz-row>
    
    <!-- <nz-row [nzGutter]="16" class="mt-2">
      <nz-col [nzXs]="24" [nzSm]="24" [nzMd]="8" [nzLg]="8">
        <nz-form-item class="col-md-12" required>
          <nz-form-label [nzSpan]="24">Khách hàng<span class="text-danger ps-1 me-1"> (*)
            </span>
          </nz-form-label>
          <nz-form-control [nzSpan]="24" [nzErrorTip]="'Chọn khách hàng'">
            <nz-select
              nzSize="default"
              id="customerSelect"
              [(ngModel)]="customerID"
              name="customerID"
              nzPlaceHolder="Chọn khách hàng"
              class="fs-12 w-100"
              required
              nzShowSearch
              nzAllowClear
            >
              <nz-option
                *ngFor="let item of customers"
                [nzValue]="item.ID"
                [nzLabel]="(item.CustomerShortName || '') + ' - ' + (item.CustomerName || '')"
              ></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </nz-col>
    </nz-row> -->
    
    <nz-row [nzGutter]="5" class="mt-2">
      <nz-col [nzXs]="24" [nzSm]="24" [nzMd]="24">
        <div class="d-flex gap-2 mb-1">
          <!-- <button nz-button nzType="primary" nzSize="small" (click)="addRow()">
            <nz-icon nzType="plus"></nz-icon>
            Thêm dòng
          </button> -->
        </div>
        <div #table class="w-100 mt-2"></div>
      </nz-col>
    </nz-row>
  </form>
</div>
<div class="modal-footer">
  <button nz-button nzType="default" nzDanger (click)="close()">Đóng</button>
  <button nz-button nzType="primary" (click)="saveAndClose()">Lưu</button>
</div>

<!-- Template cho popup table
<ng-template #childTableTemplate let-row="row">
  <div class="child-tabulator"></div>
</ng-template>

 <ng-container #vcHost></ng-container> -->

 <div *ngIf="showProductPopup"
     style="position: fixed; z-index: 10000; min-width: 500px; max-width: 700px;"
     [style.top]="productPopupPosition.top"
     [style.left]="productPopupPosition.left">
  <app-tabulator-popup
    [data]="priceRequestTypeID === 6 ? productsRTC : dtProductSale"
    [columns]="priceRequestTypeID === 6 ? productRTCColumns : productColumns"
    [searchFields]="priceRequestTypeID === 6 ? productRTCSearchFields : productSearchFields"
    [searchPlaceholder]="'Tìm kiếm sản phẩm...'"
    [height]="'300px'"
    (rowSelected)="onProductSelected($event)"
    (closed)="onPopupClosed()"
  ></app-tabulator-popup>
</div>

<div *ngIf="showSupplierPopup"
     style="position: fixed; z-index: 10000; min-width: 500px; max-width: 700px;"
     [style.top]="supplierPopupPosition.top"
     [style.left]="supplierPopupPosition.left">
  <app-tabulator-popup
    [data]="dtSupplierSale"
    [columns]="supplierColumns"
    [searchFields]="supplierSearchFields"
    [searchPlaceholder]="'Tìm kiếm nhà cung cấp...'"
    [height]="'300px'"
    (rowSelected)="onSupplierSelected($event)"
    (closed)="onSupplierPopupClosed()"
  ></app-tabulator-popup>
</div>