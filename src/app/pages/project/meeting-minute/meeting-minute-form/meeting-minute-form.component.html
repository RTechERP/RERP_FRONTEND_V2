
  <!-- HEADER -->
  <div class="modal-header bg-primary text-uppercase py-2 flex-shrink-0">
    <h6 class="modal-title text-white">Chi tiết biên bản cuộc họp</h6>
    <button type="button" class="btn-close" (click)="closeModal()" aria-label="Close"></button>
  </div>

  <!-- BODY -->
  <div class="modal-body flex-grow-1 overflow-auto" style="max-height: 80vh;">
    <form nz-form [formGroup]="form" nzLayout="vertical">
      <!-- Form phần trên -->
      <div class="row gx-2">
        <div class="col-md-3 ">
          <nz-form-item>
            <nz-form-label class="fs-12">
              Chọn loại cuộc họp <span class="text-danger ps-1">*</span>
              <button class="p-0 m-0 px-1 fs-12 h-auto" nz-button nzType="text" nzSize="small"
                title="Thêm loại họp" (click)="onAddMeetingType()">
                <i class="fas fa-plus"></i>
              </button>
            </nz-form-label>
            <nz-form-control
              [nzErrorTip]="
                form.get('MeetingTypeID')?.invalid &&
                (form.get('MeetingTypeID')?.dirty || form.get('MeetingTypeID')?.touched)
                  ? 'Vui lòng chọn loại cuộc họp'
                  : undefined
              "
            >
              <nz-select formControlName="MeetingTypeID"
                nzPlaceHolder="Chọn loại cuộc họp" nzShowSearch nzAllowClear
                style="width: 100%" name="meetingTypeID">
                <nz-option-group *ngFor="let group of meetingTypeGroupsData"
                  [nzLabel]="getGroupName(group.GroupID)">
                  <nz-option *ngFor="let room of group.Rooms"
                    [nzLabel]="room.TypeCode + ' - ' + room.TypeName"
                    [nzValue]="room.ID">
                  </nz-option>
                </nz-option-group>
              </nz-select>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div class="col-md-3 ">
          <nz-form-item>
            <nz-form-label class="fs-12">
              Chọn dự án <span class="text-danger ps-1">*</span>
            </nz-form-label>
            <nz-form-control
              [nzErrorTip]="
                form.get('ProjectID')?.invalid &&
                (form.get('ProjectID')?.dirty || form.get('ProjectID')?.touched)
                  ? 'Vui lòng chọn dự án'
                  : undefined
              "
            >
              <nz-select formControlName="ProjectID"
                nzPlaceHolder="Chọn dự án" nzShowSearch nzAllowClear
                style="width: 100%" name="ProjectCode">
                <nz-option *ngFor="let item of projectData"
                  [nzLabel]="item.ProjectCode + ' - ' + item.ProjectName"
                  [nzValue]="item.ID"></nz-option>
              </nz-select>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div class="col-md-6 ">
          <nz-form-item>
            <nz-form-label class="fs-12">
              Tiêu đề <span class="text-danger ps-1">*</span>
            </nz-form-label>
            <nz-form-control
              [nzErrorTip]="
                form.get('Title')?.invalid &&
                (form.get('Title')?.dirty || form.get('Title')?.touched)
                  ? 'Vui lòng nhập tiêu đề'
                  : undefined
              "
            >
              <input nz-input formControlName="Title" name="Title" />
            </nz-form-control>
          </nz-form-item>
        </div>
      </div>

      <!-- Các phần khác -->
      <div class="row gx-2">
        <div class="col-md-3 ">
          <nz-form-item>
            <nz-form-label class="fs-12">
              Thời gian bắt đầu <span class="text-danger ps-1">*</span>
            </nz-form-label>
            <nz-form-control
              [nzErrorTip]="
                form.get('DateStart')?.invalid &&
                (form.get('DateStart')?.dirty || form.get('DateStart')?.touched)
                  ? 'Vui lòng chọn thời gian bắt đầu'
                  : undefined
              "
            >
              <nz-date-picker formControlName="DateStart"
                [nzFormat]="dateFormat"
                [nzShowTime]="true"
                class="w-100 p-1"
                nzSize="small"
                name="dateStart"></nz-date-picker>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div class="col-md-3 ">
          <nz-form-item>
            <nz-form-label class="fs-12">
              Thời gian kết thúc <span class="text-danger ps-1">*</span>
            </nz-form-label>
            <nz-form-control
              [nzErrorTip]="
                form.get('DateEnd')?.invalid &&
                (form.get('DateEnd')?.dirty || form.get('DateEnd')?.touched)
                  ? 'Vui lòng chọn thời gian kết thúc'
                  : undefined
              "
            >
              <nz-date-picker formControlName="DateEnd"
                [nzFormat]="dateFormat"
                [nzShowTime]="true"
                class="w-100 p-1"
                nzSize="small"
                name="dateEnd"></nz-date-picker>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div class="col-md-3 ">
          <nz-form-item>
            <nz-form-label class="fs-12">
              Người tạo <span class="text-danger ps-1">*</span>
            </nz-form-label>
            <nz-form-control
              [nzErrorTip]="
                form.get('CreatedByID')?.invalid &&
                (form.get('CreatedByID')?.dirty || form.get('CreatedByID')?.touched)
                  ? 'Vui lòng chọn người tạo'
                  : undefined
              "
            >
              <nz-select 
                formControlName="CreatedByID"
                nzPlaceHolder="Chọn người tạo" 
                nzShowSearch 
                nzAllowClear
                style="width: 100%">
                @for (parent of employeeOptionsGrouped; track $index) {
                  <nz-option-group [nzLabel]="parent.label">
                    @for (child of parent.options; track $index) {
                      <nz-option 
                        nzCustomContent="true"
                        [nzLabel]="child.item.FullName" 
                        [nzValue]="child.item.ID">
                        {{ child.item.Code + " - " + child.item.FullName }}
                      </nz-option>
                    }
                  </nz-option-group>
                }
              </nz-select>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div class="col-md-3 ">
          <nz-form-item>
            <nz-form-label class="fs-12">Địa điểm</nz-form-label>
            <nz-form-control>
              <input 
                formControlName="Place" 
                nz-input 
                class="fs-12" 
                placeholder="Nhập địa điểm"
                [nzAutocomplete]="placeAuto" />
              <nz-autocomplete 
                #placeAuto 
                [nzDataSource]="placeOptions"
                (selectionChange)="form.patchValue({ Place: $event.nzValue })">
              </nz-autocomplete>
            </nz-form-control>
          </nz-form-item>
        </div>
      </div>
    </form>

    <!-- PHẦN DƯỚI (Tab + Splitter) -->
    <div class="mt-2">
      <nz-splitter style="max-height: 75vh; min-height: 400px;">
        <nz-splitter-panel  [nzCollapsible]="true" nzResizable="true">
          <nz-tabset>
            <nz-tab nzTitle="Nhân viên tham gia">
              <nz-splitter nzLayout="vertical" style="height: 350px;">
                <nz-splitter-panel nzDefaultSize="50%" nzMin="20%" nzMax="100%" [nzSize]="(selectedGroupId === 2) ? '100%' : '50%'">
                  <div #tb_EmployeeDetailTable id="tb_EmployeeDetailTable" style="height: 350px;"></div>
                </nz-splitter-panel>
                <nz-splitter-panel [nzSize]="(selectedGroupId === 1 || selectedGroupId === null) ? '50%' : '0%'">
                  <div #tb_CustomerDetailTable
                       id="tb_CustomerDetailTable"
                       style="height: 350px;"
                       [style.display]="(selectedGroupId === 1 || selectedGroupId === null) ? 'block' : 'none'">
                  </div>
                </nz-splitter-panel>
              </nz-splitter>
            </nz-tab>
            <!-- TAB: Nội dung -->
            <nz-tab nzTitle="Nội dung">
              <nz-splitter nzLayout="vertical" style="height: 350px;">
                <nz-splitter-panel nzDefaultSize="50%" nzMin="20%" nzMax="100%" [nzSize]="(selectedGroupId === 2) ? '100%' : '50%'">
                  <div #tb_EmployeeDetailContentTable id="tb_EmployeeDetailContentTable" style="height: 350px;"></div>
                </nz-splitter-panel>
                <nz-splitter-panel [nzSize]="(selectedGroupId === 1 || selectedGroupId === null) ? '50%' : '0%'">
                  <div #tb_CustomerDetailContentTable
                       id="tb_CustomerDetailContentTable"
                       style="height: 350px;"
                       [style.display]="(selectedGroupId === 1 || selectedGroupId === null) ? 'block' : 'none'">
                  </div>
                </nz-splitter-panel>
              </nz-splitter>
            </nz-tab>

            <nz-tab nzTitle="File đính kèm">
              <div #tb_FileTable id="tb_FileTable" style="height: 350px;"></div>
            </nz-tab>
          </nz-tabset>
        </nz-splitter-panel>
      </nz-splitter>
    </div>
  </div>

  <!-- FOOTER -->
  <div class="modal-footer flex-shrink-0">
    <button class="fs-12 btn" nz-button nzDanger (click)="closeModal()">Đóng</button>
    <button class="fs-12 btn" nz-button nzType="primary" (click)="saveData()">Lưu</button>
  </div>

