<ng-container class="w-100">
  <div class="card border-0 rounded-0 h-100">
    <div class="card-header bg-white p-1 d-flex align-items-center justify-content-between" style="overflow-x: auto">
      <!-- Bên trái: Các nút hành động -->
      <div class="d-flex gap-1">
        <button
          nz-button
          nzType="default"
          nzSize="small"
          (click)="toggleSearchPanel(); $event.stopPropagation()"
          (mousedown)="$event.stopPropagation()"
          (touchstart)="$event.stopPropagation()"
          (touchend)="$event.stopPropagation()"
          class="sticky-toggle-btn"
          [attr.aria-label]="shouldShowSearchBar ? 'Ẩn tìm kiếm' : 'Hiện tìm kiếm'"
          [attr.aria-expanded]="shouldShowSearchBar"
          type="button">
          <nz-icon [nzType]="shouldShowSearchBar ? 'up' : 'down'" />
        </button>
              <button
              nz-button nzSize="small" class="fs-12 button button-succes btn-add" 
                (click)="onAddMeetingMinutes(false)" 
              >
              <img src="assets/icon/action_add_item_16.png" alt="Thêm mới "  /> Thêm
              </button>
              <button
              class="fs-12 btn-edit" nz-button nzType="default" nzSize="small" nzD 
                (click)="onAddMeetingMinutes(true)"
              >
              <img src="assets/icon/action_edit_item_16.png" alt="Sửa"> Sửa
              </button>
              <button
              class="fs-12 btn-delete" nz-button nzType="default" nzSize="small" nzDanger 
                (click)="onDeleteMeetingMinutes()"
              >
              <img src="assets/icon/action_delete_item_16.png" alt="Xóa " /> Xóa
              </button>
              <button
              nz-button nzType="default" nzSize="small" class="fs-12 btn"
                (click)="exportExcel()"
              >
              <img src="assets/icon/action_export_excel_16.png" alt="Xuất Excel" class="me-1" /> Xuất Excel
              </button>
            </div>
            
      <!-- Bên phải: Tìm kiếm -->
      <div class="d-flex gap-1 align-items-center">
        <input
          nz-input
          nzSize="small"
          nzAllowClear
          placeholder="Nhập từ khóa"
          style="width: 250px"
          [(ngModel)]="searchParams.Keywords"
          (keyup.enter)="searchData()"
          (ngModelChange)="onSearchChange($event)"
        />
        <button nz-button nzType="default" nzSize="small" (click)="searchData()" class="btn">
          <nz-icon nzType="search" />
        </button>
      </div>
    </div>

    <!-- Backdrop overlay cho mobile -->
    <div class="filter-backdrop" 
         *ngIf="shouldShowSearchBar" 
         (click)="toggleSearchPanel()"
         [class.mobile-only]="true">
    </div>

    <!-- Filter bar - hiển thị dạng hàng ngang trên desktop, modal trên mobile -->
    <div class="filter-bar bg-light border-bottom p-2" 
         *ngIf="shouldShowSearchBar"
         [class.mobile-modal]="true">
      <form nz-form class="mobile-filter-form">
        <nz-row [nzGutter]="[8, 8]" nzAlign="bottom">
          <!-- Từ ngày -->
          <nz-col [nzXs]="24" [nzSm]="12" [nzMd]="6" [nzLg]="4" [nzXl]="3">
            <nz-form-item class="mb-0">
              <nz-form-label class="fs-12" style="font-size: 12px;">Từ ngày</nz-form-label>
              <nz-form-control>
                <nz-date-picker
                  [nzFormat]="dateFormat"
                  class="w-100"
                  nzSize="small"
                  [(ngModel)]="searchParams.DateStart"
                  name="dateStart">
                </nz-date-picker>
              </nz-form-control>
            </nz-form-item>
          </nz-col>

          <!-- Đến ngày -->
          <nz-col [nzXs]="24" [nzSm]="12" [nzMd]="6" [nzLg]="4" [nzXl]="3">
            <nz-form-item class="mb-0">
              <nz-form-label class="fs-12" style="font-size: 12px;">Đến ngày</nz-form-label>
              <nz-form-control>
                <nz-date-picker
                  [nzFormat]="dateFormat"
                  class="w-100"
                  nzSize="small"
                  [(ngModel)]="searchParams.DateEnd"
                  name="dateEnd">
                </nz-date-picker>
              </nz-form-control>
            </nz-form-item>
          </nz-col>

          <!-- Loại cuộc họp -->
          <nz-col [nzXs]="24" [nzSm]="12" [nzMd]="6" [nzLg]="5" [nzXl]="5">
            <nz-form-item class="mb-0">
              <nz-form-label class="fs-12" style="font-size: 12px;">Loại cuộc họp</nz-form-label>
              <nz-form-control>
                <nz-select
                  [(ngModel)]="searchParams.MeetingTypeID"
                  [ngModelOptions]="{ standalone: true }"
                  nzPlaceHolder="Chọn loại phòng họp"
                  nzShowSearch
                  nzAllowClear
                  nzSize="small"
                  class="w-100"
                  name="meetingTypeID">
                  <nz-option-group
                    *ngFor="let group of meetingTypeGroupsData"
                    [nzLabel]="getGroupName(group.GroupID)">
                    <nz-option
                      *ngFor="let room of group.Rooms"
                      [nzLabel]="room.TypeCode + ' - ' + room.TypeName"
                      [nzValue]="room.ID">
                    </nz-option>
                  </nz-option-group>
                </nz-select>
              </nz-form-control>
            </nz-form-item>
          </nz-col>

          <!-- Nút Đặt lại và Tìm kiếm -->
          <nz-col [nzXs]="24" [nzSm]="24" [nzMd]="12" [nzLg]="6" [nzXl]="6">
            <nz-form-item class="mb-0">
              <nz-form-label class="fs-12" style="font-size: 12px;" [style.visibility]="'hidden'">.</nz-form-label>
              <nz-form-control>
                <div class="d-flex gap-1">
                  <button nz-button nzType="default" nzSize="small" (click)="resetform()">
                    Đặt lại
                  </button>
                  <button nz-button nzType="primary" nzSize="small" (click)="searchData()">
                    Tìm kiếm
                  </button>
                </div>
              </nz-form-control>
            </nz-form-item>
          </nz-col>
        </nz-row>
      </form>
    </div>

    <!-- Content với bảng -->
    <div class="card-body p-0" style="height: calc(100vh - 120px);" [class.with-search-bar]="shouldShowSearchBar" [class.without-search-bar]="!shouldShowSearchBar">
      <nz-splitter nzLayout="vertical" style="height: 100%;">   
        <nz-splitter-panel nzDefaultSize="50%" nzMin="30%" nzMax="70%">
          <div id="MeetingMinutes" style="height: 100%; min-height: 300px;"></div>
        </nz-splitter-panel>
        <nz-splitter-panel nzDefaultSize="50%" nzMin="30%" nzMax="70%">
          <nz-tabset [nzSelectedIndex]="mainTabIndex" (nzSelectedIndexChange)="onMainTabChange($event)" style="height: 100%;">
            <nz-tab nzTitle="Nhân viên">
              <nz-tabset [nzSelectedIndex]="activeTab" (nzSelectedIndexChange)="onTabChange($event)" style="height: 100%;">
                <nz-tab nzTitle="Nhân viên tham gia">
                  <div id="Employee" style="height: 100%; min-height: 350px;"></div>
                </nz-tab>
                <nz-tab nzTitle="Nội dung">
                  <div #EmployeeContentNE id="EmployeeContentNE" style="height: 100%; min-height: 350px;"></div>
                </nz-tab>
              </nz-tabset>
            </nz-tab>
            <nz-tab nzTitle="Khách hàng">
              <nz-tabset (nzSelectedIndexChange)="onCustomerTabChange($event)" style="height: 100%;">
                <nz-tab nzTitle="Khách hàng tham gia">
                  <div id="Customer" style="height: 100%; min-height: 350px;"></div>
                </nz-tab>
                <nz-tab nzTitle="Nội dung">
                  <div id="CustomerContent" style="height: 100%; min-height: 350px;"></div>
                </nz-tab>
              </nz-tabset>
            </nz-tab>
            <nz-tab nzTitle="File đính kèm">
              <div id="file_table" #fileTableContainer style="height: 100%; min-height: 330px; overflow: hidden; display: flex; flex-direction: column;"></div>
            </nz-tab>
          </nz-tabset>
        </nz-splitter-panel>
      </nz-splitter>
    </div>
  </div>
</ng-container>
