<div class="modal-header bg-primary p-2">
  <h6 class="modal-title text-white text-uppercase">Yêu cầu mua hàng Marketing</h6>
  <button type="button" class="btn-close btn-close-white" aria-label="Close" (click)="close()"></button>
</div>

<div class="modal-body" style="display: flex; flex-direction: column; height: calc(100vh - 200px); overflow: hidden;">
  <!-- Form header -->
  <div class="mb-3" style="flex-shrink: 0;">
    <div class="d-flex gap-2 align-items-end">
      <nz-form-item class="mb-0">
        <nz-form-label class="fs-12">Người yêu cầu</nz-form-label>
        <nz-form-control>
          <nz-select
            style="width: 250px; font-size: 12px;"
            [(ngModel)]="employeeID"
            name="employeeID"
            nzShowSearch
            nzAllowClear
            nzSize="small"
            nzPlaceHolder="Chọn người yêu cầu"
            [nzDisabled]="!isAdmin">
            <nz-option-group *ngFor="let group of employees" [nzLabel]="group.label">
              <nz-option *ngFor="let option of group.options" [nzValue]="option.item.ID" [nzLabel]="option.item.FullName">
              </nz-option>
            </nz-option-group>
          </nz-select>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item class="mb-0">
        <nz-form-label class="fs-12">Ngày yêu cầu</nz-form-label>
        <nz-form-control>
          <nz-date-picker
            [(ngModel)]="dateRequest"
            name="dateRequest"
            nzFormat="dd/MM/yyyy"
            style="width: 150px; font-size: 12px;"
            nzSize="small"
            nzAllowClear="false">
          </nz-date-picker>
        </nz-form-control>
      </nz-form-item>
    </div>
  </div>

  <!-- Grid container - tự động fill phần còn lại -->
  <div class="position-relative flex-grow-1" style="min-height: 0; overflow: hidden; display: flex; flex-direction: column;">
    <div *ngIf="isLoading" class="position-absolute w-100 h-100 d-flex align-items-center justify-content-center" 
         style="background: rgba(255,255,255,0.8); z-index: 999;">
      <nz-spin [nzSpinning]="isLoading" nzSimple></nz-spin>
    </div>

    <!-- Nút thêm dòng -->
    <div class="mb-2" style="flex-shrink: 0;">
      <button nz-button nzType="default" nzSize="small" (click)="addNewRow()">
        <nz-icon nzType="plus" nzTheme="outline"></nz-icon>
        Thêm dòng
      </button>
    </div>

    <div class="table-container grid-container flex-grow-1" style="width: 100%; min-height: 0;">
      <angular-slickgrid
        [gridId]="'grid-marketing-purchase-request'"
        [columns]="columnDefinitions"
        [options]="gridOptions"
        [dataset]="dataset"
        (onAngularGridCreated)="angularGridReady($event.detail)"
        (onCellChange)="onCellChange($event.detail.eventData, $event.detail.args)">
      </angular-slickgrid>
    </div>
  </div>
</div>

<!-- Modal footer -->
<div class="modal-footer">
  <button nz-button nzType="default" (click)="close()">Đóng</button>
  <button nz-button nzType="primary" (click)="saveData()" [nzLoading]="isLoading">
    <nz-icon nzType="save" nzTheme="outline"></nz-icon>
    Lưu
  </button>
</div>
