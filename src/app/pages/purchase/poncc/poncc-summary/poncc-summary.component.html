<div class="modal-dialog-scrollable">
  <div class="modal-header bg-primary align-items-center ps-2 d-flex">
    <h6 class="text-light text-uppercase m-0">TỔNG HỢP PO NCC</h6>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="activeModal.close()"
    ></button>
  </div>

  <div class="modal-body p-0">
    <ng-container class="w-100">
      <div class="card h-100 border-0 rounded-0">
        <div class="card-header bg-white p-0 px-1">
          <p-menubar [model]="ponccSummaryMenu" class="p-0 border-0">
          </p-menubar>
        </div>
        <div
          class="filter-bar bg-light border-bottom p-2 py-0"
          *ngIf="shouldShowSearchBar"
          [class.mobile-modal]="true"
        >
          <form
            nz-form
            nzLayout="inline"
            class="d-flex flex-wrap gap-2 align-items-center"
          >
            <nz-form-item>
              <nz-form-label class="fs-12">Từ ngày</nz-form-label>
              <nz-form-control>
                <nz-date-picker
                  nzFormat="dd/MM/yyyy"
                  class="w-100"
                  [(ngModel)]="dateStart"
                  nzAllowClear="false"
                  name="dateStart"
                  nzSize="small"
                ></nz-date-picker>
              </nz-form-control>
            </nz-form-item>
            <nz-form-item class="mt-0">
              <nz-form-label class="fs-12">Đến ngày</nz-form-label>
              <nz-form-control>
                <nz-date-picker
                  nzFormat="dd/MM/yyyy"
                  class="w-100"
                  [(ngModel)]="dateEnd"
                  nzAllowClear="false"
                  name="dateEnd"
                  nzSize="small"
                ></nz-date-picker>
              </nz-form-control>
            </nz-form-item>

            <nz-form-item class="mt-0">
              <nz-form-label class="fs-12">Nhà cung cấp</nz-form-label>
              <nz-form-control>
                <nz-select
                  nzShowSearch
                  nzAllowClear
                  class="w-100"
                  [(ngModel)]="supplierId"
                  name="supplier"
                  nzPlaceHolder="Nhà cung cấp"
                  nzSize="small"
                  style="width: 400px !important; font-size: 12px"
                >
                  <nz-option
                    *ngFor="let s of suppliers"
                    [nzValue]="s.ID"
                    [nzLabel]="s.NameNCC"
                  ></nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>

            <nz-form-item class="mb-0">
              <nz-form-label class="fs-12" style="font-size: 12px"
                >Từ khóa</nz-form-label
              >
              <nz-form-control>
                <input
                  nz-input
                  placeholder="Nhập từ khóa"
                  nzSize="small"
                  [(ngModel)]="filterText"
                  name="filterText"
                  style="width: 150px; font-size: 12px"
                />
              </nz-form-control>
            </nz-form-item>

            <!-- Nút tìm kiếm với dropdown cho filter bổ sung -->
            <nz-form-item class="mb-0">
              <nz-form-control>
                <div class="btn-group">
                  <button
                    nz-button
                    nzType="primary"
                    nzSize="small"
                    (click)="onSearch()"
                  >
                    Tìm kiếm
                  </button>
                  <button
                    nz-button
                    nzType="primary"
                    nzSize="small"
                    nz-dropdown
                    [nzDropdownMenu]="searchMenu"
                    nzTrigger="click"
                    nzPlacement="bottomRight"
                    style="padding-left: 8px; padding-right: 8px"
                  >
                    <i nz-icon nzType="down"></i>
                  </button>
                  <nz-dropdown-menu #searchMenu="nzDropdownMenu">
                    <div
                      class="p-3 advanced-filters-container"
                      style="
                        min-width: 300px;
                        background-color: #ffffff;
                        border: 1px solid #d9d9d9;
                        border-radius: 4px;
                        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
                      "
                    >
                      <ng-container
                        *ngTemplateOutlet="advancedFiltersTemplate"
                      ></ng-container>
                    </div>
                  </nz-dropdown-menu>
                </div>
              </nz-form-control>
            </nz-form-item>
          </form>
        </div>
        <div class="card-body p-0 ps-1">
          <div *ngIf="isLoading">
            <nz-spin
              [nzSpinning]="isLoading"
              nzSimple
              [style]="{
                position: 'absolute',
                top: '0',
                left: '0',
                width: '100%',
                height: '100%',
                background: 'rgba(255,255,255,0.4)',
                zIndex: '999',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center'
              }"
            ></nz-spin>
          </div>

          <div class="grid-container-summary-poncc">
            <angular-slickgrid
              gridId="gridSummaryPoncc"
              [columns]="columnDefinitionsMaster"
              [options]="gridOptionsMaster"
              [dataset]="summaryData"
              (onAngularGridCreated)="angularGridMasterReady($event.detail)"
            >
            </angular-slickgrid>
          </div>
        </div>
      </div>
    </ng-container>
  </div>
</div>

<ng-template #advancedFiltersTemplate>
  <div style="background-color: #ffffff; padding: 0">
    <form nz-form nzLayout="vertical" class="mt-1">
      <nz-form-item class="mt-2">
        <nz-form-label class="fs-12">Nhân viên</nz-form-label>
        <nz-form-control>
          <nz-select
            name="employeeId"
            [(ngModel)]="employeeId"
            class="w-100"
            nzShowSearch
            nzAllowClear
            nzPlaceHolder="--Chọn nhân viên--"
            nzSize="small"
          >
            <ng-container *ngFor="let group of employees">
              <nz-option-group [nzLabel]="group.label">
                <nz-option
                  *ngFor="let option of group.options"
                  [nzLabel]="option.item.Code + ' - ' + option.item.FullName"
                  [nzValue]="option.item.EmployeeID"
                >
                </nz-option>
              </nz-option-group>
            </ng-container>
          </nz-select>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item class="mt-2">
        <nz-form-label class="fs-12">Trạng thái</nz-form-label>
        <nz-form-control>
          <nz-select
            [(ngModel)]="status"
            name="status"
            nzPlaceHolder="Trạng thái"
            nzSize="small"
          >
            <nz-option [nzValue]="-1" nzLabel="--Tất cả--"></nz-option>
            <nz-option [nzValue]="0" nzLabel="Đang tiến hành"></nz-option>
            <nz-option [nzValue]="1" nzLabel="Hoàn thành"></nz-option>
            <nz-option [nzValue]="2" nzLabel="Đã thanh toán"></nz-option>
            <nz-option [nzValue]="3" nzLabel="Huỷ"></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>
    </form>
  </div>
</ng-template>
