<ng-container>
    <div *ngIf="showHeader" class="modal-header p-1 fs-12" style="background-color: #3469f7; border-radius: 0;">
        <h4 class="modal-title text-white uppercase">{{ headerText }}</h4>

        <button *ngIf="showCloseButton" type="button" class="btn-close me-2" aria-label="Close" (click)="closeModal()">
        </button>
    </div>
    <nz-splitter>
        <nz-splitter-panel [nzSize]="sizeSearch" nzResizable="false">
            <div class="card border-0 rounded-0 h-100">
                <div class="card-header bg-white p-1">
                    <div class="d-flex justify-content-between align-items-center">
                        <h6 class="m-0 ms-2">Tìm kiếm</h6>
                        <button class="border-0 me-2" nz-button nzSize="small" nzType="default" nzDanger
                            (click)="toggleSearchPanel()">
                            <nz-icon nzType="close" nzTheme="outline" />
                        </button>
                    </div>
                </div>
                <div class="card-body fs-12">
                    <form nz-form nzLayout="vertical" (ngSubmit)="onSearch()">
                        <nz-form-item class="mb-2">
                            <nz-form-label class="fs-12">Từ ngày</nz-form-label>
                            <nz-form-control>
                                <nz-date-picker class="w-100 fs-12" nzFormat="dd/MM/yyyy" [(ngModel)]="dateStart"
                                    nzAllowClear="false" name="dateStart"></nz-date-picker>
                            </nz-form-control>
                        </nz-form-item>
                        <nz-form-item class="mb-2">
                            <nz-form-label class="fs-12">Đến ngày</nz-form-label>
                            <nz-form-control>
                                <nz-date-picker class="w-100 fs-12" nzFormat="dd/MM/yyyy" [(ngModel)]="dateEnd"
                                    nzAllowClear="false" name="dateEnd"></nz-date-picker>
                            </nz-form-control>
                        </nz-form-item>
                        <nz-form-item class="mb-2">
                            <nz-form-label class="fs-12">Trạng thái</nz-form-label>
                            <nz-form-control>
                                <nz-select class="w-100 fs-12" nzShowSearch nzAllowClear name="statusRequest"
                                    nzAllowClear="false" [(ngModel)]="statusRequestFilter" nzPlaceHolder="--Tất cả--">
                                    <nz-option *ngFor="let s of statusOptions" [nzValue]="s.value"
                                        [nzLabel]="s.label"></nz-option>
                                </nz-select>
                            </nz-form-control>
                        </nz-form-item>
                        <nz-form-item class="mb-2">
                            <nz-form-label class="fs-12">Dự án</nz-form-label>
                            <nz-form-control>
                                <nz-select class="w-100 fs-12" nzShowSearch nzAllowClear name="projectId"
                                    [(ngModel)]="projectIdFilter" nzPlaceHolder="Chọn dự án">
                                    <nz-option *ngFor="let p of projects" [nzValue]="p.ID"
                                        [nzLabel]="p.ProjectCode + ' - ' + p.ProjectName"></nz-option>
                                </nz-select>
                            </nz-form-control>
                        </nz-form-item>
                        <nz-form-item class="mb-2">
                            <nz-form-label class="fs-12">Tình trạng</nz-form-label>
                            <nz-form-control>
                                <nz-select class="w-100 fs-12" nzShowSearch nzAllowClear name="isDeletedFilter"
                                    nzAllowClear="false" [(ngModel)]="isDeletedFilter" nzPlaceHolder="--Tất cả--">
                                    <nz-option *ngFor="let a of deletedOptions" [nzValue]="a.value"
                                        [nzLabel]="a.label"></nz-option>
                                </nz-select>
                            </nz-form-control>
                        </nz-form-item>
                        <nz-form-item class="mb-2">
                            <nz-form-label class="fs-12">Trạng thái BGĐ</nz-form-label>
                            <nz-form-control>
                                <nz-select class="w-100 fs-12" nzShowSearch nzAllowClear name="approvedBGD"
                                    nzAllowClear="false" [(ngModel)]="isApprovedBGDFilter" nzPlaceHolder="--Tất cả--">
                                    <nz-option *ngFor="let a of approvalOptions" [nzValue]="a.value"
                                        [nzLabel]="a.label"></nz-option>
                                </nz-select>
                            </nz-form-control>
                        </nz-form-item>
                        <nz-form-item class="mb-2">
                            <nz-form-label class="fs-12">Số POKH</nz-form-label>
                            <nz-form-control>
                                <nz-select class="w-100 fs-12" nzShowSearch nzAllowClear name="pokhId"
                                    [(ngModel)]="pokhIdFilter" nzPlaceHolder="Chọn Số PO KH">
                                    <nz-option *ngFor="let po of lstPOKH" [nzValue]="po.ID"
                                        [nzLabel]="po.POCode"></nz-option>
                                </nz-select>
                            </nz-form-control>
                        </nz-form-item>
                        <nz-form-item class="mb-2">
                            <nz-form-label class="fs-12">Từ khóa</nz-form-label>
                            <nz-form-control>
                                <input nz-input class="fs-12" [(ngModel)]="keyword" name="keyword" placeholder="Mã SP, ghi chú..."
                                    (keyup.enter)="onSearch()" />
                            </nz-form-control>
                        </nz-form-item>
                    </form>
                </div>
                <div class="card-footer bg-white p-1 d-flex gap-1 justify-content-end">
                    <button nz-button nzType="default" nzSize="small" (click)="resetSearch()">
                        Đặt lại
                    </button>
                    <button nz-button nzType="primary" nzSize="small" (click)="onSearch()" (keyup.enter)="onSearch()">
                        Tìm kiếm
                    </button>
                </div>
            </div>
        </nz-splitter-panel>
        <nz-splitter-panel nzDefaultSize="100%">
            <div class="card border-0 rounded-0 h-100">
                <div class="card-header bg-white p-1" style="overflow-x: auto;">
                    <div class="d-flex gap-1">
                        <button nz-button nzType="default" nzSize="small" (click)="toggleSearchPanel()"
                            style="min-width: 1.2vw;" aria-label="Tìm kiếm"> <nz-icon nzType="search" />
                        </button>

                        <!-- Chỉ hiển thị 3 nút: Thêm, Sửa, Xóa -->
                        <button nz-button nzType="default" nzSize="small" (click)="onAdd()">
                            <img class="btn-action-icon" src="assets/icon/action_add_24.svg" />Thêm
                        </button>
                        <button class="fs-12" nz-button nzType="default" nzSize="small" (click)="onEdit()">
                            <img class="btn-action-icon" src="assets/icon/action_edit_24.svg" />Sửa
                        </button>
                        <button class="fs-12" nz-button nzType="default" (click)="onDelete()" nzSize="small">
                            <img class="btn-action-icon" src="assets/icon/action_delete_24.svg" />Xóa
                        </button>
                        <button nz-button nzType="default" nzSize="small" (click)="onSaveData()"
                            *hasPermission="'N35,N1'">
                            <img class="btn-action-icon" src="assets/icon/action_save_24.svg" />Lưu thay đổi
                        </button>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div *ngIf="isLoading">
                        <nz-spin [nzSpinning]="isLoading" nzSimple [style]="{
                            position: 'absolute',
                            top: '0',
                            left: '0',
                            width: '100%',
                            height: '100%',
                            background: 'rgba(255,255,255,0.4)',
                            zIndex: '999',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center'
                            }"></nz-spin>
                    </div>
                    <nz-tabset class="ms-2" (nzSelectedIndexChange)="onTabChange($event)">
                        <nz-tab class="purchase-tab" *ngFor="let tab of tabs; let i = index" [nzTitle]="tab.title">
                            <div class="table-container mt-1" #tbContainer></div>
                        </nz-tab>
                    </nz-tabset>
                </div>
            </div>
        </nz-splitter-panel>
    </nz-splitter>
</ng-container>
