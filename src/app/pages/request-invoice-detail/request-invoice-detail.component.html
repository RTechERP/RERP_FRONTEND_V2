<!-- Form yêu cầu xuất hóa đơn với bố cục cân đối -->
<div class="modal-header">
    <h4 class="modal-title">Yêu cầu xuất hóa đơn</h4>
    <button type="button" class="btn-close" aria-label="Close" (click)="closeModal()">
    </button>
</div>

<div class="modal-body">
    <form>
        <div class="row">
            <!-- Column 1: Customer Info --> 
            <div class="col-md-4 pe-2">
                <div class="row">
                    <div class="col-md-12 mb-2">
                        <label class="mb-0 fs-12">Số phiếu</label>
                        <input type="text" class="form-control form-control-sm fs-12"
                            [(ngModel)]="formData.customerCode" name="customerCode" disabled>
                    </div>
                    <div class="col-md-12 mb-2">
                        <label class="mb-0 fs-12">Công ty bán</label>
                        <nz-select nzShowSearch name="taxCompany" nzPlaceHolder="Chọn công ty bán" nzAllowClear
                            nzSize="default" class="w-100" [(ngModel)]="formData.taxCompanyId">
                            <nz-option *ngFor="let item of taxCompanyOptions" [nzValue]="item.value"
                                [nzLabel]="item.label"></nz-option>
                        </nz-select>
                    </div>
                    <div class="col-md-12 mb-2">
                        <label class="mb-0 fs-12">Khách hàng</label>
                        <nz-select nzShowSearch name="customerId" nzPlaceHolder="Chọn khách hàng" nzAllowClear
                            nzSize="default" class="w-100" [(ngModel)]="formData.customerId"
                            (ngModelChange)="onCustomerChange($event)">
                            <nz-option *ngFor="let customer of customers" [nzValue]="customer.ID"
                                [nzLabel]="customer.CustomerName"></nz-option>
                        </nz-select>
                    </div>
                    <div class="col-md-12 mb-2">
                        <label class="mb-0 fs-12">Địa chỉ</label>
                        <textarea class="form-control form-control-sm fs-12" [(ngModel)]="formData.address"
                            name="address" rows="3" (ngModelChange)="onFormChange()" style="height: 10px; " disabled></textarea>
                    </div>
                </div>
            </div>

            <!-- Column 2: Request Info -->
            <div class="col-md-4 px-2">
                <div class="row">
                    <div class="col-md-12 mb-2">
                        <label class="mb-0 fs-12">Người yêu cầu</label>
                        <nz-select nzShowSearch name="userId" nzPlaceHolder="Chọn người yêu cầu" nzAllowClear
                            nzSize="default" class="w-100" [(ngModel)]="formData.userId"
                            (ngModelChange)="onUserChange($event)">
                            <nz-option *ngFor="let user of employees" [nzValue]="user.ID"
                                [nzLabel]="user.FullName"></nz-option>
                        </nz-select>
                    </div>
                    <div class="col-md-12 mb-2">
                        <label class="mb-0 fs-12">Ngày yêu cầu</label>
                        <input type="date" class="form-control form-control-sm fs-12" [(ngModel)]="formData.requestDate"
                            name="requestDate" (ngModelChange)="onFormChange()">
                    </div>
                    <div class="col-md-12 mb-2">
                        <label class="mb-0 fs-12">Ngày xuất</label>
                        <input type="date" class="form-control form-control-sm fs-12" [(ngModel)]="formData.exportDate"
                            name="createDate">
                    </div>
                    <div class="col-md-12 mb-2">
                        <label class="mb-0 fs-12">Trạng thái</label>
                        <nz-select nzShowSearch name="status" nzPlaceHolder="Chọn trạng thái" nzAllowClear
                            nzSize="default" class="w-100" [(ngModel)]="formData.status">
                            <nz-option *ngFor="let item of statuses" [nzValue]="item.value"
                                [nzLabel]="item.label"></nz-option>
                        </nz-select>
                    </div>
                </div>
            </div>

            <!-- Column 3: Tax Info -->
            <div class="col-md-4 ps-2">
                <div class="row">
                    <h6>File đính kèm</h6>
                    <div class="mb-3 d-flex align-items-center">
                        <input type="file" multiple class="form-control" #fileInput
                            style="max-width: 300px; height: 30px; font-size: 11px;" (change)="($event)">
                    </div>
                    <div #tb_InvoiceFile id="tb_InvoiceFile"></div>
                </div>
            </div>
        </div>

        <!-- Grid for Products -->
        <div class="mt-3">
            <div class="d-flex justify-content-between mb-2">
                <h6 class="mb-0 fs-14">Danh sách sản phẩm</h6>
                <button nz-button nzType="primary" nzSize="small" >
                    <i nz-icon nzType="plus"></i> Thêm sản phẩm
                </button>
            </div>
            <nz-table #productTable [nzData]="products" [nzPageSize]="5" [nzShowPagination]="true">
                <thead>
                    <tr>
                        <th>STT</th>
                        <th>Sản phẩm</th>
                        <th>Mã sản phẩm</th>
                        <th>Đơn vị</th>
                        <th>Số lượng</th>
                        <th>Dự án</th>
                        <th>Ghi chú</th>
                        <th>Thao tác</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let product of products; let i = index">
                        <td>{{i + 1}}</td>
                        <td>{{product.productName}}</td>
                        <td>{{product.productCode}}</td>
                        <td>{{product.unit}}</td>
                        <td>{{product.quantity}}</td>
                        <td>{{product.projectName}}</td>
                        <td>{{product.note}}</td>
                        <td>
                            <button nz-button nzType="primary" nzSize="small" class="me-1">
                                <i nz-icon nzType="edit"></i>
                            </button>
                            <button nz-button nzType="primary" nzDanger nzSize="small">
                                <i nz-icon nzType="delete"></i>
                            </button>
                        </td>
                    </tr>
                </tbody>
            </nz-table>
        </div>
    </form>

    <div class="modal-footer py-1">
        <button nz-button nzType="primary" nzSize="default" (click)="saveAndClose()">Lưu và đóng</button>
        <button nz-button nzType="default" nzDanger="true" nzSize="default" (click)="closeModal()">Đóng</button>
    </div>
</div>