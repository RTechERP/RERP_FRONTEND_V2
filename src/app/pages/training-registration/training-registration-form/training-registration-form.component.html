<div class="modal-header bg-primary p-2">
    <h6 class="modal-title text-white m-0">CHI TIẾT ĐĂNG KÝ</h6>
    <button type="button" class="btn-close btn-close-white" (click)="closeModal()" aria-label="Close"></button>
</div>
<div class="training-form-container layout-safe px-4 py-1 ">
    <!-- Form thông tin chính -->
    <form nz-form [formGroup]="validateForm" [nzLayout]="validateForm.controls.formLayout.value" nzLayout="vertical"
        (ngSubmit)="submitForm()">
        <div nz-row [nzGutter]="16">
            <!-- Cột 1: Nhân viên -->
            <div nz-col [nzXs]="24" [nzSm]="24" [nzMd]="24" [nzLg]="8" [nzXl]="8">
                <nz-form-item class="compact-form-item">
                    <nz-form-label [nzSpan]="isHorizontal ? 6 : null" nzRequired>Nhân viên</nz-form-label>
                    <nz-form-control [nzSpan]="isHorizontal ? 18 : null" nzErrorTip="Vui lòng chọn nhân viên!">
                        <nz-select formControlName="EmployeeID" nzShowSearch nzAllowClear nzPlaceHolder="Chọn nhân viên"
                            nzSize="default">
                            <nz-option-group *ngFor="let group of employeeGroups" [nzLabel]="group.department">
                                <nz-option *ngFor="let emp of group.items" [nzValue]="emp.ID"
                                    [nzLabel]="emp.Code + ' - ' + emp.FullName"></nz-option>
                            </nz-option-group>
                        </nz-select>
                    </nz-form-control>
                </nz-form-item>
            </div>

            <!-- Cột 2: Chức vụ -->
            <div nz-col [nzXs]="24" [nzSm]="24" [nzMd]="12" [nzLg]="8" [nzXl]="8">
                <nz-form-item class="compact-form-item">
                    <nz-form-label [nzSpan]="isHorizontal ? 6 : null">Chức vụ</nz-form-label>
                    <nz-form-control [nzSpan]="isHorizontal ? 18 : null">
                        <input nz-input formControlName="Position" placeholder="Chức vụ" 
                            nzSize="default" readonly style="background-color: #f5f5f5;">
                    </nz-form-control>
                </nz-form-item>
            </div>

            <!-- Cột 3: Phòng ban -->
            <div nz-col [nzXs]="24" [nzSm]="24" [nzMd]="12" [nzLg]="8" [nzXl]="8">
                <nz-form-item class="compact-form-item">
                    <nz-form-label [nzSpan]="isHorizontal ? 6 : null">Phòng ban</nz-form-label>
                    <nz-form-control [nzSpan]="isHorizontal ? 18 : null">
                        <input nz-input formControlName="Department" placeholder="Phòng ban" 
                            nzSize="default" readonly style="background-color: #f5f5f5;">
                    </nz-form-control>
                </nz-form-item>
            </div>
        </div>

        <!-- Hàng 2: Loại đào tạo, Số buổi/khóa, Số phút/buổi -->
        <div nz-row [nzGutter]="16">
            <!-- Loại đào tạo -->
            <div nz-col [nzXs]="24" [nzSm]="24" [nzMd]="8" [nzLg]="8" [nzXl]="8">
                <nz-form-item class="compact-form-item">
                    <nz-form-label nzRequired>Loại đào tạo</nz-form-label>
                    <nz-form-control nzErrorTip="Vui lòng chọn loại đào tạo!">
                        <nz-select formControlName="TrainingType" nzShowSearch nzAllowClear
                            nzPlaceHolder="Chọn loại đào tạo" nzSize="default">
                            <nz-option *ngFor="let type of trainingTypes" [nzValue]="type.ID"
                                [nzLabel]="type.Name"></nz-option>
                        </nz-select>
                    </nz-form-control>
                </nz-form-item>
            </div>
            
            <!-- Số buổi/khóa -->
            <div nz-col [nzXs]="24" [nzSm]="24" [nzMd]="8" [nzLg]="8" [nzXl]="8">
                <nz-form-item class="compact-form-item">
                    <nz-form-label nzRequired>Số buổi / khóa</nz-form-label>
                    <nz-form-control nzErrorTip="Vui lòng nhập số buổi!">
                        <nz-input-number formControlName="SessionsPerCourse" [nzMin]="1" [nzStep]="1"
                            nzPlaceHolder="Nhập số buổi" nzSize="default" style="width: 100%"></nz-input-number>
                    </nz-form-control>
                </nz-form-item>
            </div>
            
            <!-- Số phút/buổi -->
            <div nz-col [nzXs]="24" [nzSm]="24" [nzMd]="8" [nzLg]="8" [nzXl]="8">
                <nz-form-item class="compact-form-item">
                    <nz-form-label nzRequired>Số phút / buổi</nz-form-label>
                    <nz-form-control nzErrorTip="Vui lòng nhập số phút!">
                        <nz-input-number aria-label="Số phút / buổi" formControlName="SessionDuration" [nzMin]="15"
                            [nzStep]="15" nzPlaceHolder="Nhập số phút" nzSize="default"
                            style="width: 100%"></nz-input-number>
                    </nz-form-control>
                </nz-form-item>
            </div>
        </div>

        <!-- Hàng 3: Thời gian đào tạo, Đánh giá mức độ hoàn thành, Cấp chứng chỉ -->
        <div nz-row [nzGutter]="16">
            <!-- Thời gian đào tạo -->
            <div nz-col [nzXs]="24" [nzSm]="24" [nzMd]="8" [nzLg]="8" [nzXl]="8">
                <nz-form-item class="compact-form-item">
                    <nz-form-label nzRequired>Thời gian đào tạo</nz-form-label>
                    <nz-form-control nzErrorTip="Vui lòng chọn thời gian đào tạo!">
                        <nz-range-picker formControlName="TrainingRange" nzFormat="dd/MM/yyyy"></nz-range-picker>
                    </nz-form-control>
                </nz-form-item>
            </div>

            <!-- Đánh giá mức độ hoàn thành -->
            <div nz-col [nzXs]="24" [nzSm]="24" [nzMd]="8" [nzLg]="8" [nzXl]="8">
                <nz-form-item class="compact-form-item">
                    <nz-form-label>Đánh giá mức độ hoàn thành</nz-form-label>
                    <nz-form-control>
                        <nz-select formControlName="CompletionAssessment" nzAllowClear
                            nzPlaceHolder="Chọn mức độ hoàn thành" nzSize="default">
                            <nz-option nzValue="Xuất sắc" nzLabel="Xuất sắc"></nz-option>
                            <nz-option nzValue="Tốt" nzLabel="Tốt"></nz-option>
                            <nz-option nzValue="Khá" nzLabel="Khá"></nz-option>
                            <nz-option nzValue="Trung bình" nzLabel="Trung bình"></nz-option>
                            <nz-option nzValue="Yếu" nzLabel="Yếu"></nz-option>
                        </nz-select>
                    </nz-form-control>
                </nz-form-item>
            </div>
            
            <!-- Cấp chứng chỉ -->
            <div nz-col [nzXs]="24" [nzSm]="24" [nzMd]="8" [nzLg]="8" [nzXl]="8">
                <nz-form-item class="compact-form-item" style="margin-top: 22px;">
                    <nz-form-control>
                        <label style="margin-top: 1.5vh;" nz-checkbox formControlName="IsCertification">
                            Cấp chứng chỉ
                        </label>
                    </nz-form-control>
                </nz-form-item>
            </div>
        </div>

        <!-- Hàng 4: Mục đích đào tạo -->
        <div nz-row [nzGutter]="16">
            <!-- Mục đích đào tạo -->
            <div nz-col [nzXs]="24" [nzSm]="24" [nzMd]="24" [nzLg]="24" [nzXl]="24">
                <nz-form-item class="compact-form-item">
                    <nz-form-label [nzSpan]="isHorizontal ? 3 : null" nzRequired>Mục đích đào tạo</nz-form-label>
                    <nz-form-control [nzSpan]="isHorizontal ? 21 : null" nzErrorTip="Vui lòng nhập mục đích đào tạo!">
                        <textarea nz-input formControlName="Purpose" placeholder="Nhập mục đích đào tạo"
                            nzSize="default" rows="2"></textarea>
                    </nz-form-control>
                </nz-form-item>
            </div>
        </div>
    </form>


    <!-- Phần bảng chi tiết và file ở dưới -->
    <div class="tables-section">
        <div nz-row [nzGutter]="16">
            <!-- Cột trái - Bảng chi tiết -->
            <div nz-col [nzXs]="24" [nzSm]="24" [nzMd]="24" [nzLg]="16" [nzXl]="16">
                <div class="detail-container">
                    <h6>Hạng mục đăng ký</h6>
                    <div #detailTable class="detail-table"></div>
                </div>
            </div>

            <!-- Cột phải - Bảng file -->
            <div nz-col [nzXs]="24" [nzSm]="24" [nzMd]="24" [nzLg]="8" [nzXl]="8">
                <div class="file-container">
                    <div class="file-upload-section mb-2">
                        <nz-upload [(nzFileList)]="fileList" [nzBeforeUpload]="beforeUpload" [nzMultiple]="true"
                            [nzShowUploadList]="false">
                            <button nz-button nzSize="small">
                                <i nz-icon nzType="upload"></i>
                                Thêm file đính kèm
                            </button>
                        </nz-upload>
                    </div>
                    <div class="tabulator-safe" #fileTable class="file-table"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-footer">
        <button nz-button nzType="default" (click)="closeModal()">Hủy</button>
        <button nz-button nzType="primary" (click)="uploadFilesAndSaveData()">Lưu dữ liệu</button>
    </div>